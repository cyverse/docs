{"config":{"separator":"[\\s\\-_,:!=\\[\\]()\\\\\"`/]+|\\.(?!\\d)"},"items":[{"location":"","level":1,"title":"CyVerse Core Software Documentation","text":"","path":["CyVerse Core Software Documentation"],"tags":[]},{"location":"#cyverse-core-software-documentation","level":1,"title":"CyVerse Core Software Documentation","text":"<p>Welcome to the comprehensive technical documentation for deploying and maintaining the CyVerse cyberinfrastructure. This documentation is designed to support DevOps engineers, system administrators, and application developers working with CyVerse's open-source scientific cyberinfrastructure.</p>","path":["CyVerse Core Software Documentation"],"tags":[]},{"location":"#documentation-overview","level":2,"title":"Documentation Overview","text":"<p>CyVerse is a Software as a Service (SaaS) platform built on modern cloud-native technologies, providing researchers with powerful computational infrastructure for data-intensive science. Our documentation covers the complete stack from infrastructure deployment to API integration. </p> <p> </p> The CyVerse infrastructure layer cake is stacked upon bare-metal Hardware, then Services, and finally Products","path":["CyVerse Core Software Documentation"],"tags":[]},{"location":"#find-documentation-by-your-role","level":2,"title":"Find Documentation by Your Role","text":"","path":["CyVerse Core Software Documentation"],"tags":[]},{"location":"#devops-engineer","level":3,"title":"DevOps Engineer","text":"<p>You're deploying and maintaining CyVerse infrastructure</p> <p>Start here:</p> <ul> <li>Getting Started Guide - Prerequisites and deployment roadmap</li> <li>System Overview - Architecture and technology stack</li> <li>Deployment Guide - Complete deployment walkthrough</li> </ul> <p>Common tasks:</p> <ul> <li>Deploy Kubernetes cluster - Core infrastructure setup</li> <li>Configure authentication - KeyCloak deployment and LDAP integration</li> <li>Set up storage - OpenEBS and iRODS CSI driver</li> <li>Deploy Discovery Environment - Main application platform</li> <li>Database management - PostgreSQL schemas and migrations</li> </ul>","path":["CyVerse Core Software Documentation"],"tags":[]},{"location":"#system-administrator","level":3,"title":"System Administrator","text":"<p>You're managing users, apps, and operational tasks</p> <p>Start here:</p> <ul> <li>Administration Guide - Daily operational procedures</li> <li>Discovery Environment Admin - User management, app publishing, VICE access</li> <li>Data Store Admin - Data management and permissions</li> </ul> <p>Common tasks:</p> <ul> <li>Grant VICE access - Enable interactive computing for users</li> <li>Process DOI/Permanent ID requests - Data publishing workflows</li> <li>Manage user groups - Grouper administration</li> <li>Publish apps to Discovery Environment - Tool integration</li> <li>FAQ - Frequently asked questions and troubleshooting</li> </ul>","path":["CyVerse Core Software Documentation"],"tags":[]},{"location":"#application-developer","level":3,"title":"Application Developer","text":"<p>You're integrating with CyVerse APIs or contributing code</p> <p>Start here:</p> <ul> <li>Developer Guide - Development environment and contribution workflow</li> <li>API Overview - Terrain API introduction</li> <li>API Endpoint Index - Complete API reference</li> </ul> <p>Common tasks:</p> <ul> <li>Authentication - OAUTH 2.0 integration</li> <li>Filesystem operations - Data Store API</li> <li>Job submission - Analysis execution</li> <li>Tapis v2 to v3 migration - Upgrade guide</li> <li>Error handling - API error codes and responses</li> </ul>","path":["CyVerse Core Software Documentation"],"tags":[]},{"location":"#documentation-sections","level":2,"title":"Documentation Sections","text":"Section Description Audience Getting Started Prerequisites, system overview, and deployment roadmap DevOps, New users Deployment Guide Complete infrastructure deployment: Kubernetes, services, databases DevOps Engineers Administration Guide Operational procedures, user management, app publishing System Administrators API Reference Terrain API endpoints, authentication, error handling Developers Developer Guide Development environment, contribution workflow, architecture Developers System Architecture Platform components, services, and design decisions All audiences Database Reference PostgreSQL schemas for all CyVerse services DevOps, DBAs","path":["CyVerse Core Software Documentation"],"tags":[]},{"location":"#cyverse-platform-components","level":2,"title":"CyVerse Platform Components","text":"","path":["CyVerse Core Software Documentation"],"tags":[]},{"location":"#core-products","level":3,"title":"Core Products","text":"<ul> <li>Discovery Environment (DE) - Web-based analysis platform for computational workflows</li> <li>Data Store - 6+ PB iRODS-based data management system</li> <li>Data Commons - Data publishing platform with DOI/ARK support</li> <li>VICE - Visual Interactive Computing Environment (Jupyter, RStudio, etc.)</li> </ul>","path":["CyVerse Core Software Documentation"],"tags":[]},{"location":"#specialized-tools","level":3,"title":"Specialized Tools","text":"<ul> <li>BisQue - Bio-Image Semantic Query User Environment</li> <li>DNA Subway - Educational genomics platform</li> <li>Cloud Services (CACAO) - Cloud automation and multi-cloud orchestration</li> </ul>","path":["CyVerse Core Software Documentation"],"tags":[]},{"location":"#infrastructure-services","level":3,"title":"Infrastructure Services","text":"<ul> <li>Authentication (KeyCloak) - OAUTH 2.0, LDAP, CILogon integration</li> <li>Terrain API - RESTful API aggregating all DE services</li> <li>Kubernetes - Container orchestration platform</li> <li>iRODS - Integrated Rule-Oriented Data System for data management</li> </ul>","path":["CyVerse Core Software Documentation"],"tags":[]},{"location":"#quick-links","level":2,"title":"Quick Links","text":"<ul> <li> FAQ - Frequently asked questions and troubleshooting</li> <li> GitHub Organization - Source code repositories</li> <li> Live Terrain API - Interactive API documentation</li> <li> Harbor Registry - Container image repository</li> <li> CyVerse Website - Public-facing information and user support</li> </ul> What is CyVerse? <p>Public Website</p> <p>CyVerse is a powerful computational infrastructure and the people who support its operations. It is fully open source, and dedicated to furthering open science.</p> <p>CyVerse has been funded by the United States National Science Foundation (NSF) from 2008 until the present</p> <p> </p> <p> </p> <p> SOFTWARE LICENSE</p> <p>Copyright Â© 2010-2026, The Arizona Board of Regents on behalf of The University of Arizona</p> <p>All rights reserved.</p> <p>Developed by: CyVerse as a collaboration between participants at BIO5 at The University of Arizona (the primary hosting institution), Cold Spring Harbor Laboratory, The University of Texas at Austin, and individual contributors. Find out more at http://www.cyverse.org/.</p> <p>Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:</p> <ul> <li>Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.</li> <li>Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.</li> <li>Neither the name of CyVerse, BIO5, The University of Arizona, Cold Spring Harbor Laboratory, The University of Texas at Austin, nor the names of other contributors may be used to endorse or promote products derived from this software without specific prior written permission.</li> </ul> <p>THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</p>","path":["CyVerse Core Software Documentation"],"tags":[]},{"location":"database/de-db/","level":1,"title":"DE Database","text":"<p>This Database is used for CyVerse discovery environment.</p>","path":["Database Reference","DE Database"],"tags":[]},{"location":"database/de-db/#initialize-database","level":2,"title":"Initialize database","text":"","path":["Database Reference","DE Database"],"tags":[]},{"location":"database/de-db/#access-database","level":3,"title":"Access Database","text":"<pre><code>ssh root@DB_HOST.com\npsql -U postgres\n</code></pre>","path":["Database Reference","DE Database"],"tags":[]},{"location":"database/de-db/#create-required-database-and-user","level":3,"title":"Create required Database and User","text":"<pre><code># create de user\ncreate user de with password '********';\n\n# create de database\ncreate database de with owner de;\n</code></pre>","path":["Database Reference","DE Database"],"tags":[]},{"location":"database/de-db/#add-required-extensions","level":3,"title":"Add required extensions","text":"<pre><code># psql -U postgres\n\\c de\ncreate extension \"uuid-ossp\";\ncreate extension \"moddatetime\";\ncreate extension \"btree_gist\";\n</code></pre>","path":["Database Reference","DE Database"],"tags":[]},{"location":"database/de-db/#populate-database","level":3,"title":"Populate Database","text":"","path":["Database Reference","DE Database"],"tags":[]},{"location":"database/de-db/#clone-de-database-repository","level":4,"title":"Clone de-database repository","text":"<pre><code>git clone https://github.com/cyverse-de/de-database.git\ncd de-database\n</code></pre>","path":["Database Reference","DE Database"],"tags":[]},{"location":"database/de-db/#install-golang-migrate","level":4,"title":"install golang-migrate","text":"<p>These steps are used on Ubuntu debian based OS. <pre><code>curl -s https://packagecloud.io/install/repositories/golang-migrate/migrate/script.deb.sh | sudo bash\napt-get update\napt-get install -y migrate\n\n# check\nmigrate -help\n</code></pre></p>","path":["Database Reference","DE Database"],"tags":[]},{"location":"database/de-db/#run-to-populate-de-database","level":4,"title":"Run to populate de database","text":"<p>Note: we are running the <code>/migration</code> directory from de-database <pre><code>migrate -database postgres://USER:PASSWORD@DB_HOST.com/de?sslmode=disable -path migrations up\n</code></pre></p>","path":["Database Reference","DE Database"],"tags":[]},{"location":"database/de-db/#additional-database-queries","level":4,"title":"Additional database queries","text":"<pre><code># checkout to de user\npsql -U de\n\n\nSET search_path = public, pg_catalog;\n\n# create table version \nCREATE TABLE version (\nversion character varying(20) NOT NULL,\napplied timestamp DEFAULT now()\n);\n\n# populate the Version table from a file\n# location of 999_version.sql: \n# https://github.com/cyverse-de/de-database/edit/master/old-databases/de-db/src/main/data/999_version.sql\npsql -U postgres -h localhost -d de -f 999_version.sql\n</code></pre>","path":["Database Reference","DE Database"],"tags":[]},{"location":"database/de-db/#migrate-database","level":3,"title":"Migrate Database","text":"<p>Once a while upon updating the k8s services, we would require to migrate the de-database, to add the latest database changes.</p>","path":["Database Reference","DE Database"],"tags":[]},{"location":"database/de-db/#clone-latest-de-database","level":4,"title":"Clone latest de-database","text":"<pre><code>git clone https://github.com/cyverse-de/de-database.git\ncd de-database\n</code></pre>","path":["Database Reference","DE Database"],"tags":[]},{"location":"database/de-db/#install-golang-migrate_1","level":4,"title":"install golang-migrate","text":"<p>These steps are used on Ubuntu debian based OS. <pre><code>curl -s https://packagecloud.io/install/repositories/golang-migrate/migrate/script.deb.sh | sudo bash\napt-get update\napt-get install -y migrate\n\n# check\nmigrate -help\n</code></pre></p>","path":["Database Reference","DE Database"],"tags":[]},{"location":"database/de-db/#run-to-migrate-de-database","level":4,"title":"Run to migrate de database","text":"<p>Note: we are running the <code>/migration</code> directory from de-database <pre><code>migrate -database postgres://USER:PASSWORD@DB_HOST.com/de?sslmode=disable -path migrations up\n</code></pre></p>","path":["Database Reference","DE Database"],"tags":[]},{"location":"database/grouper-db/","level":1,"title":"Grouper Database","text":"<p>This Database is used for CyVerse Grouper service.</p>","path":["Database Reference","Grouper Database"],"tags":[]},{"location":"database/grouper-db/#initialize-database","level":2,"title":"Initialize database","text":"","path":["Database Reference","Grouper Database"],"tags":[]},{"location":"database/grouper-db/#access-database","level":3,"title":"Access Database","text":"<pre><code>ssh root@DB_HOST.com\npsql -U postgres\n</code></pre>","path":["Database Reference","Grouper Database"],"tags":[]},{"location":"database/grouper-db/#create-required-database-and-user","level":3,"title":"Create required Database and User","text":"<pre><code>## create grouper user\ncreate user grouper with password '********';\n\n## create grouper database\ncreate database grouper with owner grouper;\n</code></pre>","path":["Database Reference","Grouper Database"],"tags":[]},{"location":"database/grouper-db/#add-required-extensions","level":3,"title":"Add required extensions","text":"<pre><code># psql -U postgres\n\\c grouper\ncreate extension \"uuid-ossp\";\ncreate extension \"moddatetime\";\ncreate extension \"btree_gist\";\n</code></pre>","path":["Database Reference","Grouper Database"],"tags":[]},{"location":"database/grouper-db/#populate-database","level":3,"title":"Populate Database","text":"<p>TODO</p>","path":["Database Reference","Grouper Database"],"tags":[]},{"location":"database/grouper-db/#migrate-database","level":3,"title":"Migrate Database","text":"<p>TODO</p>","path":["Database Reference","Grouper Database"],"tags":[]},{"location":"database/keycloak-db/","level":1,"title":"Keycloak Database","text":"<p>This Database is used for Keycloak.</p>","path":["Database Reference","Keycloak Database"],"tags":[]},{"location":"database/keycloak-db/#initialize-database","level":2,"title":"Initialize database","text":"","path":["Database Reference","Keycloak Database"],"tags":[]},{"location":"database/keycloak-db/#access-database","level":3,"title":"Access Database","text":"<pre><code>ssh root@DB_HOST.com\npsql -U postgres\n</code></pre>","path":["Database Reference","Keycloak Database"],"tags":[]},{"location":"database/keycloak-db/#create-required-database-and-user","level":3,"title":"Create required Database and User","text":"<pre><code># create keycloak user\ncreate user keycloak with password '********';\n\n# create keycloak database\ncreate database keycloak with owner keycloak;\n</code></pre>","path":["Database Reference","Keycloak Database"],"tags":[]},{"location":"database/keycloak-db/#migrate-database","level":3,"title":"Migrate Database","text":"<p>TODO</p>","path":["Database Reference","Keycloak Database"],"tags":[]},{"location":"database/main/","level":1,"title":"Databases","text":"<p>CyVerse uses  PostgreSQL as its primary database platform.</p> <p>Each database is maintained in its own GitHub Repository in the core  CyVerse Organization or  CyVerse Discovery Environment Organization</p>","path":["Database Reference","Databases"],"tags":[]},{"location":"database/main/#provisioning","level":2,"title":"Provisioning","text":"<p> iCAT - the iRODS iCAT metadata database</p> <p> DE - the Discovery Environment database</p> <p> Metadata - the CyVerse Metadata Service</p> <p> Keycloak - the database used by Keycloak</p> <p> Notifications - the database used for notifications</p> <p> Unleash - the database used for Unleash service</p> <p> Grouper - the database for Grouper service</p> <p> QMS - the database for QMS service</p> <p> Portal - the User Portal database</p>","path":["Database Reference","Databases"],"tags":[]},{"location":"database/main/#user-guides","level":2,"title":"User Guides","text":"<p> DevOps - instructions for setting up a remote DevOps environment to manage a CyVerse deployment</p> <p>Discovery Environment - designed for data scientists, students, and researchers who want to use CyVerse for research.</p> <p>Data Store - instructions for using the iRODS Data Store.</p> <p>This database dedicated to the discovery environment of Cyverse, which is used for multiple services such as:</p> <ul> <li>de</li> <li>notifications</li> <li>metadata</li> <li>unleash</li> <li>grouper</li> <li>qms</li> <li>portal</li> <li>keycloak</li> </ul> <p>NOTE: permissions database has been merged with DE database.</p>","path":["Database Reference","Databases"],"tags":[]},{"location":"database/main/#install","level":2,"title":"Install","text":"<p>The installation of this database is manully done on the host <code>DB_HOST.com'</code>. See documentation on how to install postgresql?</p> <p>Installing postgresql 12 on Centos7</p> <pre><code>sudo yum install -y https://download.postgresql.org/pub/repos/yum/reporpms/EL-7-x86_64/pgdg-redhat-repo-latest.noarch.rpm\n\nsudo yum install -y postgresql12-server\nsudo /usr/pgsql-12/bin/postgresql-12-setup initdb\nsudo systemctl enable postgresql-12\nsudo systemctl start postgresql-12\nsudo yum install postgresql12-contrib\n</code></pre>","path":["Database Reference","Databases"],"tags":[]},{"location":"database/main/#setup","level":2,"title":"Setup","text":"<p>On this paragraph  we will cover first and necessary steps to configure the database.</p> <p>~postgres/12/data/pg_hba.conf</p> <p>IPv4 local connections:</p> <p>Add IP or IP range of kubernetes worker node, that requires connection to this database.</p> TYPE DATABASE USER ADDRESS METHOD host all all *******/32 md5 host all all *******/32 md5 host all all *******/32 md5 host all all *******/32 md5 host all all *******/32 md5 host all all *******/32 md5 <p>~postgres/12/data/postgresql.conf</p> <pre><code># vi ~postgres/12/data/postgresql.conf\nlisten_addresses = '*'          # what IP address(es) to listen on;\n</code></pre> <p>** .pgpass**</p> <p>TODO:</p>","path":["Database Reference","Databases"],"tags":[]},{"location":"database/main/#databases-and-its-users","level":3,"title":"Databases and its Users","text":"DATABASE USER de de notifications de metadata de unleash unleash_user grouper grouper portal portal keycloak keycloak qms de","path":["Database Reference","Databases"],"tags":[]},{"location":"database/metadata-db/","level":1,"title":"Metadata Database","text":"<p>This Database is used for CyVerse Metadata service.</p>","path":["Database Reference","Metadata Database"],"tags":[]},{"location":"database/metadata-db/#initialize-database","level":2,"title":"Initialize database","text":"","path":["Database Reference","Metadata Database"],"tags":[]},{"location":"database/metadata-db/#access-database","level":3,"title":"Access Database","text":"<pre><code>ssh root@DB_HOST.com\npsql -U postgres\n</code></pre>","path":["Database Reference","Metadata Database"],"tags":[]},{"location":"database/metadata-db/#create-required-database","level":3,"title":"Create required Database","text":"<pre><code># create metadata database with de user\ncreate database metadata with owner de;\n</code></pre>","path":["Database Reference","Metadata Database"],"tags":[]},{"location":"database/metadata-db/#add-required-extensions","level":3,"title":"Add required extensions","text":"<pre><code># psql -U postgres\n\\c metadata\ncreate extension \"uuid-ossp\";\ncreate extension \"moddatetime\";\ncreate extension \"btree_gist\";\n</code></pre>","path":["Database Reference","Metadata Database"],"tags":[]},{"location":"database/metadata-db/#populate-database","level":3,"title":"Populate Database","text":"<p>TODO</p>","path":["Database Reference","Metadata Database"],"tags":[]},{"location":"database/metadata-db/#migrate-database","level":3,"title":"Migrate Database","text":"<p>TODO</p>","path":["Database Reference","Metadata Database"],"tags":[]},{"location":"database/notifications-db/","level":1,"title":"Notifications Database","text":"<p>This Database is used for CyVerse notifications service.</p>","path":["Database Reference","Notifications Database"],"tags":[]},{"location":"database/notifications-db/#initialize-database","level":2,"title":"Initialize database","text":"","path":["Database Reference","Notifications Database"],"tags":[]},{"location":"database/notifications-db/#access-database","level":3,"title":"Access Database","text":"<pre><code>ssh root@DB_HOST.com\npsql -U postgres\n</code></pre>","path":["Database Reference","Notifications Database"],"tags":[]},{"location":"database/notifications-db/#create-required-database","level":3,"title":"Create required Database","text":"<pre><code># create notifications database with de owner.\ncreate database notifications with owner de;\n</code></pre>","path":["Database Reference","Notifications Database"],"tags":[]},{"location":"database/notifications-db/#add-required-extensions","level":3,"title":"Add required extensions","text":"<pre><code># psql -U postgres\n\\c notifications \ncreate extension \"uuid-ossp\";\ncreate extension \"moddatetime\";\ncreate extension \"btree_gist\";\n</code></pre>","path":["Database Reference","Notifications Database"],"tags":[]},{"location":"database/notifications-db/#populate-database","level":3,"title":"Populate Database","text":"<p>TODO</p>","path":["Database Reference","Notifications Database"],"tags":[]},{"location":"database/notifications-db/#migrate-database","level":3,"title":"Migrate Database","text":"<p>TODO</p>","path":["Database Reference","Notifications Database"],"tags":[]},{"location":"database/portal-db/","level":1,"title":"Portal Database","text":"<p>This Database is used for CyVerse User portal Service.</p>","path":["Database Reference","Portal Database"],"tags":[]},{"location":"database/portal-db/#initialize-database","level":2,"title":"Initialize database","text":"","path":["Database Reference","Portal Database"],"tags":[]},{"location":"database/portal-db/#access-database","level":3,"title":"Access Database","text":"<pre><code>ssh root@DB_HOST.com\npsql -U postgres\n</code></pre>","path":["Database Reference","Portal Database"],"tags":[]},{"location":"database/portal-db/#create-required-database-and-user","level":3,"title":"Create required Database and User","text":"<p>See also portal2/setup-database</p> <pre><code># create user\ncreate user portal_db_reader with password '********';\n\n# create portal database with the owner portal_db_reader\ncreate database portal with owner portal_db_reader;\n\n## Grant user to member of postgres\n# psql -U postgres\nGRANT postgres TO portal_db_reader;\n</code></pre>","path":["Database Reference","Portal Database"],"tags":[]},{"location":"database/portal-db/#restore-from-dump","level":3,"title":"Restore from dump","text":"<p>For this we have to download portal.sql file.</p> <pre><code># restore to user portal_db_reader and database portal\npsql -U portal_db_reader -d portal -f portal.sql\n</code></pre>","path":["Database Reference","Portal Database"],"tags":[]},{"location":"database/portal-db/#populate-database","level":3,"title":"Populate Database","text":"","path":["Database Reference","Portal Database"],"tags":[]},{"location":"database/portal-db/#make-sure-session-table-exist","level":4,"title":"make sure session Table exist","text":"<pre><code>CREATE TABLE public.session (\n    sid character varying NOT NULL,\n    sess json NOT NULL,\n    expire timestamp(6) without time zone NOT NULL\n);\nALTER TABLE public.session OWNER TO portal;\nCREATE INDEX \"IDX_session_expire\" ON public.session USING btree (expire);\n</code></pre>","path":["Database Reference","Portal Database"],"tags":[]},{"location":"database/portal-db/#import-grid-institutions","level":4,"title":"Import GRID institutions","text":"","path":["Database Reference","Portal Database"],"tags":[]},{"location":"database/portal-db/#download-required-grid-file","level":5,"title":"download required grid file","text":"<p>Official website</p> <pre><code># download grid\nwget https://digitalscience.figshare.com/ndownloader/files/30895309\n\n# unzip\nunzip 30895309\n</code></pre>","path":["Database Reference","Portal Database"],"tags":[]},{"location":"database/portal-db/#import-to-the-database","level":5,"title":"import to the database","text":"<p>For imorting this grid file we will use the script from portal2/scripts/import_grid_institutions.py.</p> <pre><code>./import_grid_institutions.py --host root@DB_HOST.com --user portal_db_reader --database portal grid.csv\n</code></pre>","path":["Database Reference","Portal Database"],"tags":[]},{"location":"database/portal-db/#populate-these-tables","level":4,"title":"Populate these Tables","text":"<p>These sql files can be found here.</p> <pre><code>psql -U portal_db_reader -d portal -f ./account_country.sql\npsql -U portal_db_reader -d portal -f ./account_region.sql\npsql -U portal_db_reader -d portal -f ./account_gender.sql\npsql -U portal_db_reader -d portal -f ./account_occupation.sql\npsql -U portal_db_reader -d portal -f ./account_ethnicity.sql\npsql -U portal_db_reader -d portal -f ./account_fundingagency.sql\npsql -U portal_db_reader -d portal -f ./account_awarechannel.sql\npsql -U portal_db_reader -d portal -f ./account_researcharea.sql\n</code></pre>","path":["Database Reference","Portal Database"],"tags":[]},{"location":"database/portal-db/#extra","level":2,"title":"Extra","text":"","path":["Database Reference","Portal Database"],"tags":[]},{"location":"database/portal-db/#give-admin-privilege-to-a-user","level":3,"title":"Give Admin privilege to a user","text":"<pre><code>--update is_superuser\nUPDATE account_user SET is_superuser = true WHERE username='USERNAME';\n\n---update is_staff \nUPDATE account_user SET is_staff = true WHERE username='USERNAME';\n</code></pre>","path":["Database Reference","Portal Database"],"tags":[]},{"location":"database/portal-db/#verify-user-email","level":3,"title":"Verify User email","text":"<pre><code>-- check if its verified\nselect has_verified_email from account_user where username='USERNAME';\n\n--Verify email\nUPDATE account_user SET has_verified_email = true WHERE username='USERNAME';\n</code></pre>","path":["Database Reference","Portal Database"],"tags":[]},{"location":"database/portal-db/#migrate-database","level":2,"title":"Migrate Database","text":"<p>TODO</p>","path":["Database Reference","Portal Database"],"tags":[]},{"location":"database/qms-db/","level":1,"title":"QMS Database","text":"<p>This Database is used for CyVerse QMS service.</p>","path":["Database Reference","QMS Database"],"tags":[]},{"location":"database/qms-db/#initialize-database","level":2,"title":"Initialize database","text":"","path":["Database Reference","QMS Database"],"tags":[]},{"location":"database/qms-db/#access-vm","level":3,"title":"Access vm","text":"<pre><code>ssh root@DB_HOST.com\n</code></pre>","path":["Database Reference","QMS Database"],"tags":[]},{"location":"database/qms-db/#create-required-database","level":3,"title":"Create required Database","text":"<pre><code># create qms database with de owner\ncreate database qms with owner de;\n</code></pre>","path":["Database Reference","QMS Database"],"tags":[]},{"location":"database/qms-db/#add-required-extensions","level":3,"title":"Add required extensions","text":"<pre><code># psql -U postgres\n\\c de\ncreate extension \"uuid-ossp\";\ncreate extension \"moddatetime\";\ncreate extension \"btree_gist\";\ncreate extension \"insert_username\";\n</code></pre>","path":["Database Reference","QMS Database"],"tags":[]},{"location":"database/qms-db/#populate-database","level":3,"title":"Populate Database","text":"<p>TODO</p>","path":["Database Reference","QMS Database"],"tags":[]},{"location":"database/qms-db/#migrate-database","level":3,"title":"Migrate Database","text":"<p>Once a while upon updating the k8s services, we would require to migrate the qms-database, to add the latest database changes.</p>","path":["Database Reference","QMS Database"],"tags":[]},{"location":"database/qms-db/#clone-qms-repo","level":4,"title":"Clone QMS repo","text":"<pre><code>git clone https://github.com/cyverse/QMS.git\ngit fetch &amp;&amp; git checkout prod\ncd QMS\n</code></pre>","path":["Database Reference","QMS Database"],"tags":[]},{"location":"database/qms-db/#install-golang-migrate","level":4,"title":"install golang-migrate","text":"<p>These steps are used on Ubuntu debian based OS.</p> <pre><code>curl -s https://packagecloud.io/install/repositories/golang-migrate/migrate/script.deb.sh | sudo bash\napt-get update\napt-get install -y migrate\n\n# check\nmigrate -help\n</code></pre>","path":["Database Reference","QMS Database"],"tags":[]},{"location":"database/qms-db/#run-to-migrate-qms-database","level":4,"title":"Run to migrate QMS database","text":"<p>Note: we are running the <code>/migration</code> directory from QMS</p> <pre><code>migrate -database postgres://USER:PASSWORD@DB_HOST.com/qms?sslmode=disable -path migrations up\n</code></pre>","path":["Database Reference","QMS Database"],"tags":[]},{"location":"database/unleash-db/","level":1,"title":"Unleash Database","text":"<p>This Database is used for CyVerse Unleash service.</p>","path":["Database Reference","Unleash Database"],"tags":[]},{"location":"database/unleash-db/#initialize-database","level":2,"title":"Initialize database","text":"","path":["Database Reference","Unleash Database"],"tags":[]},{"location":"database/unleash-db/#access-vm","level":3,"title":"Access vm","text":"<pre><code>ssh root@DB_HOST.com\n</code></pre>","path":["Database Reference","Unleash Database"],"tags":[]},{"location":"database/unleash-db/#create-required-database-and-user","level":3,"title":"Create required Database and User","text":"<pre><code># create unleash user\ncreate user unleash with password '********';\n\n# create unleash databased\ncreate database unleash with owner unleash;\n</code></pre>","path":["Database Reference","Unleash Database"],"tags":[]},{"location":"database/unleash-db/#add-required-extensions","level":3,"title":"Add required extensions","text":"<pre><code># psql -U postgres\n\\c unleash\ncreate extension \"uuid-ossp\";\ncreate extension \"moddatetime\";\ncreate extension \"btree_gist\";\n</code></pre>","path":["Database Reference","Unleash Database"],"tags":[]},{"location":"database/unleash-db/#populate-database","level":3,"title":"Populate Database","text":"<p>TODO</p>","path":["Database Reference","Unleash Database"],"tags":[]},{"location":"database/unleash-db/#migrate-database","level":3,"title":"Migrate Database","text":"<p>TODO</p>","path":["Database Reference","Unleash Database"],"tags":[]},{"location":"deployments/DiscoveryEnvironment/","level":1,"title":"Discovery Environment","text":"<p>Prerequisites</p> <ul> <li> <p>Make sure you have the <code>harbor-registry-credentials</code> secrets in your NAMESPACE, see also k8s-resources</p> </li> <li> <p>Make sure you have <code>de-nginx-tls</code> secret created, also see k8s-resources</p> </li> <li> <p>Make sure your Haproxy has the CA cert, Add <code>/docker-tugraz-data/ca/ca.pem</code> to <code>HAPROXY_DOMAIN</code>:/etc/ssl/certs/ca-bundle.crt`</p> </li> </ul> <p>remember <code>nginx</code> is proxying all the services to the DE in CyVerse.</p> <ul> <li>Use the manifest files from the k8s-resources</li> </ul>","path":["Deployment Guide","Application Services","Discovery Environment"],"tags":[]},{"location":"deployments/DiscoveryEnvironment/#change-hardcoded","level":3,"title":"Change hardcoded","text":"<p>If you are using a diffrent domain instead of <code>cyverse.tugraz.at</code>, e.g. <code>cyverse.at</code> - change these two files.</p> <p>/k8s-resources/resources/kustomize/de-nginx/base/nginx.conf</p> <pre><code>- server_name ~^[^.]+[.]cyverse[.]tugraz[.]at$;\n+ server_name ~^[^.]+[.]cyverse[.]at$;\n</code></pre> <p>k8s-resources/resources/kustomize/de-nginx/base/kustomization.yaml</p> <pre><code>- namespace: prod\n+ namespace: discover\n</code></pre>","path":["Deployment Guide","Application Services","Discovery Environment"],"tags":[]},{"location":"deployments/DiscoveryEnvironment/#deploy","level":3,"title":"Deploy","text":"<pre><code>## For prod env\nkubectl apply -k resources/kustomize/de-nginx/overlays/prod/ -n prod\nkubectl apply -f resources/services/tugraz.yml -n prod\n\n## For discover env\n# kubectl apply -k resources/kustomize/de-nginx/overlays/prod/ -n discover\n# kubectl apply -f resources/services/tugraz.yml -n discover\n</code></pre>","path":["Deployment Guide","Application Services","Discovery Environment"],"tags":[]},{"location":"deployments/RabbitMQ/","level":1,"title":"TODO","text":"<p>Prerequisites</p>","path":["Deployment Guide","Core Services","TODO"],"tags":[]},{"location":"deployments/RabbitMQ/#reindex-rabbitmq-jobs","level":2,"title":"Reindex RabbitMQ jobs","text":"","path":["Deployment Guide","Core Services","TODO"],"tags":[]},{"location":"deployments/RabbitMQ/#access-the-vm-where-the-rabbitmq-is-installed","level":3,"title":"access the vm where the RabbitMQ is installed.","text":"<pre><code>ssh root@RABBITMQ_HOST\n</code></pre>","path":["Deployment Guide","Core Services","TODO"],"tags":[]},{"location":"deployments/RabbitMQ/#configure-rabbitmqadmin","level":3,"title":"Configure rabbitmqadmin","text":"<p>This step you have to do only once, if the rabbitmqadmin is not present.</p> <pre><code>mkdir adm\ncd adm\nwget http://localhost:15672/cli/rabbitmqadmin\nchmod +x rabbitmqadmin\n</code></pre>","path":["Deployment Guide","Core Services","TODO"],"tags":[]},{"location":"deployments/RabbitMQ/#commands","level":3,"title":"Commands","text":"","path":["Deployment Guide","Core Services","TODO"],"tags":[]},{"location":"deployments/RabbitMQ/#discover","level":4,"title":"discover","text":"<pre><code># check status\nsystemctl status rabbitmq-server.service -l\n\n## add your password to a temp var\nread -s PASSWORD &amp;&amp; export PASSWORD\n\n# list exchange\n./rabbitmqadmin -V /cyverse/de list exchanges -u cyverse -p $PASSWORD\n\n# publish the message to reindex all\n./rabbitmqadmin publish -V /cyverse/de -u cyverse -p $PASSWORD exchange=de routing_key=index.all payload=\"\"\n\n# restart infosquito2\nkubectl rollout restart deployment infosquito2 -n discover\n# IF NOT deployed\n# ./deploy.py -Bn discover -p infosquito2 -C\n</code></pre>","path":["Deployment Guide","Core Services","TODO"],"tags":[]},{"location":"deployments/RabbitMQ/#prod","level":4,"title":"prod","text":"<pre><code>## add your password to a temp var\nread -s PASSWORD &amp;&amp; export PASSWORD\n\n# list\n./rabbitmqadmin -V /tugraz/de list exchanges -u tugraz -p $PASSWORD\n\n# publish the message to reindex all\n./rabbitmqadmin publish -V /tugraz/de -u tugraz -p $PASSWORD exchange=de routing_key=index.all payload=\"\"\n</code></pre>","path":["Deployment Guide","Core Services","TODO"],"tags":[]},{"location":"deployments/deployment_overview/","level":1,"title":"Deployment Overview","text":"<p>All deployments of CyVerse Products and Services are managed through Kubernetes.</p> <p>Each service is maintained in its own GitHub Repository in the core  CyVerse Organization or  CyVerse Discovery Environment Organization</p>","path":["Deployment Guide","Deployment Overview"],"tags":[]},{"location":"deployments/deployment_overview/#deployments","level":2,"title":"Deployments","text":"<p>All of CyVerse primary services and database deployments are containers, controled via fully managed  Kubernetes</p> <p> Discovery Environment - deploy primary data science workbench site</p> <p> Kubernetes (K8s) - deploy the main K8s cluster for running DE applications</p> <p> K8s Resources - deploy the various resources in DE managed by K8s</p> <p> K8s NameSpaces - list of namespaces used in DE</p> <p> User Portal - deploy the User Portal website via K8s</p> <p> OpenEBS - deploy K8s stateful workloads that require container attached storage</p> <p> KeyCloak - deploy K8s KeyCloak configuration</p> <p> Exim4 Mail - deploy <code>exim4</code> (MTA) running as a smarthost via K8s</p> <p> Redis HA - installing the Redis Server and Redis Haproxy</p> <p> ElasticSearch - deploy stateful set ES cluster</p> <p> RabbitMQ - deploy RabbitMQ services</p> <p> Unleash - deploy the Unleash database</p> <p> Grouper - Internet2 Grouper Service</p> <p> iRODS CSI Driver - K8s Container Storage Interface (CSI Driver) for iRODS</p> <p> Local Exim - verification of email using Exim</p> <p> VICE - Manage K8s interactive jobs in DE</p> <p> Jaeger - open-source end-to-end distributed tracing</p> <p>  Data Store - deploy the CyVerse data Store</p>","path":["Deployment Guide","Deployment Overview"],"tags":[]},{"location":"deployments/elasticsearch/","level":1,"title":"Elasticsearch","text":"<p>Deploying the <code>statefulsets</code> Elasticsearch cluster on kubernetes.</p> <p>Prerequisites</p> <ul> <li> <p>clone the repo </p> </li> <li> <p>see also k8s-resources</p> </li> <li> <p><code>cd /k8s-resources</code></p> </li> <li> <p>In case you have limited resources change these:</p> </li> </ul> <p><code>cd /k8s-resources/resources/addons/elasticsearch/elasticsearch.yml</code></p> <pre><code>```yaml\n  replicas: 2\n    resources:\n      requests:\n        memory: \"4Gi\"\n      limits:\n        memory: \"4Gi\"\n      - name: ES_JAVA_OPTS\n        value: \"-Xms2g -Xmx2g\"\n```\n</code></pre>","path":["Deployment Guide","Core Services","Elasticsearch"],"tags":[]},{"location":"deployments/elasticsearch/#deploy","level":3,"title":"Deploy","text":"<pre><code># deploy ES on prod env\nkubectl apply -n prod -f resources/addons/elasticsearch/elasticsearch.yml\n\n## deploy ES on discover env\n# kubectl apply -n discover -f resources/addons/elasticsearch/elasticsearch.yml\n</code></pre>","path":["Deployment Guide","Core Services","Elasticsearch"],"tags":[]},{"location":"deployments/elasticsearch/#indexing","level":2,"title":"Indexing","text":"","path":["Deployment Guide","Core Services","Elasticsearch"],"tags":[]},{"location":"deployments/elasticsearch/#preq","level":3,"title":"Preq","text":"<p>Save below json to a file <code>settings.json</code>, we will use this file to index our elasticsearch.</p> <pre><code>{\n    \"mappings\": {\n      \"file\": {\n        \"properties\": {\n          \"creator\": {\n            \"type\": \"keyword\"\n          },\n          \"dateCreated\": {\n            \"type\": \"date\"\n          },\n          \"dateModified\": {\n            \"type\": \"date\"\n          },\n          \"fileSize\": {\n            \"type\": \"long\"\n          },\n          \"fileType\": {\n            \"type\": \"keyword\"\n          },\n          \"id\": {\n            \"type\": \"keyword\"\n          },\n          \"label\": {\n            \"type\": \"text\",\n            \"fields\": {\n              \"keyword\": {\n                \"type\": \"keyword\"\n              }\n            },\n            \"analyzer\": \"irods_entity\"\n          },\n          \"metadata\": {\n            \"type\": \"nested\",\n            \"properties\": {\n              \"attribute\": {\n                \"type\": \"text\",\n                \"analyzer\": \"irods_entity\"\n              },\n              \"unit\": {\n                \"type\": \"keyword\"\n              },\n              \"value\": {\n                \"type\": \"text\"\n              }\n            }\n          },\n          \"path\": {\n            \"type\": \"text\",\n            \"fields\": {\n              \"keyword\": {\n                \"type\": \"keyword\"\n              }\n            },\n            \"analyzer\": \"irods_path\"\n          },\n          \"userPermissions\": {\n            \"type\": \"nested\",\n            \"properties\": {\n              \"permission\": {\n                \"type\": \"keyword\"\n              },\n              \"user\": {\n                \"type\": \"keyword\"\n              }\n            }\n          }\n        }\n      },\n      \"tag\": {\n        \"properties\": {\n          \"creator\": {\n            \"type\": \"keyword\"\n          },\n          \"dateCreated\": {\n            \"type\": \"date\"\n          },\n          \"dateModified\": {\n            \"type\": \"date\"\n          },\n          \"description\": {\n            \"type\": \"text\"\n          },\n          \"id\": {\n            \"type\": \"keyword\"\n          },\n          \"targets\": {\n            \"type\": \"nested\",\n            \"properties\": {\n              \"id\": {\n                \"type\": \"keyword\"\n              },\n              \"type\": {\n                \"type\": \"keyword\"\n              }\n            }\n          },\n          \"value\": {\n            \"type\": \"text\",\n            \"analyzer\": \"tag_value\"\n          }\n        }\n      },\n      \"file_metadata\": {\n        \"_parent\": {\n          \"type\": \"file\"\n        },\n        \"_routing\": {\n          \"required\": true\n        },\n        \"properties\": {\n          \"id\": {\n            \"type\": \"keyword\"\n          },\n          \"metadata\": {\n            \"type\": \"nested\",\n            \"properties\": {\n              \"attribute\": {\n                \"type\": \"text\",\n                \"analyzer\": \"irods_entity\"\n              },\n              \"unit\": {\n                \"type\": \"keyword\"\n              },\n              \"value\": {\n                \"type\": \"text\"\n              }\n            }\n          }\n        }\n      },\n      \"folder\": {\n        \"properties\": {\n          \"creator\": {\n            \"type\": \"keyword\"\n          },\n          \"dateCreated\": {\n            \"type\": \"date\"\n          },\n          \"dateModified\": {\n            \"type\": \"date\"\n          },\n          \"fileSize\": {\n            \"type\": \"long\"\n          },\n          \"fileType\": {\n            \"type\": \"keyword\"\n          },\n          \"id\": {\n            \"type\": \"keyword\"\n          },\n          \"label\": {\n            \"type\": \"text\",\n            \"fields\": {\n              \"keyword\": {\n                \"type\": \"keyword\"\n              }\n            },\n            \"analyzer\": \"irods_entity\"\n          },\n          \"metadata\": {\n            \"type\": \"nested\",\n            \"properties\": {\n              \"attribute\": {\n                \"type\": \"text\",\n                \"analyzer\": \"irods_entity\"\n              },\n              \"unit\": {\n                \"type\": \"keyword\"\n              },\n              \"value\": {\n                \"type\": \"text\"\n              }\n            }\n          },\n          \"path\": {\n            \"type\": \"text\",\n            \"fields\": {\n              \"keyword\": {\n                \"type\": \"keyword\"\n              }\n            },\n            \"analyzer\": \"irods_path\"\n          },\n          \"userPermissions\": {\n            \"type\": \"nested\",\n            \"properties\": {\n              \"permission\": {\n                \"type\": \"keyword\"\n              },\n              \"user\": {\n                \"type\": \"keyword\"\n              }\n            }\n          }\n        }\n      },\n      \"folder_metadata\": {\n        \"_parent\": {\n          \"type\": \"folder\"\n        },\n        \"_routing\": {\n          \"required\": true\n        },\n        \"properties\": {\n          \"id\": {\n            \"type\": \"keyword\"\n          },\n          \"metadata\": {\n            \"type\": \"nested\",\n            \"properties\": {\n              \"attribute\": {\n                \"type\": \"text\",\n                \"analyzer\": \"irods_entity\"\n              },\n              \"unit\": {\n                \"type\": \"keyword\"\n              },\n              \"value\": {\n                \"type\": \"text\"\n              }\n            }\n          }\n        }\n      }\n    },\n    \"settings\": {\n      \"index\": {\n        \"mapper\": {\n          \"dynamic\": \"false\"\n        },\n        \"analysis\": {\n          \"analyzer\": {\n            \"irods_entity\": {\n              \"filter\": [\n                \"asciifolding\",\n                \"lowercase\"\n              ],\n              \"type\": \"custom\",\n              \"tokenizer\": \"irods_entity\"\n            },\n            \"irods_path\": {\n              \"type\": \"custom\",\n              \"tokenizer\": \"irods_path\"\n            },\n            \"tag_value\": {\n              \"filter\": [\n                \"asciifolding\",\n                \"lowercase\"\n              ],\n              \"type\": \"custom\",\n              \"tokenizer\": \"keyword\"\n            }\n          },\n          \"tokenizer\": {\n            \"irods_entity\": {\n              \"type\": \"keyword\",\n              \"buffer_size\": \"2700\"\n            },\n            \"irods_path\": {\n              \"type\": \"path_hierarchy\",\n              \"buffer_size\": \"2700\"\n            }\n          }\n        },\n        \"number_of_replicas\": \"1\"\n      }\n    }\n  }\n</code></pre>","path":["Deployment Guide","Core Services","Elasticsearch"],"tags":[]},{"location":"deployments/elasticsearch/#index","level":3,"title":"Index","text":"<p>For indexing we will run a container inside your namespace where the elasticsearch is running, and copy the <code>settings.json</code> file inside this container and run the following commands:</p> <pre><code>## run container if es in prod namespace\nkubectl run --namespace=prod --rm utils -it --image arunvelsriram/utils bash\n\n## run container if es in discover namespace\n# kubectl run --namespace=discover --rm utils -it --image arunvelsriram/utils bash\n\n######### PS open a new terminal#########\n## copy the settings.json if PROD\nkubectl -n prod cp settings.json utils:/home/utils\n\n## copy the settings.json if Discover\n# kubectl -n discover cp settings.json utils:/home/utils\n</code></pre>","path":["Deployment Guide","Core Services","Elasticsearch"],"tags":[]},{"location":"deployments/elasticsearch/#run-indexing","level":4,"title":"run indexing","text":"<p>Inside the running container shell run this command to add the indexes.</p> <pre><code># check elasticsearch health\ncurl -XGET \"http://elasticsearch:9200/_cluster/health?pretty\"\n\n# run indexing from file\ncurl -sX PUT \"http://elasticsearch:9200/data\" -d @settings.json\n</code></pre>","path":["Deployment Guide","Core Services","Elasticsearch"],"tags":[]},{"location":"deployments/elasticsearch/#optional-delete-current-indexes","level":4,"title":"(optional) delete current indexes","text":"<pre><code># delete data indexes\ncurl -sX DELETE \"http://elasticsearch:9200/data\"\n\n# delete everything\ncurl -sX DELETE \"http://elasticsearch:9200/*\"\n</code></pre>","path":["Deployment Guide","Core Services","Elasticsearch"],"tags":[]},{"location":"deployments/elasticsearch/#restart-related-services","level":4,"title":"restart related services","text":"<pre><code># kubectl rollout restart statefulset elasticsearch -n prod # not sure\nkubectl rollout restart deployment infosquito2 search -n &lt;NAMESPACE&gt;\n</code></pre>","path":["Deployment Guide","Core Services","Elasticsearch"],"tags":[]},{"location":"deployments/exim4/","level":1,"title":"Mail","text":"<p>Prerequisites</p> <p>exim4-helm</p> <p>A Helm chart to provide a exim4 deployment, exim4 (MTA) running as a smarthost.</p>","path":["Deployment Guide","Application Services","Mail"],"tags":[]},{"location":"deployments/exim4/#deploy","level":2,"title":"Deploy","text":"","path":["Deployment Guide","Application Services","Mail"],"tags":[]},{"location":"deployments/exim4/#add-update-helm-chart","level":3,"title":"Add &amp; update helm chart","text":"<pre><code>helm repo add exim4 https://mb-wali.github.io/exim4-helm\nhelm repo update\n</code></pre>","path":["Deployment Guide","Application Services","Mail"],"tags":[]},{"location":"deployments/exim4/#install","level":3,"title":"Install","text":"<pre><code># replace the secrets with yours\nhelm install exim4 --set secrets.EXIM_SMARTHOST='localhost',secrets.EXIM_PASSWORD='passw0rd',secrets.EXIM_ALLOWED_SENDERS='*' exim4/exim4 --namespace mail --create-namespace --wait\n</code></pre>","path":["Deployment Guide","Application Services","Mail"],"tags":[]},{"location":"deployments/exim4/#debugging","level":3,"title":"Debugging","text":"<p>Once the pod is running</p> <pre><code># execute shell \nkubectl exec -it exim4-6ff546fb9f-ff47m -- bash\n\n# send a test mail\necho \"This is test\" | mail -s \"The subject\" receiver@myhost.com -aFrom:sender@myhost.com\n</code></pre>","path":["Deployment Guide","Application Services","Mail"],"tags":[]},{"location":"deployments/exim4/#usage","level":3,"title":"Usage","text":"<p>Use your deployed exim4 to send mails,  e.g. connect from a another service.</p> <pre><code>SMTP_HOST=exim4.mail.svc.cluster.local\n</code></pre>","path":["Deployment Guide","Application Services","Mail"],"tags":[]},{"location":"deployments/grouper/","level":1,"title":"Grouper","text":"<p>Prerequisites</p> <ul> <li>Make sure <code>grouper</code> database is setup, see also grouper-db</li> </ul>","path":["Deployment Guide","Supporting Services","Grouper"],"tags":[]},{"location":"deployments/grouper/#deploy","level":2,"title":"Deploy","text":"<p>Grouper consist of two deployments, <code>grouper-loader</code> &amp; <code>grouper-ws</code>.</p>","path":["Deployment Guide","Supporting Services","Grouper"],"tags":[]},{"location":"deployments/grouper/#grouper-loader","level":3,"title":"grouper-loader","text":"<pre><code>## Deploy for prod env\nkubectl apply -f resources/deployments/grouper-loader.yml -n prod\n\n## Deploy for discover env\n# kubectl apply -f resources/deployments/grouper-loader.yml -n discover\n</code></pre>","path":["Deployment Guide","Supporting Services","Grouper"],"tags":[]},{"location":"deployments/grouper/#grouper-ws","level":3,"title":"grouper-ws","text":"<pre><code>## Deploy for prod env\nkubectl apply -f resources/deployments/grouper-ws.yml -n prod\n\n## Deploy for discover env\n# kubectl apply -f resources/deployments/grouper-ws.yml -n discover\n</code></pre>","path":["Deployment Guide","Supporting Services","Grouper"],"tags":[]},{"location":"deployments/ingress-nginx/","level":1,"title":"ingress-nginx","text":"<p>Prerequisites</p> <p>ingress-nginx is used to give vice-apps ingresses, using nodeport and what not.</p>","path":["Deployment Guide","Core Infrastructure","ingress-nginx"],"tags":[]},{"location":"deployments/ingress-nginx/#deploy","level":2,"title":"deploy","text":"<p>The deployment manifests are in k8s-resources.</p>","path":["Deployment Guide","Core Infrastructure","ingress-nginx"],"tags":[]},{"location":"deployments/ingress-nginx/#optional-changing-the-env","level":3,"title":"(optional) changing the env","text":"<p>Modify file <code>resources/kustomize/ingress-nginx/overlays/prod/args.yaml</code>, to change the namespace.</p> <pre><code>- --default-backend-service=prod/vice-default-backend\n+ --default-backend-service=discover/vice-default-backend\n</code></pre>","path":["Deployment Guide","Core Infrastructure","ingress-nginx"],"tags":[]},{"location":"deployments/ingress-nginx/#deploy-kustomize","level":3,"title":"Deploy kustomize","text":"<p>This script will create a namespace <code>ingress-nginx</code>.</p> <pre><code>kubectl apply -k resources/kustomize/ingress-nginx/overlays/prod\n</code></pre>","path":["Deployment Guide","Core Infrastructure","ingress-nginx"],"tags":[]},{"location":"deployments/irods-csi-driver/","level":1,"title":"iRODS CSI Driver","text":"<p>iRODS Container Storage Interface (CSI) Driver implements the CSI Specification to provide container orchestration engines (like Kubernetes) iRODS access.</p> <p>Prerequisites</p> <p>Before we install <code>irods-csi-driver</code>, we need to create a <code>values.yaml</code> file.</p> <p>Change the values accordingly and save the file as <code>values.yaml</code>.</p> <pre><code>globalConfig:\n  secret:\n    stringData:\n      client: \"irodsfuse\"\n      host: &lt;IRODS-SERVER-HOST&gt;\n      port: \"1247\"\n      zone: \"TUG\"\n      user: &lt;IRODS-ADMIN-USER&gt;\n      password: &lt;PASSWORD&gt;\n      retainData: \"false\"\n      enforceProxyAccess: \"true\"\n      mountPathWhitelist: \"/TUG/home\"\nnodeService:\n  irodsPool:\n    extraArgs:\n      - --cache_size_max=10737418240\n      - --cache_root=/irodsfs_pool_cache\n      - '--cache_timeout_settings=[{\"path\":\"/\",\"timeout\":\"-1ns\",\"inherit\":false},{\"path\":\"/TUG\",\"timeout\":\"-1ns\",\"inherit\":false},{\"path\":\"/TUG/home\",\"timeout\":\"5m\",\"inherit\":false},{\"path\":\"/TUG/home/shared\",\"timeout\":\"5m\",\"inherit\":true}]'\n</code></pre>","path":["Deployment Guide","Core Infrastructure","iRODS CSI Driver"],"tags":[]},{"location":"deployments/irods-csi-driver/#deploy","level":2,"title":"Deploy","text":"<p>we use helm to deploy irods-csi-driver.</p> <pre><code># Add the Helm repository.\nhelm repo add irods-csi-driver-repo https://cyverse.github.io/irods-csi-driver-helm/\n\n# Update the local repository caches.\nhelm repo update\n\n# create namespace\nkubectl create namespace irods-csi-driver\n\n# install csi-driver\n# make sure to edit values-cyverse.at.yaml\nhelm install -n irods-csi-driver irods-csi-driver irods-csi-driver-repo/irods-csi-driver -f ./values.yaml\n\n# or upgrade\nhelm upgrade -n irods-csi-driver irods-csi-driver irods-csi-driver-repo/irods-csi-driver -f ./values.yaml\n</code></pre>","path":["Deployment Guide","Core Infrastructure","iRODS CSI Driver"],"tags":[]},{"location":"deployments/irods-csi-driver/#upgrading-to-a-newer-version","level":2,"title":"Upgrading to a newer version","text":"<p>When we want to upgrade the <code>irods-csi-driver</code> to a newer version, we need to stop all running vice-apps and delete all the pvcs.</p> <pre><code># update helm repo\nhelm repo update\n\n# delete the pvc\nkubectl delete pvc -l app-type=interactive -n vice-apps\n\n# uninstall the irods-csi-driver\nhelm uninstall irods-csi-driver -n irods-csi-driver\n\n# delete all the vice-apps deployments\n## see below for the content of this file\n./nuke-vice-analysis.sh $(kubectl get deployments -n vice-apps -l app-type=interactive -o name)\n\n# install again\nhelm install -n irods-csi-driver irods-csi-driver irods-csi-driver-repo/irods-csi-driver -f values.yaml\n</code></pre>","path":["Deployment Guide","Core Infrastructure","iRODS CSI Driver"],"tags":[]},{"location":"deployments/irods-csi-driver/#install-specific-version","level":2,"title":"install specific version","text":"<pre><code>helm install -n irods-csi-driver irods-csi-driver --version 0.8.7 irods-csi-driver-repo/irods-csi-driver -f values.yaml\n\n## try the latest\nhelm install -n irods-csi-driver irods-csi-driver --version 0.9.2 irods-csi-driver-repo/irods-csi-driver -f values.yaml\n</code></pre>","path":["Deployment Guide","Core Infrastructure","iRODS CSI Driver"],"tags":[]},{"location":"deployments/irods-csi-driver/#note","level":2,"title":"NOTE","text":"<p>With <code>irods-csi-driver</code> version &gt; 0.8.7, thereâs a small change on the configuration file <code>user_config.yaml</code> for driver installation. You will need to delete --cache_root and --temp_root flags if you used it.</p>","path":["Deployment Guide","Core Infrastructure","iRODS CSI Driver"],"tags":[]},{"location":"deployments/irods-csi-driver/#nuke-vice-analysissh","level":1,"title":"nuke-vice-analysis.sh","text":"<pre><code>function delete_resources() {\n    local external_id=\"$1\"\n    kubectl -n vice-apps delete deployment \"${external_id}\"\n    kubectl -n vice-apps delete service \"vice-${external_id}\"\n    kubectl -n vice-apps delete ingress \"${external_id}\"\n    kubectl -n vice-apps delete configmap \"excludes-file-${external_id}\"\n    kubectl -n vice-apps delete configmap \"input-path-list-${external_id}\"\n}\n\nfunction remove_deployment_prefix() {\n    local external_id=\"$1\"\n    echo -n \"$external_id\" | sed 's;^deployment.apps/;;'\n}\n\n# Iterate over all arguments on the command line.\nfor id in \"$@\"; do\n    delete_resources $(remove_deployment_prefix \"$id\")\ndone\n</code></pre>","path":["Deployment Guide","Core Infrastructure","iRODS CSI Driver"],"tags":[]},{"location":"deployments/jaeger/","level":1,"title":"jaeger","text":"<p>Jaeger: open source, end-to-end distributed tracing</p> <p>Prerequisites</p>","path":["Deployment Guide","Core Services","jaeger"],"tags":[]},{"location":"deployments/jaeger/#deploy","level":2,"title":"Deploy","text":"<p>The deployment manifests are in k8s-resources.</p> <p>Create namespace <pre><code>kubectl create ns jaeger\n</code></pre></p> <p>(optional) changing the env</p> <p>Modify files to change the namespace:</p> <ul> <li><code>resources/addons/jaeger/collector.yaml</code></li> <li><code>resources/addons/jaeger/query.yaml</code></li> <li><code>resources/addons/jaeger/rollover-cron.yaml</code></li> </ul> <pre><code>- \"http://elasticsearch.prod:9200\"\n+ \"http://elasticsearch.discover:9200\"\n</code></pre> <p>Apply manifests <pre><code>kubectl apply -f resources/addons/jaeger/rollover-cron.yaml -n jaeger\nkubectl apply -f resources/addons/jaeger/query.yaml -n jaeger\nkubectl apply -f resources/addons/jaeger/collector.yaml -n jaeger\n</code></pre></p>","path":["Deployment Guide","Core Services","jaeger"],"tags":[]},{"location":"deployments/k8s-namespace/","level":1,"title":"Namespaces","text":"<p>List of namespaces used for CyVerse deployment in kubernetes.</p> <p>Prerequisites</p> <p>Note: this documentation is relavant only for single/current environment.</p> <p></p>","path":["Deployment Guide","Core Infrastructure","Namespaces"],"tags":[]},{"location":"deployments/k8s-namespace/#prod","level":2,"title":"prod","text":"<p>This namespace is dedicated to the core services &amp; some of non-core services such as :</p> <ul> <li>redis-ha</li> <li>redis-haproxy</li> <li>elasticsearch</li> </ul> <p>Except the irods-csi-driver which runs in a specific namespace.</p>","path":["Deployment Guide","Core Infrastructure","Namespaces"],"tags":[]},{"location":"deployments/k8s-namespace/#ingress-nginx","level":2,"title":"ingress-nginx","text":"<p>This namespace is dedicated to the ingress-nginx deployment.</p>","path":["Deployment Guide","Core Infrastructure","Namespaces"],"tags":[]},{"location":"deployments/k8s-namespace/#vice-apps","level":2,"title":"vice-apps","text":"<p>This namespace is dedicated to the VICE related deployment and configurations.</p>","path":["Deployment Guide","Core Infrastructure","Namespaces"],"tags":[]},{"location":"deployments/k8s-namespace/#keycloak","level":2,"title":"keycloak","text":"<p>This namespace is dedicated to Keycloak related deployment and configurations.</p>","path":["Deployment Guide","Core Infrastructure","Namespaces"],"tags":[]},{"location":"deployments/k8s-namespace/#openebs","level":2,"title":"openebs","text":"<p>This namespace is dedicated to the openebs deployment. OpenEBS turns any storage available on the Kubernetes worker nodes into local or distributed Kubernetes Persistent Volumes.</p>","path":["Deployment Guide","Core Infrastructure","Namespaces"],"tags":[]},{"location":"deployments/k8s-namespace/#irods-csi-driver","level":2,"title":"irods-csi-driver","text":"<p>This namespace is dedicated to the irods-csi-driver deployment and configurations.</p>","path":["Deployment Guide","Core Infrastructure","Namespaces"],"tags":[]},{"location":"deployments/k8s-resources/","level":1,"title":"k8s-resources","text":"<p>This repository includes all the manifests and resources for kubernetes deployment.</p> <p>Prerequisites</p>","path":["Deployment Guide","Core Infrastructure","k8s-resources"],"tags":[]},{"location":"deployments/k8s-resources/#clone","level":2,"title":"Clone","text":"<pre><code>git clone git@gitlab.cyverse.org:tugraz/k8s-resources.git\n</code></pre>","path":["Deployment Guide","Core Infrastructure","k8s-resources"],"tags":[]},{"location":"deployments/k8s-resources/#generate-configsecrets-for-prod-env","level":2,"title":"Generate config/secrets for prod env","text":"<p>Make sure gomplate is installed in your OS.</p> <p>Here is an example on ubuntu:</p> <pre><code>sudo curl -o /usr/local/bin/gomplate -sSL https://github.com/hairyhenderson/gomplate/releases/download/v3.10.0/gomplate_linux-amd64\n\nsudo chmod 755 /usr/local/bin/gomplate\n\ngomplate --help\n</code></pre> <p>Generate configs/secrets <pre><code>./generate_configs.py -e prod\n./generate_secrets.py -e prod\n</code></pre></p>","path":["Deployment Guide","Core Infrastructure","k8s-resources"],"tags":[]},{"location":"deployments/k8s-resources/#load-configsecrets-in-your-cluster-for-prod-env","level":2,"title":"Load config/secrets in your cluster for prod env","text":"<pre><code>./load_configs.py -e prod -n prod\n./load_secrets.py -e prod -n prod\n</code></pre>","path":["Deployment Guide","Core Infrastructure","k8s-resources"],"tags":[]},{"location":"deployments/k8s-resources/#deploy-services","level":2,"title":"Deploy services","text":"","path":["Deployment Guide","Core Infrastructure","k8s-resources"],"tags":[]},{"location":"deployments/k8s-resources/#preq","level":3,"title":"preq","text":"<p>Before we start to deploy the services we need to create these secrets, and install some dependencies.</p> <ul> <li><code>vice-image-pull-secret</code> TODO: kubectl apply.</li> <li><code>harbor-registry-credentials</code> TODO: kubectl apply.</li> </ul> <p>These secrets below can be deployed using: <code>git clone -b discover https://gitlab.cyverse.org/tugraz/docker-tugraz-data</code> see also cyverse.at repo.</p> <ul> <li><code>gpg-keys</code></li> <li><code>ui-nginx-tls</code></li> <li><code>gpg-keys</code></li> <li><code>pgpass-files</code></li> <li><code>signing-keys</code></li> <li><code>accepted-keys</code></li> <li><code>ssl-files</code></li> <li>Make sure elasticsearch is deployed.</li> <li>Make sure skaffold is installed in your OS.     <pre><code># For Linux x86_64 (amd64)\ncurl -Lo skaffold https://storage.googleapis.com/skaffold/releases/latest/skaffold-linux-amd64\n\nsudo install skaffold /usr/local/bin/\n\n# check\nskaffold --help\n</code></pre></li> <li>Make sure ServiceAccounts are created:   <pre><code># For prod env\nkubectl apply -f /k8s-resources/resources/serviceaccounts/app-exposer.yml -n prod\n\n## For discover env\n# kubectl apply -f /k8s-resources/resources/serviceaccounts/app-exposer.yml -n discover\n</code></pre></li> </ul>","path":["Deployment Guide","Core Infrastructure","k8s-resources"],"tags":[]},{"location":"deployments/k8s-resources/#todo-above","level":4,"title":"TODO above","text":"","path":["Deployment Guide","Core Infrastructure","k8s-resources"],"tags":[]},{"location":"deployments/k8s-resources/#deploy","level":3,"title":"Deploy","text":"<p>This command will deploy all the services listed on <code>k8s-resources/repos</code></p> <pre><code># deploy services for prod env\n./deploy.py -n prod -BCa\n\n## deploy services for discover env\n# ./deploy.py -n discover -BCa\n</code></pre>","path":["Deployment Guide","Core Infrastructure","k8s-resources"],"tags":[]},{"location":"deployments/k8s-resources/#deploy-single-service","level":4,"title":"Deploy single service","text":"<p>If you want to deploy a single service, e.g. <code>search</code> <pre><code>## Run for the prod env\n./deploy.py -Bn prod -p search -C\n\n## Run for the discover env\n# ./deploy.py -Bn discover -p search -C\n</code></pre></p>","path":["Deployment Guide","Core Infrastructure","k8s-resources"],"tags":[]},{"location":"deployments/k8s-resources/#create-a-new-env","level":1,"title":"create a new env","text":"<p>Currently we have <code>prod</code> environment which is our productive instance.</p> <p>Create your environment: <code>cp config_values/prod.yaml config_values/discover.yaml</code> This will create a new config file for your environment. You will have to update all the values as you see fit for your environment.</p> <p>fill in all these values: <pre><code># discover.yaml\n---\nEnvironment:\n\nAgave:\n  Key:\n  Secret:\n  RedirectURI:\n  StorageSystem:\n  CallbackBaseURI:\n  ReadTimeout:\n  Enabled:\n  JobsEnabled:\n\nAMQP:\n  URI:\n\nAnonFiles:\n  BaseURI:\n\nAppExposer:\n  BaseURI:\n\nBaseURLs:\n  Analyses:\n  Apps:\n  AsyncTasks:\n  DashboardAggregator:\n  DataInfo:\n  GrouperWebServices:\n  IplantEmail:\n  IplantGroups:\n  JexAdapter:\n  Metadata:\n  Notifications:\n  Permissions:\n  Requests:\n  Search:\n  Terrain:\n  UserInfo:\n\nCAS:\n  BaseURI:\n  ServerName:\n  UIDDomain:\n\nDashboardAggregator:\n  PublicGroup:\n  LogLevel:\n\nDataOne:\n  BaseURI:\n\nDE:\n  Version:\n  VersionName:\n  AMQP:\n    URI:\n  Host:\n  BaseURI:\n  Legacy:\n    BaseURI:\n  Subscriptions:\n    CheckoutURL:\n  KeepAlive:\n    Service:\n    Target:\n  ContextMenu:\n    Enabled:\n  BaseTrash:\n    Path:\n  ProdDeployment:\n  DefaultOutputFolder:\n  WSO2:\n    JWTHeader:\n  Coge:\n    BaseURI:\n  Tools:\n    Admin:\n      MaxCpuLimit:\n      MaxMemoryLimit:\n      MaxDiskLimit:\n\nDocker:\n  TrustedRegistries:\n  Tag:\n\nElasticsearch:\n  BaseURI:\n  Username:\n  Password:\n  Index:\n\nEmail:\n  AppDeletion:\n    Src:\n    Dest:\n  AppPublicationRequest:\n    Src:\n    Dest:\n  ToolRequest:\n    Src:\n    Dest:\n  PermIDRequest:\n    Src:\n    Dest:\n  Support:\n    Src:\n    Dest:\n\nGrouper:\n  Environment:\n  MorphString:\n  WebService:\n    Password:\n  Password:\n  DB:\n    User:\n    Password:\n    Host:\n    Port:\n    Name:\n  FolderNamePrefix:\n  Loader:\n    URI:\n    User:\n    Password:\n  SubjectSource:\n    ID:\n    Name:\n    SearchBase:\n\nICAT:\n  Host:\n  Port:\n  User:\n  Password:\n\nInfosquito:\n  DayNum:\n  PrefixLength:\n\nInteractiveApps:\n  BaseURI:\n  ServiceSuffix:\n\nIntercom:\n  AppID:\n  CompanyID:\n  CompanyName:\n  Intercom:\n\nIRODS:\n  AMQP:\n    URI:\n  Host:\n  User:\n  Zone:\n  Password:\n  AdminUsers:\n  PermsFilter:\n  ExternalHost:\n  QuotaRootResources:\n\nJobs:\n  DataTransferImage:\n\nJobStatusListener:\n  BaseURI:\n\nKeycloak:\n  ServerURI:\n  Realm:\n  ClientID:\n  ClientSecret:\n  VICE:\n    ClientID:\n    ClientSecret:\n\nKifshare:\n  ExternalUri:\n\nPGP:\n  KeyPassword:\n\nPermanentID:\n  CuratorsGroup:\n  DataCite:\n    BaseURI:\n    User:\n    Password:\n    DOIPrefix:\n\nRedis:\n  Host:\n  Port:\n  HA:\n    Name:\n  Password:\n  DB:\n    Number:\n\nTimeZone:\n\nVault:\n  Token:\n  URL:\n  IRODS:\n    MountPath:\n    ChildToken:\n      UseLimit:\n\nVICE:\n  DB:\n    User:\n    Password:\n    Host:\n    Port:\n    Name:\n  FileTransfers:\n    Image:\n    Tag:\n  JobStatus:\n    BaseURI:\n  K8sEnabled:\n  BackendNamespace:\n  ImagePullSecret:\n  ImageCache:\n  UseCSIDriver:\n  DefaultImage:\n  DefaultName:\n  DefaultCasUrl:\n  DefaultCasValidate:\n  ConcurrentJobs:\n  UseCaseCharsMin:\n  DefaultBackend:\n    LoadingPageTemplateString:\n\nSonora:\n  BaseURI:\n\nTerrain:\n  CASClientID:\n  CASClientSecret:\n  JWT:\n    SigningKey:\n      Password:\n\nUnleash:\n  BaseUrl:\n  APIPath:\n  APIToken:\n  MaintenanceFlag:\n\nUserPortal:\n  BaseURI:\n\nDEDB:\n  User:\n  Password:\n  Host:\n  Port:\n  Name:\n\nNewNotificationsDB:\n  User:\n  Password:\n  Host:\n  Port:\n  Name:\n\nNotificationsDB:\n  User:\n  Password:\n  Host:\n  Port:\n  Name:\n\nPermissionsDB:\n  User:\n  Password:\n  Host:\n  Port:\n  Name:\n\nQMSDB:\n  User:\n  Password:\n  Host:\n  Port:\n  Name:\n  Reinitialize:\n\nMetadataDB:\n  User:\n  Password:\n  Host:\n  Port:\n  Name:\n\nUnleashDB:\n  User:\n  Password:\n  Host:\n  Port:\n  Name:\n\nAdmin:\n  Groups:\n  Attribute:\n\nFileIdentifier:\n  HtPathList:\n  MultiInputPathList:\n\nAnalytics:\n  Enabled:\n  Id:\n\nHarbor:\n  URL:\n  ProjectQARobotName:\n  ProjectQARobotSecret:\n\nQMS:\n  Enabled:\n  Base:\n  Usage:\n\nJaeger:\n  Endpoint:\n</code></pre></p>","path":["Deployment Guide","Core Infrastructure","k8s-resources"],"tags":[]},{"location":"deployments/k8s-resources/#generate-configsecrets-for-discover-env","level":2,"title":"Generate config/secrets for discover env","text":"<pre><code>./generate_configs.py -e discover\n./generate_secrets.py -e discover\n</code></pre>","path":["Deployment Guide","Core Infrastructure","k8s-resources"],"tags":[]},{"location":"deployments/k8s-resources/#load-configsecrets-in-your-cluster-for-discover-env","level":2,"title":"Load config/secrets in your cluster for discover env","text":"<pre><code>./load_configs.py -e discover -n discover\n./load_secrets.py -e discover -n discover\n</code></pre>","path":["Deployment Guide","Core Infrastructure","k8s-resources"],"tags":[]},{"location":"deployments/keycloak/","level":1,"title":"Keycloak","text":"<p>Prerequisites</p>","path":["Deployment Guide","Core Services","Keycloak"],"tags":[]},{"location":"deployments/keycloak/#configure-database","level":3,"title":"configure database","text":"<p>To setup and configure database please have a look at keycloak database.</p>","path":["Deployment Guide","Core Services","Keycloak"],"tags":[]},{"location":"deployments/keycloak/#create-namsespace","level":3,"title":"create namsespace","text":"<pre><code># create ns\nkubectl create ns keycloak\n</code></pre>","path":["Deployment Guide","Core Services","Keycloak"],"tags":[]},{"location":"deployments/keycloak/#create-required-secrets-configmap","level":3,"title":"Create required secrets &amp; configmap","text":"<p>Keycloak deployment requires secrets and configmaps, which can be done via a <code>kustomization.yaml</code> file, please see below for an example of this template:</p> <pre><code>secretGenerator:\n- name: dbuser      # Database\n  literals:\n  - username=&lt;USERNAME&gt;\n  - password=&lt;PASSWORD&gt;\n- name: kcadmin     # keyclaok\n  literals:\n  - username=&lt;USERNAME&gt;\n  - password=&lt;PASSWORD&gt;\nconfigMapGenerator:\n- name: keycloak-config\n  literals:\n  - KEYCLOAK_HOSTNAME=keycloak.example.com\n  - KEYCLOAK_LOGLEVEL=INFO\n  - DB_VENDOR=postgres\n  - DB_ADDR=&lt;DATABASE_HOST&gt;\n  - DB_PORT=5432\n  - PROXY_ADDRESS_FORWARDING=true\n  - JDBC_PARAMS=connectTimeout=21600\n  - JAVA_OPTS=-server\n    -Xms4096m\n    -Xmx8192m\n    -XX:MetaspaceSize=96m\n    -XX:MaxMetaspaceSize=256m\n    -Djboss.modules.system.pkgs=org.jboss.byteman\n    -Djava.awt.headless=true\n    -Dkeycloak.profile.feature.token_exchange=enabled\n    -Djava.security.egd=file:/dev/urandom\nnamespace: keycloak\nresources:\n- deployment.yaml\n- service.yaml\ngeneratorOptions:\n  disableNameSuffixHash: true\n</code></pre> <ul> <li>Update the values of the <code>kustomization.yaml</code> file.</li> <li>place the <code>kustomization.yaml</code>, <code>deployment.yaml</code> and <code>service.yaml</code> inside a directory. e.g. <code>base</code></li> </ul>","path":["Deployment Guide","Core Services","Keycloak"],"tags":[]},{"location":"deployments/keycloak/#deployment-service-yaml-files","level":3,"title":"deployment &amp; service YAML files:","text":"<p>TODO: find a way to add those files.</p>","path":["Deployment Guide","Core Services","Keycloak"],"tags":[]},{"location":"deployments/keycloak/#deploy","level":2,"title":"Deploy","text":"<pre><code># apply kustomize\nkubectl apply -k ./base/ -n keycloak\n</code></pre>","path":["Deployment Guide","Core Services","Keycloak"],"tags":[]},{"location":"deployments/kubernetes-deploy/","level":1,"title":"Kubernetes Cluster","text":"<p>Prerequisites</p> <ul> <li> <p>Make sure you have at least 6 VMs configured with Centos7</p> <ul> <li> <p>1 Master node</p> </li> <li> <p>4 worker nodes</p> </li> <li> <p>1 worker node dedicated only for vice-apps</p> </li> </ul> </li> <li> <p>Make sure you have Ansible installed, and you can reach your VMs via <code>ssh</code></p> </li> </ul>","path":["Deployment Guide","Core Infrastructure","Kubernetes Cluster"],"tags":[]},{"location":"deployments/kubernetes-deploy/#todo-rewrite-the-docs-once-ansible-k8s-centos7-is-ready","level":1,"title":"TODO rewrite the docs once ansible-k8s-centos7 is ready.","text":"<p>We are using Ansible to set up a kubernetes cluster.</p> <p>Current kubernetes cluster is configured using ansible playbooks from deployments/ansible/kubernetes.</p>","path":["Deployment Guide","Core Infrastructure","Kubernetes Cluster"],"tags":[]},{"location":"deployments/kubernetes-deploy/#looking-to-setup-your-own-k8s-cluster","level":1,"title":"Looking to setup your own k8s cluster?","text":"<p>If your are intrested to setup your own kubernetes cluster on Centos 7, please follow the steps bellow.</p>","path":["Deployment Guide","Core Infrastructure","Kubernetes Cluster"],"tags":[]},{"location":"deployments/kubernetes-deploy/#steps","level":2,"title":"Steps","text":"","path":["Deployment Guide","Core Infrastructure","Kubernetes Cluster"],"tags":[]},{"location":"deployments/kubernetes-deploy/#clone-the-repo","level":3,"title":"Clone the repo","text":"<pre><code># clone repo\ngit clone https://github.com/cyverse-de/deployments.git\n\n# navigate to ansible playbooks for k8s\ncd /ansible/kubernetes\n</code></pre>","path":["Deployment Guide","Core Infrastructure","Kubernetes Cluster"],"tags":[]},{"location":"deployments/kubernetes-deploy/#create-your-inventory","level":3,"title":"create your inventory","text":"<p>Create your inventory file under <code>/inventory/cyverse</code> and replace the host names as yours. <pre><code>[k8s:children]\nk8s-control-plane\nk8s-worker\n\n[kube-apiserver-haproxy]\nk8s-reverse-proxy.example.com\n\n[k8s-control-plane]\nk8s-c1.example.com\n\n[k8s-storage:children]\nk8s-worker\n\n[k8s-worker]\nk8s-w1.example.com\nk8s-w2.example.com\nk8s-w3.example.com\nk8s-w4.example.com\nvice-w1.example.com\n\n\n[outward-facing-proxy]\nvice-haproxy.example.com\n\n[haproxy]\nvice-haproxy.example.com\n\n[vice-workers]\nvice-w1.example.com\n</code></pre></p>","path":["Deployment Guide","Core Infrastructure","Kubernetes Cluster"],"tags":[]},{"location":"deployments/kubernetes-deploy/#run-playbooks","level":3,"title":"Run playbooks","text":"<p>Note: we are using <code>--user root</code>, if your virtual machines have a diffrent user you could change this.</p>","path":["Deployment Guide","Core Infrastructure","Kubernetes Cluster"],"tags":[]},{"location":"deployments/kubernetes-deploy/#check-if-your-hosts-are-reachable","level":4,"title":"Check if your hosts are reachable","text":"<pre><code>ansible -i inventory/ -m ping all --user root\n</code></pre>","path":["Deployment Guide","Core Infrastructure","Kubernetes Cluster"],"tags":[]},{"location":"deployments/kubernetes-deploy/#setup-firewall-configs","level":4,"title":"Setup firewall configs","text":"<pre><code>ansible-playbook -i inventory/ firewalld-config.yml --user root\n</code></pre>","path":["Deployment Guide","Core Infrastructure","Kubernetes Cluster"],"tags":[]},{"location":"deployments/kubernetes-deploy/#provision-your-nodes","level":4,"title":"Provision your nodes","text":"<pre><code>ansible-playbook -i inventory/ provision-nodes.yml --user root\n</code></pre>","path":["Deployment Guide","Core Infrastructure","Kubernetes Cluster"],"tags":[]},{"location":"deployments/kubernetes-deploy/#tainting-and-labeling-vice-worker-nodes","level":4,"title":"Tainting and Labeling VICE Worker Nodes","text":"<pre><code>kubectl label nodes vice-w1.example.com vice=true\nkubectl taint nodes vice-w1.example.com vice=only:NoSchedule\n</code></pre>","path":["Deployment Guide","Core Infrastructure","Kubernetes Cluster"],"tags":[]},{"location":"deployments/local-exim/","level":1,"title":"Local Exim (exim-sender)","text":"<p>local-exim or also known as exim-sender</p> <p>Prerequisites</p>","path":["Deployment Guide","Application Services","Local Exim (exim-sender)"],"tags":[]},{"location":"deployments/local-exim/#deploy","level":2,"title":"Deploy","text":"<pre><code>## deploy for prod env\nkubectl apply -f resources/deployments/exim-sender.yml -n prod\n\n## deploy for prod discover\n# kubectl apply -f resources/deployments/exim-sender.yml -n discover\n</code></pre>","path":["Deployment Guide","Application Services","Local Exim (exim-sender)"],"tags":[]},{"location":"deployments/openebs/","level":1,"title":"OpenEBS","text":"<p>Prerequisites</p>","path":["Deployment Guide","Core Infrastructure","OpenEBS"],"tags":[]},{"location":"deployments/openebs/#deploy","level":2,"title":"Deploy","text":"<pre><code># create namespace\nkubectl create ns openebs\n\n# deploy\nkubectl -n openebs apply -f https://openebs.github.io/charts/openebs-operator.yaml\n</code></pre>","path":["Deployment Guide","Core Infrastructure","OpenEBS"],"tags":[]},{"location":"deployments/redis-ha/","level":1,"title":"Redis HA","text":"<p>In this Document we will cover installing the Redis Server and Redis Haproxy, due to the <code>k8s-resources</code> configurations both would be installed and configured inside the prod namespace.</p> <p>Prerequisites</p> <ul> <li>Make sure to create a values.yaml and replace add your credentials</li> </ul> <p>values.yaml Overrides the PersistentVolume, adds secrets and uses openebs as storage class.</p> <pre><code>## replicas number for each component\nreplicas: 3\n\npersistentVolume:\n  enabled: true\n  ## redis-ha data Persistent Volume Storage Class\n  ## If defined, storageClassName: &lt;storageClass&gt;\n  ## If set to \"-\", storageClassName: \"\", which disables dynamic provisioning\n  ## If undefined (the default) or set to null, no storageClassName spec is\n  ##   set, choosing the default provisioner.  (gp2 on AWS, standard on\n  ##   GKE, AWS &amp; OpenStack)\n  ##\n  storageClass: openebs-hostpath\n\n## Sentinel specific configuration options\nsentinel:\n  auth: true\n  authkey: &lt;AUTH-KEY&gt;\n  password: &lt;PASSWORD&gt;\n\n## Redis specific configuration options\nauth: true\nauthkey: &lt;AUTH-KEY&gt;\nredisPassword: &lt;PASSWORD&gt;\n</code></pre>","path":["Deployment Guide","Core Services","Redis HA"],"tags":[]},{"location":"deployments/redis-ha/#redis-server-sentinel","level":2,"title":"Redis Server &amp; Sentinel","text":"<pre><code># add helm repo\nhelm repo add dandydev https://dandydeveloper.github.io/charts\nhelm repo update\n\n## deploy redis servers for prod env\nhelm upgrade --install --namespace prod redis-ha dandydev/redis-ha --values values.yaml\n\n## deploy redis server for discover env\n# helm upgrade --install --namespace discover redis-ha dandydev/redis-ha --values values.yaml\n</code></pre>","path":["Deployment Guide","Core Services","Redis HA"],"tags":[]},{"location":"deployments/redis-ha/#redis-haproxy","level":1,"title":"Redis Haproxy","text":"","path":["Deployment Guide","Core Services","Redis HA"],"tags":[]},{"location":"deployments/redis-ha/#preq","level":2,"title":"Preq","text":"<ul> <li>Make sure to load the configs/secrets see also k8s-resources</li> </ul>","path":["Deployment Guide","Core Services","Redis HA"],"tags":[]},{"location":"deployments/redis-ha/#deploy-redis-haproxy","level":2,"title":"Deploy redis-haproxy","text":"<pre><code>## deploy for prod env\nkubectl apply -n prod -f resources/deployments/redis-haproxy.yml\n\n## deploy for discover env\n# kubectl apply -n discover -f resources/deployments/redis-haproxy.yml\n</code></pre>","path":["Deployment Guide","Core Services","Redis HA"],"tags":[]},{"location":"deployments/unleash/","level":1,"title":"Unleash","text":"<p>Prerequisites</p> <ul> <li>Make sure <code>unleash</code> database is setup, see also unleash-db</li> </ul>","path":["Deployment Guide","Supporting Services","Unleash"],"tags":[]},{"location":"deployments/unleash/#deploy","level":2,"title":"Deploy","text":"<pre><code>## Deploy for prod env\nkubectl apply -f resources/deployments/unleash.yml -n prod\n\n## Deploy for discover env\n# kubectl apply -f resources/deployments/unleash.yml -n discover\n</code></pre>","path":["Deployment Guide","Supporting Services","Unleash"],"tags":[]},{"location":"deployments/userportal/","level":1,"title":"User Portal","text":"<p>Prerequisites</p>","path":["Deployment Guide","Application Services","User Portal"],"tags":[]},{"location":"deployments/userportal/#todo-add-source-location","level":3,"title":"TODO: add source location.","text":"","path":["Deployment Guide","Application Services","User Portal"],"tags":[]},{"location":"deployments/userportal/#ldap","level":3,"title":"LDAP","text":"<p>Setup required ldap user.</p>","path":["Deployment Guide","Application Services","User Portal"],"tags":[]},{"location":"deployments/userportal/#create-portal-user","level":4,"title":"create portal user","text":"","path":["Deployment Guide","Application Services","User Portal"],"tags":[]},{"location":"deployments/userportal/#create-portal-userldif","level":5,"title":"Create portal-user.ldif","text":"<pre><code>dn: uid=portal,ou=People,dc=tugraz,dc=at\nobjectClass: inetOrgPerson\nobjectClass: posixAccount\nobjectClass: shadowAccount\nuid: portal\nmail: portal@example.com\nsn: SeviceAccount\ngivenName: PORTAL\ncn: portal\ntitle: Other\no: N/A\ndepartmentNumber: N/A\nuidNumber: 40003\ngidNumber: 10003\nhomeDirectory: /home/portal\n</code></pre>","path":["Deployment Guide","Application Services","User Portal"],"tags":[]},{"location":"deployments/userportal/#apply-ldap-file","level":5,"title":"Apply ldap file","text":"<pre><code># replace LDAP_PASSWORD \nldapadd -x -D \"cn=Manager,dc=tugraz,dc=at\" -w \"LDAP_PASSWORD\" -f portal-user.ldif\n\n# create a password for the user\n## replace PORTAL_PASSWORD &amp; LDAP_PASSWORD\nldappasswd -x -D cn=Manager,dc=tugraz,dc=at -w \"LDAP_PASSWORD\" -s \"PORTAL_PASSWORD\" \"uid=portal,ou=People,dc=tugraz,dc=at\"\n</code></pre>","path":["Deployment Guide","Application Services","User Portal"],"tags":[]},{"location":"deployments/userportal/#add-portal-user-to-admim-group","level":4,"title":"Add portal user to admim group","text":"","path":["Deployment Guide","Application Services","User Portal"],"tags":[]},{"location":"deployments/userportal/#create-portal-de_adminldif","level":5,"title":"Create portal-de_admin.ldif","text":"<pre><code>dn: cn=de_admins,ou=Groups,dc=tugraz,dc=at\nchangetype: modify\nadd: memberUid\nmemberUid: portal\n</code></pre>","path":["Deployment Guide","Application Services","User Portal"],"tags":[]},{"location":"deployments/userportal/#apply-ldap-file_1","level":5,"title":"Apply ldap file","text":"<pre><code># replace LDAP_PASSWORD\n## add user to the de_admin group\nldapmodify -x -D \"cn=Manager,dc=tugraz,dc=at\" -w \"LDAP_PASSWORD\" -f portal-de_admin.ldif\n</code></pre>","path":["Deployment Guide","Application Services","User Portal"],"tags":[]},{"location":"deployments/userportal/#irods","level":3,"title":"iRODs","text":"<p>For user portal we would need to create an irods <code>rodsadmin</code> user.</p> <pre><code># replace YOURPASSWORDHERE \n## su - irods\niadmin mkuser portal rodsadmin\niadmin moduser portal password YOURPASSWORDHERE\n</code></pre>","path":["Deployment Guide","Application Services","User Portal"],"tags":[]},{"location":"deployments/userportal/#database","level":3,"title":"Database","text":"<p>For Database configuration and setup vist portal-db docs.</p>","path":["Deployment Guide","Application Services","User Portal"],"tags":[]},{"location":"deployments/userportal/#images","level":3,"title":"Images","text":"<ol> <li> <p>harbor.cyverse.org/hub/library/nginx:1.20-alpine Replaced with:nginx:1.20-alpine</p> </li> <li> <p>mbwali/portal:tug-stable</p> <ul> <li>Todo: tekton should build this via the URL.</li> </ul> </li> </ol>","path":["Deployment Guide","Application Services","User Portal"],"tags":[]},{"location":"deployments/userportal/#deploy","level":2,"title":"Deploy","text":"<pre><code># create ns\nkubectl create ns user-portal\n\n# deploy \nkubectl apply -k portal/user-portal/base -n user-portal\n</code></pre>","path":["Deployment Guide","Application Services","User Portal"],"tags":[]},{"location":"deployments/vice/","level":1,"title":"vice apps","text":"<p>Prerequisites</p>","path":["Deployment Guide","Application Services","vice apps"],"tags":[]},{"location":"deployments/vice/#create-namespace","level":2,"title":"Create namespace","text":"<pre><code>kubectl create ns vice-apps\n</code></pre>","path":["Deployment Guide","Application Services","vice apps"],"tags":[]},{"location":"deployments/vice/#create-a-secret-on-namespace-vice-apps-vice-image-pull-secret","level":2,"title":"Create a secret on namespace vice-apps <code>vice-image-pull-secret</code>","text":"<p>This secret has the <code>harbor.org</code> which allows the pod to pull docker images.</p> <pre><code>kubectl create secret generic vice-image-pull-secret \\\n    --from-file=.dockerconfigjson=/root/.docker/config.json \\\n    --type=kubernetes.io/dockerconfigjson -n vice-apps\n</code></pre>","path":["Deployment Guide","Application Services","vice apps"],"tags":[]},{"location":"deployments/vice/#create-serviceaccounts","level":2,"title":"Create serviceAccounts","text":"<pre><code>## edit the namespace if you are running in a diffrent env\n## vi /k8s-resources/resources/serviceaccounts/app-exposer.yml\nkubectl apply -f /k8s-resources/resources/serviceaccounts/app-exposer.yml\nkubectl apply -f /k8s-resources/resources/serviceaccounts/vice-app-runner.yml\n</code></pre>","path":["Deployment Guide","Application Services","vice apps"],"tags":[]},{"location":"deployments/vice/#apply-clusterrolebindings","level":2,"title":"Apply clusterrolebindings","text":"<pre><code>## edit the namespace if you are running in a diffrent env\n## vi /k8s-resources/resources/clusterrolebindings/app-exposer.yml\nkubectl apply -f /k8s-resources/resources/clusterrolebindings/app-exposer.yml\n</code></pre>","path":["Deployment Guide","Application Services","vice apps"],"tags":[]},{"location":"deployments/vice/#apply-networkpolicies","level":2,"title":"Apply networkpolicies","text":"<p>To apply networkpolicies we need to edit the file <code>/k8s-resources/resources/networkpolicies/vice-apps.yml</code>, and add all the worker nodes, and master nodes, to it if we are using a diffrent env rather than prod.</p> <p>e.g.</p> <pre><code>-        except:\n         - ********\n         - ********\n\n+        except:\n         - 10.0.10.0/24          # k8s master CIDR\n         - ****************/32   # c1 \n         - ****************/32   # w1 \n         - ***************/32    # w2 \n         - ***************/32    # w3 \n         - **************/32     # w4\n         - *************/32      # w5 \n         - ************/32       # vice-w1 \n</code></pre> <p>Run policy</p> <pre><code>kubectl apply -f /k8s-resources/resources/networkpolicies/vice-apps.yml\n</code></pre>","path":["Deployment Guide","Application Services","vice apps"],"tags":[]},{"location":"deployments/vice/#apply-roles","level":2,"title":"Apply roles","text":"<pre><code>kubectl apply -f /k8s-resources/resources/roles/vice-apps.yml\n</code></pre>","path":["Deployment Guide","Application Services","vice apps"],"tags":[]},{"location":"deployments/vice/#create-porklock-config-secrert-for-irods","level":2,"title":"Create porklock-config secrert for irods","text":"","path":["Deployment Guide","Application Services","vice apps"],"tags":[]},{"location":"deployments/vice/#create-irods-configproperties","level":3,"title":"Create irods-config.properties","text":"<p>Create a file <code>irods-config.properties</code> and add the values.</p> <pre><code>porklock.irods-home=\nporklock.irods-user=\nporklock.irods-pass=\nporklock.irods-host=\nporklock.irods-port=\nporklock.irods-zone=\nporklock.irods-resc=\n</code></pre>","path":["Deployment Guide","Application Services","vice apps"],"tags":[]},{"location":"deployments/vice/#create-secret-from-file","level":3,"title":"Create secret from file","text":"<pre><code>kubectl -n vice-apps create secret generic porklock-config --from-file=irods-config.properties\n</code></pre>","path":["Deployment Guide","Application Services","vice apps"],"tags":[]},{"location":"deployments/vice/#restart-the-services","level":2,"title":"Restart the services","text":"<pre><code>kubectl rollout restart apps app-exposer templeton-incremental templeton-periodic -n NAMESPACE\n</code></pre>","path":["Deployment Guide","Application Services","vice apps"],"tags":[]},{"location":"deployments/vice/#installconfigure-ingress-nginx","level":2,"title":"Install/configure ingress-nginx","text":"<p>For installing and configuring the ingress-nginx have a look at ingress-nginx</p>","path":["Deployment Guide","Application Services","vice apps"],"tags":[]},{"location":"development/","level":1,"title":"Developer Guide","text":"<p>Welcome to the CyVerse Developer Guide. This documentation is for developers who want to:</p> <ul> <li>Integrate applications with CyVerse APIs</li> <li>Contribute code to the CyVerse platform</li> <li>Build custom tools and services on top of CyVerse infrastructure</li> <li>Understand CyVerse architecture for research or collaboration</li> </ul>","path":["Developer Guide"],"tags":[]},{"location":"development/#who-this-guide-is-for","level":2,"title":"Who This Guide Is For","text":"<p>API Integrators: You want to connect your application to CyVerse's Data Store, submit computational jobs, or leverage CyVerse authentication.</p> <p>Platform Contributors: You want to contribute code, fix bugs, or add features to CyVerse's open-source codebase.</p> <p>Tool Developers: You're packaging scientific software to run in the Discovery Environment or VICE.</p> <p>Researchers &amp; Data Scientists: You want to automate workflows, build custom interfaces, or extend CyVerse functionality for your research needs.</p>","path":["Developer Guide"],"tags":[]},{"location":"development/#getting-started","level":2,"title":"Getting Started","text":"","path":["Developer Guide"],"tags":[]},{"location":"development/#development-environment-setup","level":3,"title":"Development Environment Setup","text":"","path":["Developer Guide"],"tags":[]},{"location":"development/#required-tools","level":4,"title":"Required Tools","text":"<p>Before you begin, install these tools:</p> <pre><code># Version control\ngit --version  # Git 2.30+\n\n# Container tools\ndocker --version  # Docker 20.10+\ndocker-compose --version  # Docker Compose 1.29+\n\n# Kubernetes tools (for platform development)\nkubectl version  # kubectl 1.23+\nhelm version  # Helm 3.8+\n\n# Programming languages (depending on services)\npython --version  # Python 3.9+\ngo version  # Go 1.19+ (for DE services)\nnode --version  # Node.js 16+ (for UI development)\n</code></pre>","path":["Developer Guide"],"tags":[]},{"location":"development/#get-access","level":4,"title":"Get Access","text":"<ol> <li>CyVerse Account: Create a free account at https://user.cyverse.org</li> <li>GitHub Access: Most CyVerse code is at github.com/cyverse-de</li> <li>API Credentials: Generate API tokens through the Discovery Environment or User Portal</li> <li>Development Environment: Set up a test environment or use the public CyVerse production instance</li> </ol>","path":["Developer Guide"],"tags":[]},{"location":"development/#development-accounts","level":4,"title":"Development Accounts","text":"<p>For testing and development:</p> <ul> <li>Production: <code>https://de.cyverse.org</code> - Use for API testing with real data (be cautious!)</li> <li>Development/Staging: Contact CyVerse team for access to dev environments</li> <li>Local Development: Set up local services using Docker Compose (see repository README files)</li> </ul>","path":["Developer Guide"],"tags":[]},{"location":"development/#cyverse-architecture-overview","level":2,"title":"CyVerse Architecture Overview","text":"<p>Understanding CyVerse's architecture will help you integrate effectively or contribute meaningfully.</p>","path":["Developer Guide"],"tags":[]},{"location":"development/#system-design","level":3,"title":"System Design","text":"<p>CyVerse follows a microservices architecture with services communicating via REST APIs and message queues:</p> <pre><code>âââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââ\nâ                     Users &amp; Applications                      â\nâââââââââââââââââââââââââ¬ââââââââââââââââââââââââââââââââââââââ\n                        â\n                        â¼\nâââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââ\nâ                     Frontend Layer                           â\nâ  ââââââââââââââââ  ââââââââââââââââ  ââââââââââââââââ      â\nâ  â Discovery    â  â User Portal  â  â Custom Apps  â      â\nâ  â Environment  â  â              â  â (Your Code)  â      â\nâ  â (Sonora UI)  â  â              â  â              â      â\nâ  ââââââââââââââââ  ââââââââââââââââ  ââââââââââââââââ      â\nâââââââââââââââââââââââââ¬ââââââââââââââââââââââââââââââââââââââ\n                        â\n                        â¼\nâââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââ\nâ                    API Gateway Layer                         â\nâ  âââââââââââââââââââââââââââââââââââââââââââââââââââââââââ  â\nâ  â              Terrain API (Aggregator)                  â  â\nâ  â         https://de.cyverse.org/terrain/docs            â  â\nâ  âââââââââââââââââââââââââââââââââââââââââââââââââââââââââ  â\nâââââââââââââââââââââââââ¬ââââââââââââââââââââââââââââââââââââââ\n                        â\n        âââââââââââââââââ¼ââââââââââââââââ\n        â               â               â\n        â¼               â¼               â¼\nââââââââââââââââ ââââââââââââââââ ââââââââââââââââ\nâ Microservices Layer                              â\nâ ââââââââââââ ââââââââââââ ââââââââââââ          â\nâ â apps     â â data-infoâ â analyses â          â\nâ â          â â          â â          â          â\nâ ââââââââââââ ââââââââââââ ââââââââââââ          â\nâ ââââââââââââ ââââââââââââ ââââââââââââ          â\nâ â metadata â â notif-   â â permiss- â          â\nâ â          â â ications â â ions     â          â\nâ ââââââââââââ ââââââââââââ ââââââââââââ          â\nââââââââââââââââââââââââââââââââââââââââââââââââââââ\n        â               â               â\n        âââââââââââââââââ¼ââââââââââââââââ\n                        â\n                        â¼\nâââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââ\nâ                  Infrastructure Layer                        â\nâ  âââââââââââââââ âââââââââââââââ âââââââââââââââ           â\nâ  â PostgreSQL  â â RabbitMQ    â â iRODS       â           â\nâ  â (Databases) â â (Messages)  â â (Storage)   â           â\nâ  âââââââââââââââ âââââââââââââââ âââââââââââââââ           â\nâ  âââââââââââââââ âââââââââââââââ âââââââââââââââ           â\nâ  â ElasticSrch â â KeyCloak    â â Kubernetes  â           â\nâ  â (Search)    â â (Auth)      â â (Orchestr.) â           â\nâ  âââââââââââââââ âââââââââââââââ âââââââââââââââ           â\nâââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââ\n</code></pre>","path":["Developer Guide"],"tags":[]},{"location":"development/#key-components","level":3,"title":"Key Components","text":"Component Technology Purpose Terrain Clojure API gateway aggregating all DE services apps Go App/tool metadata and management data-info Clojure Data Store filesystem operations analyses Go Job submission and monitoring metadata Go User-defined metadata (AVUs) notifications Go User notification system permissions Go Fine-grained permission management Sonora React/TypeScript Modern DE web UI iRODS C++/Python Data storage backend KeyCloak Java Authentication and identity","path":["Developer Guide"],"tags":[]},{"location":"development/#service-interactions","level":3,"title":"Service Interactions","text":"<p>Example: Submitting a Job</p> <ol> <li>User clicks \"Run\" in Sonora UI</li> <li>Sonora calls Terrain API: <code>POST /terrain/analyses</code></li> <li>Terrain validates request and calls <code>analyses</code> service</li> <li><code>analyses</code> service:</li> <li>Validates app exists (via <code>apps</code> service)</li> <li>Checks user permissions (via <code>permissions</code> service)</li> <li>Stages input data (via <code>data-info</code> service)</li> <li>Submits job to HTCondor or Kubernetes</li> <li>Sends notification (via <code>notifications</code> service)</li> <li>Publishes events to RabbitMQ</li> <li>Job status updates flow back through the same chain</li> </ol>","path":["Developer Guide"],"tags":[]},{"location":"development/#api-integration","level":2,"title":"API Integration","text":"","path":["Developer Guide"],"tags":[]},{"location":"development/#authentication","level":3,"title":"Authentication","text":"<p>CyVerse uses OAUTH 2.0 via KeyCloak for authentication.</p>","path":["Developer Guide"],"tags":[]},{"location":"development/#getting-an-access-token","level":4,"title":"Getting an Access Token","text":"<p>Method 1: Interactive (Browser-based)</p> <p>Use OAUTH 2.0 authorization code flow:</p> <pre><code>import requests\n\n# Step 1: Direct user to authorization URL\nauth_url = \"https://kc.cyverse.org/auth/realms/CyVerse/protocol/openid-connect/auth\"\nparams = {\n    \"client_id\": \"your-client-id\",\n    \"redirect_uri\": \"https://yourapp.com/callback\",\n    \"response_type\": \"code\",\n    \"scope\": \"openid\"\n}\n# User visits this URL and authorizes\n\n# Step 2: Exchange authorization code for token\ntoken_url = \"https://kc.cyverse.org/auth/realms/CyVerse/protocol/openid-connect/token\"\ntoken_response = requests.post(token_url, data={\n    \"grant_type\": \"authorization_code\",\n    \"code\": \"authorization-code-from-callback\",\n    \"redirect_uri\": \"https://yourapp.com/callback\",\n    \"client_id\": \"your-client-id\",\n    \"client_secret\": \"your-client-secret\"\n})\naccess_token = token_response.json()[\"access_token\"]\n</code></pre> <p>Method 2: Command-line (for scripts)</p> <p>For automated scripts, use resource owner password credentials flow (requires user consent):</p> <pre><code>#!/bin/bash\n# Get access token for scripting\n\nUSERNAME=\"your-username\"\nPASSWORD=\"your-password\"\nCLIENT_ID=\"de-client\"\n\nTOKEN=$(curl -s -X POST \\\n  https://kc.cyverse.org/auth/realms/CyVerse/protocol/openid-connect/token \\\n  -d \"grant_type=password\" \\\n  -d \"client_id=${CLIENT_ID}\" \\\n  -d \"username=${USERNAME}\" \\\n  -d \"password=${PASSWORD}\" \\\n  | jq -r '.access_token')\n\necho $TOKEN\n</code></pre>","path":["Developer Guide"],"tags":[]},{"location":"development/#using-the-access-token","level":4,"title":"Using the Access Token","text":"<p>Include the token in the <code>Authorization</code> header:</p> <pre><code>curl -H \"Authorization: Bearer ${TOKEN}\" \\\n  https://de.cyverse.org/terrain/filesystem/list\n</code></pre>","path":["Developer Guide"],"tags":[]},{"location":"development/#making-api-calls","level":3,"title":"Making API Calls","text":"","path":["Developer Guide"],"tags":[]},{"location":"development/#example-list-files","level":4,"title":"Example: List Files","text":"<pre><code>import requests\n\ndef list_directory(access_token, path):\n    \"\"\"List files in a Data Store directory.\"\"\"\n    url = f\"https://de.cyverse.org/terrain/secured/filesystem/paged-directory\"\n    headers = {\n        \"Authorization\": f\"Bearer {access_token}\",\n        \"Content-Type\": \"application/json\"\n    }\n    params = {\n        \"path\": path,\n        \"limit\": 100,\n        \"offset\": 0\n    }\n\n    response = requests.get(url, headers=headers, params=params)\n    response.raise_for_status()\n    return response.json()\n\n# Usage\nfiles = list_directory(access_token, \"/iplant/home/username\")\nfor item in files[\"files\"]:\n    print(f\"{item['label']} ({item['file-size']} bytes)\")\n</code></pre>","path":["Developer Guide"],"tags":[]},{"location":"development/#example-submit-a-job","level":4,"title":"Example: Submit a Job","text":"<pre><code>def submit_analysis(access_token, app_id, input_files, parameters):\n    \"\"\"Submit a job to run an analysis.\"\"\"\n    url = \"https://de.cyverse.org/terrain/analyses\"\n    headers = {\n        \"Authorization\": f\"Bearer {access_token}\",\n        \"Content-Type\": \"application/json\"\n    }\n    payload = {\n        \"app_id\": app_id,\n        \"name\": \"My Analysis\",\n        \"description\": \"Running analysis via API\",\n        \"notify\": True,\n        \"config\": {\n            \"input1\": input_files,\n            \"param1\": parameters\n        }\n    }\n\n    response = requests.post(url, headers=headers, json=payload)\n    response.raise_for_status()\n    return response.json()\n\n# Usage\nresult = submit_analysis(\n    access_token,\n    app_id=\"12345678-1234-1234-1234-123456789abc\",\n    input_files=[\"/iplant/home/username/data.txt\"],\n    parameters={\"threshold\": 0.05}\n)\nprint(f\"Job submitted: {result['id']}\")\n</code></pre>","path":["Developer Guide"],"tags":[]},{"location":"development/#example-upload-a-file","level":4,"title":"Example: Upload a File","text":"<pre><code>def upload_file(access_token, local_file, dest_path):\n    \"\"\"Upload a file to the Data Store.\"\"\"\n    url = \"https://de.cyverse.org/terrain/secured/fileio/upload\"\n    headers = {\n        \"Authorization\": f\"Bearer {access_token}\"\n    }\n    files = {\n        \"file\": open(local_file, \"rb\")\n    }\n    data = {\n        \"dest\": dest_path\n    }\n\n    response = requests.post(url, headers=headers, files=files, data=data)\n    response.raise_for_status()\n    return response.json()\n\n# Usage\nupload_file(access_token, \"local-data.csv\", \"/iplant/home/username/uploads/\")\n</code></pre>","path":["Developer Guide"],"tags":[]},{"location":"development/#api-resources","level":3,"title":"API Resources","text":"<ul> <li>Live API Documentation - Interactive Swagger UI</li> <li>Terrain Endpoint Reference - Comprehensive endpoint list</li> <li>API Error Codes - Error handling guide</li> <li>Filesystem API - Data Store operations</li> <li>Tapis Migration Guide - Upgrading from Tapis v2 to v3</li> </ul>","path":["Developer Guide"],"tags":[]},{"location":"development/#building-custom-applications","level":2,"title":"Building Custom Applications","text":"","path":["Developer Guide"],"tags":[]},{"location":"development/#best-practices","level":3,"title":"Best Practices","text":"<ol> <li>Use Access Tokens Securely</li> <li>Never commit tokens to version control</li> <li>Use environment variables or secure vaults</li> <li> <p>Implement token refresh logic</p> </li> <li> <p>Handle Rate Limits</p> </li> <li>Implement exponential backoff for retries</li> <li>Cache responses when appropriate</li> <li> <p>Use bulk operations when available</p> </li> <li> <p>Error Handling</p> </li> <li>Check HTTP status codes</li> <li>Parse error responses for details</li> <li> <p>Provide user-friendly error messages</p> </li> <li> <p>Respect User Privacy</p> </li> <li>Only access data the user has authorized</li> <li>Follow CyVerse data policies</li> <li>Implement proper permission checks</li> </ol>","path":["Developer Guide"],"tags":[]},{"location":"development/#example-python-sdk-wrapper","level":3,"title":"Example: Python SDK Wrapper","text":"<p>Create a simple SDK wrapper for common operations:</p> <pre><code># cyverse_sdk.py\nimport requests\nfrom typing import List, Dict\n\nclass CyVerseClient:\n    def __init__(self, access_token: str, base_url: str = \"https://de.cyverse.org/terrain\"):\n        self.access_token = access_token\n        self.base_url = base_url\n        self.session = requests.Session()\n        self.session.headers.update({\n            \"Authorization\": f\"Bearer {access_token}\",\n            \"Content-Type\": \"application/json\"\n        })\n\n    def list_files(self, path: str, limit: int = 100) -&gt; List[Dict]:\n        \"\"\"List files in a directory.\"\"\"\n        url = f\"{self.base_url}/secured/filesystem/paged-directory\"\n        response = self.session.get(url, params={\"path\": path, \"limit\": limit})\n        response.raise_for_status()\n        return response.json()[\"files\"]\n\n    def search_data(self, query: str) -&gt; List[Dict]:\n        \"\"\"Search for data in the Data Store.\"\"\"\n        url = f\"{self.base_url}/secured/filesystem/search\"\n        response = self.session.post(url, json={\"query\": query})\n        response.raise_for_status()\n        return response.json()[\"files\"]\n\n    def get_analyses(self, limit: int = 10) -&gt; List[Dict]:\n        \"\"\"Get user's recent analyses.\"\"\"\n        url = f\"{self.base_url}/analyses\"\n        response = self.session.get(url, params={\"limit\": limit})\n        response.raise_for_status()\n        return response.json()[\"analyses\"]\n\n# Usage\nclient = CyVerseClient(access_token=\"your-token\")\nfiles = client.list_files(\"/iplant/home/username\")\n</code></pre>","path":["Developer Guide"],"tags":[]},{"location":"development/#contributing-to-cyverse","level":2,"title":"Contributing to CyVerse","text":"","path":["Developer Guide"],"tags":[]},{"location":"development/#github-workflow","level":3,"title":"GitHub Workflow","text":"<p>CyVerse development follows standard Git/GitHub workflows:</p> <ol> <li> <p>Fork the Repository <pre><code># Navigate to the service repository on GitHub and click \"Fork\"\ngit clone https://github.com/YOUR-USERNAME/repo-name.git\ncd repo-name\ngit remote add upstream https://github.com/cyverse-de/repo-name.git\n</code></pre></p> </li> <li> <p>Create a Feature Branch <pre><code>git checkout -b feature/your-feature-name\n</code></pre></p> </li> <li> <p>Make Changes and Commit <pre><code>git add .\ngit commit -m \"Add feature: description of changes\"\n</code></pre></p> </li> <li> <p>Push and Create Pull Request <pre><code>git push origin feature/your-feature-name\n# Then create a Pull Request on GitHub\n</code></pre></p> </li> </ol>","path":["Developer Guide"],"tags":[]},{"location":"development/#code-review-process","level":3,"title":"Code Review Process","text":"<ol> <li>Submit a Pull Request with:</li> <li>Clear description of changes</li> <li>Reference to any related issues</li> <li>Screenshots for UI changes</li> <li> <p>Test results</p> </li> <li> <p>Automated checks will run:</p> </li> <li>Unit tests</li> <li>Linting/formatting checks</li> <li> <p>Security scans</p> </li> <li> <p>Maintainers will review your code:</p> </li> <li>Respond to feedback promptly</li> <li>Make requested changes</li> <li> <p>Engage in technical discussions</p> </li> <li> <p>Once approved, maintainers will merge your PR</p> </li> </ol>","path":["Developer Guide"],"tags":[]},{"location":"development/#testing-requirements","level":3,"title":"Testing Requirements","text":"<p>All contributions should include appropriate tests:</p> <p>Go Services: <pre><code># Run unit tests\ngo test ./...\n\n# Run with coverage\ngo test -cover ./...\n</code></pre></p> <p>Clojure Services: <pre><code># Run tests with Leiningen\nlein test\n</code></pre></p> <p>React/TypeScript UI: <pre><code># Run Jest tests\nnpm test\n\n# Run with coverage\nnpm test -- --coverage\n</code></pre></p>","path":["Developer Guide"],"tags":[]},{"location":"development/#development-standards","level":3,"title":"Development Standards","text":"<ul> <li>Code Style: Follow existing code style in the repository</li> <li>Documentation: Update README and inline comments for significant changes</li> <li>Commit Messages: Use clear, descriptive commit messages</li> <li>Breaking Changes: Discuss breaking changes with maintainers before implementing</li> </ul>","path":["Developer Guide"],"tags":[]},{"location":"development/#cyverse-repositories","level":2,"title":"CyVerse Repositories","text":"","path":["Developer Guide"],"tags":[]},{"location":"development/#core-services","level":3,"title":"Core Services","text":"Repository Language Description terrain Clojure Main API gateway apps Go App metadata service data-info Clojure Data Store operations analyses Go Job management sonora React/TS Modern DE UI","path":["Developer Guide"],"tags":[]},{"location":"development/#infrastructure","level":3,"title":"Infrastructure","text":"Repository Language Description deployments YAML/HCL Kubernetes manifests ansible Ansible Configuration management","path":["Developer Guide"],"tags":[]},{"location":"development/#tools-utilities","level":3,"title":"Tools &amp; Utilities","text":"Repository Language Description gocommands Go iRODS CLI tools irods-csi-driver Go Kubernetes iRODS integration <p>Browse the full list at github.com/cyverse-de</p>","path":["Developer Guide"],"tags":[]},{"location":"development/#community-support","level":2,"title":"Community &amp; Support","text":"","path":["Developer Guide"],"tags":[]},{"location":"development/#get-help","level":3,"title":"Get Help","text":"<ul> <li>Documentation: You're reading it! Search this site for answers</li> <li>GitHub Issues: Report bugs or request features in the relevant repository</li> <li>CyVerse Support: support.cyverse.org</li> </ul>","path":["Developer Guide"],"tags":[]},{"location":"development/#stay-updated","level":3,"title":"Stay Updated","text":"<ul> <li>GitHub: Watch repositories for updates</li> <li>CyVerse Blog: cyverse.org/blog</li> </ul>","path":["Developer Guide"],"tags":[]},{"location":"development/#contributing-beyond-code","level":3,"title":"Contributing Beyond Code","text":"<p>Not a developer? You can still contribute:</p> <ul> <li>Report bugs you encounter</li> <li>Suggest feature improvements</li> <li>Write documentation</li> <li>Answer questions in forums</li> <li>Share your CyVerse integration as an example</li> </ul>","path":["Developer Guide"],"tags":[]},{"location":"development/#additional-resources","level":2,"title":"Additional Resources","text":"<ul> <li>API Overview - Detailed Terrain API documentation</li> <li>System Architecture - Deep dive into CyVerse design</li> <li>Deployment Guide - For platform operators</li> <li>Getting Started - Prerequisites and initial setup</li> </ul> <p>Ready to build? Start with the API Endpoint Index to explore available functionality, or dive into the live API documentation for interactive testing.</p>","path":["Developer Guide"],"tags":[]},{"location":"guides/de/","level":1,"title":"De","text":"<p> Discovery Environment Admin Panel</p>","path":["Administration Guide","De"],"tags":[]},{"location":"guides/de/#administrative-panel","level":2,"title":"Administrative Panel","text":"","path":["Administration Guide","De"],"tags":[]},{"location":"guides/de/#apps","level":3,"title":"Apps","text":"<p>Add/Edit/Delete applications</p> <p>Requires a pre-existing Tool (Container Template)</p>","path":["Administration Guide","De"],"tags":[]},{"location":"guides/de/#doi-requests-sop","level":3,"title":"DOI Requests SOP","text":"<p>Prerequisites and information</p> <ul> <li> <p>To view DOI Requests, admin priviledges are required. </p> </li> <li> <p>For a DOI request to be submitted, users should follow the stelps outlined in the quick start tutorial.</p> </li> <li> <p>DOI Requests are visible in the Admin sidebar menu of the DE. </p> </li> </ul>","path":["Administration Guide","De"],"tags":[]},{"location":"guides/de/#approaching-the-doi","level":4,"title":"Approaching the DOI","text":"<ol> <li>A new Intercom ticket will automatically be created when a new DOI has been requested via the DE.</li> <li>Open 'DOI requests' in the admin tab of the DE.</li> <li>Select the current request, and click on Update Request. Change status from Submitted to Pending, if you don't plan to work on it right away.</li> <li>When you are ready review, change status to Evaluation.</li> <li>Check the user's subscription tier:<ul> <li>If they only have a Basic subscription plan they are not entitled to any DOIs. In that case change the DOI status to Rejected. Include a comment as to why it was rejected. </li> <li>If the user has a paid plan make sure they haven't already received all the DOIs they are entitled to for the year. Very few users request more than one DOI per year. You can see all of the requests (with dates) in the DOI request area of the DE admin page.</li> </ul> </li> </ol>","path":["Administration Guide","De"],"tags":[]},{"location":"guides/de/#evaluating-the-request-in-the-de","level":4,"title":"Evaluating the request in the DE","text":"<ol> <li>Review the dataset in <code>/iplant/home/shared/commons_repo/staging</code> for:<ol> <li>A <code>ReadMe</code> file that explains the dataset and includes a manifest/inventory<ul> <li>Manifest/inventory described here</li> </ul> </li> <li>Organized in a sensible fashion</li> <li>If the project includes sequences, there should be information about the specimens, with a list of BioSample IDs</li> <li>CyVerse Curated Data Folder-Naming Guidelines<ul> <li>These are flexible. If someone has a good reason to use a different name, it is allowed, but it should be roughly similar to the guidelines</li> </ul> </li> <li>No spaces in folder or file names.</li> </ol> </li> <li>If changes are needed, email the requestor and ask them to make the changes. Be sure to provide the location of the data (<code>/iplant/home/commons_repo/staging/$folder_name</code>). <ol> <li>Makes sure the requestor has at least write permission. If you have asked them to delete anything, give them own permission.</li> <li>It is useful to record what changes are requested in the comments in the status field in the request (in the Admin tab of the DE).</li> </ol> </li> <li>In the DE, view the metadata (check the box next to the folder, click 'more actions', 'metadata') and apply the DataCite 4.1 template (using the 'more actions', 'view in template'), then review the metadata for:<ol> <li>Required metadata for DataCite4.1 (see template)</li> <li>Adequate description of data in the description field<ul> <li>Since this is a single line, it is hard to read. The suggestion is to copy the text to a text file and review it there. If you make edits, copy it back to the field.</li> </ul> </li> <li>Any errors. <ul> <li>Common errors include:<ol> <li>Putting all the subjects in a single comma-separated list instead of each subject in its own field</li> <li>Entering something in the year or identifier field. This will cause DOI creation to fail.</li> </ol> </li> </ul> </li> </ol> </li> <li>If metadata or data do not pass review, contact submitter to make revisions. Make sure they have access to their folder in the staging area (see note about permissions on the PID Curator Page).</li> <li>Once data and metadata pass review, change status to Approved. In the comment field, note any changes that were made or special accommodations.</li> </ol>","path":["Administration Guide","De"],"tags":[]},{"location":"guides/de/#post-evaluation","level":4,"title":"Post evaluation","text":"<ol> <li>Create the identifier:<ol> <li>In the DE admin tab, under DOI requests, select the request, then click on Create Permanent Identifier.</li> <li>After a short wait, you should receive a popup notification that the ID was created, or an error message, if there was some problem.</li> <li>If you view the metadata, you should now see a DOI in the Identifier field.</li> <li>Status should change automatically to Completion.</li> </ol> </li> <li>Throughout the process, the user will receive notifications via the DE of any change in status. They only receive email for the initial request and final creation.</li> <li>When the DOI is created:<ol> <li>The user and curators will receive an email notification with the DOI.</li> <li>The folder will be moved out of the staging area and into the curated area of the data_commons folder.</li> <li>The dataset will be visible in the Data Commons Repository (https://datacommons.cyverse.org/ or https://dc.cyverse.org/).</li> </ol> </li> </ol> <p>Achtung!</p> <p>Due to a known bug, the citation for the DOI will not display correctly on the landing page unless you take the following additional step after DOI creation:</p> <ul> <li>Add identifierType metadata:<ol> <li>Open the metadata for the folder in /iplant/home/shared/commons_repo/curated</li> <li>Click to add a new AVU</li> <li>change the Attribute to \"identiferType\"</li> <li>change the Value to \"DOI\"</li> <li>there should be no unit</li> <li>save the metadata</li> </ol> </li> </ul> <p>Managing permissions</p> <p>In order for DOI requestors to see their data under <code>/iplant/home/share/staging</code>, they need read access to that folder. The way this is currently done is to give them recursive read permission to <code>/iplant/home/shared/commons_repo</code>. Due to a known problem, once this happens, they are subsequently given read permission to any new DOI request folders under staging. To avoid this problem, please complete the following additional step:</p> <ul> <li>Remove user's read permission from <code>/iplant/home/shared/commons_repo</code>. This can be done easily in the DE or using iCommands.</li> </ul>","path":["Administration Guide","De"],"tags":[]},{"location":"guides/de/#updating-a-doi-dataset","level":4,"title":"Updating a DOI dataset","text":"<p>Once a DOI is has been created, the data should not change. However, if the user notices a small mistake within a day or two, and the dataset has not been publicized, it is generally safe to change, especially if the change is an addition. Generally, any change to the data contained within a DOI dataset requires issuing a new DOI as a new version of the dataset.</p>","path":["Administration Guide","De"],"tags":[]},{"location":"guides/de/#creating-a-new-verson","level":5,"title":"Creating a new verson","text":"<p>New version of a dataset may be published due to updates or mistakes in the original dataset.</p> <ol> <li>If the new version is due to a mistake, have the user copy the old version to their home directory, make the needed changes, and then submit a new DOI request as per usual. Otherwise, just have them request a new DOI. They should fill in the Version field.</li> <li>Be sure to include a link to the previous version in the new version's metadata using the <code>relatedIdentifier</code> field. </li> <li>Create the new DOI</li> <li>Edit metadata of the old DOI:<ol> <li>Point to the new version using the <code>relatedIdentifier</code> field. </li> <li>Add a link to the new version of the dataset using the <code>relatedIdentifier</code> field. </li> <li>Check the \"deprecated\" field in the DataCite metadata template, if the new version is due to a mistake in the old version</li> <li>If the dataset is deprecated, change the title of the dataset to include the word deprecated. You may want have the user edit the dataset description as well.</li> </ol> </li> </ol>","path":["Administration Guide","De"],"tags":[]},{"location":"guides/de/#updating-metadata","level":5,"title":"Updating metadata","text":"<p>You can update the metadata for DOI datasets after creation, but changes generally should be only to correct errors or add more information. The most important use case is to add the DOI of a related publication that comes out later, using the <code>relatedIdentifier</code> field.</p> <p>Remember!</p> <p>Any changes you make to the metadata in the DE must also be synced with DataCite. This can only be done manually by accessing Fabrica.</p>","path":["Administration Guide","De"],"tags":[]},{"location":"guides/de/#nested-dois","level":4,"title":"Nested DOIs","text":"<p>Warning</p> <p>This section is subject to changes.</p> <p>For complex datasets, there may be one overarching DOI, plus additional DOIs for folders within the Dataset. This process requires some manual curation and coordination with the requestor. </p> <ol> <li>User should contact doi@cyverse.org to discuss this before requesting their DOIs.</li> <li>User creates a folder for each sub-folder (i.e. each granular DOI), adds metadata, and requests DOI as per usual.</li> <li>User creates the top level folder for the entire dataset and requests a DOI<ol> <li>Must include the usual metadata plus a readme file that lists all of the sub-DOIs</li> <li>May include additional data files, beyond the sub-folders</li> <li>DOES NOT include any of the sub-folders at this point.</li> </ol> </li> <li>Curator creates DOIs for all the sub-DOIs as per normal.</li> <li>Curator creates DOI for top level folder as per normal</li> <li>Curator moves all sub-folders into the top level folder<ol> <li>This can be done in DE or with iCommands</li> </ol> </li> <li>Curator updates locations of all sub-DOI datasets in Fabrica</li> <li>Curator edits the metadata of each subfolder to include a link to the parent DOI using the \"relatedIdentifier\" field. </li> <li>Curator edits the metadata of the top level folder to include links to all the child DOIs using the \"relatedIdentifier\" field. Each child should get its own metadatum.</li> </ol>","path":["Administration Guide","De"],"tags":[]},{"location":"guides/de/#known-potential-issues","level":4,"title":"Known potential issues","text":"<p>Warning</p> <p>This section is subject to changes.</p>","path":["Administration Guide","De"],"tags":[]},{"location":"guides/de/#dois-for-datasets-with-1000-files","level":5,"title":"DOIs for datasets with &gt;1000 files","text":"<p>Warning</p> <p>This issue might have been resolved since first reported.</p> <p>If the dataset for which a DOI is requested contains more than 1000 objects (files or folders), the DE cannot currently move it. You and the submitter will get an email notice to this effect. The dataset can be moved manually using iRODS. Please follow the following steps.</p> <ol> <li>Contact submitter and ask if they can generate tallballs of the directories/files. Data Store handles large files much better than lots of small files. </li> <li>Curators receive an email notification that a DOI has been requested via the DE and that the folder could not be moved.</li> <li>Contact the DOI requestor. Their user name is in the DOI request, and you can look up their email at https://user.cyverse.org/. Ask them to make you an owner of the folder.</li> <li>Using iCommands, move the folder to <code>/iplant/home/shared/staging/$foldername</code></li> <li>Curate as usual. Upon creation, you will again receive a notice that the folder could not be moved.</li> <li>Using iCommands, move the folder to <code>/iplant/home/shared/curated/$foldername</code></li> <li>Using iCommands, set the permissions on the folder so that \"public\" and \"anonymous\" have read permission. Remove any other permissions EXCEPT for DOI-curators â keep those.<ol> <li>Example: <code>ichmod -rV read anonymous Miao_Schnable_sorghumHighThroughputPhenotyping_2017</code></li> </ol> </li> </ol> <p>If you follow the steps above, our system will be able to track the location of the folder properly. However, it does mean you have to manually move the data twice. There are other options. Talk to Paul or Ramona if you run into problems.</p>","path":["Administration Guide","De"],"tags":[]},{"location":"guides/de/#dois-and-keeping-data-residing-in-their-normal-place","level":5,"title":"DOIs and keeping data residing in their normal place","text":"<ol> <li>User requests the DOI as normal.</li> <li>Curator creates the DOI as normal. This puts the final datasets with all metadata in <code>/iplant/home/shared/commons_repo/curated</code></li> <li> <p>Curator requests write permission to the folder where the final dataset will live (in this case, <code>/iplant/home/shared/iVirus</code>) for both themselves and the user DOI-curators. </p> <p>Note</p> <p>External links are currently only for other folders within <code>/iplant/home/shared</code>. This could change, but then this SOP would need to change.</p> </li> <li> <p>Curator copies final dataset from <code>/iplant/home/shared/commons_repo/curated</code> to the new location. </p> </li> <li>Curator uses metadata copy function to copy the metadata from the location in <code>/iplant/home/shared/commons_repo/curated</code> to the new location.</li> <li>Curator changes permission in new folder so that only themselves and DOI-curators have write and own permission (DOI-curators is an iRODS group and permissions can only be assigned with iCommands. Everyone else's inherited permissions should be changed to read or removed.</li> <li>Curator adds read permissions to the new folder for users 'Public User' and 'Anonymous-Public Access'.</li> <li>Curator removes all files from the original dataset (in <code>/iplant/home/shared/commons_repo/curated</code>) except the readme file.</li> <li>Curator edits the metadata of the folder in <code>/iplant/home/shared/commons_repo/curated</code> to include a new attribute for <code>external_data_link</code> (must be spelled exactly like this to work). The value for that field should be the Data Commons link to the new copy of the dataset. For an example, see this metadata file. Once this is done, a link to the other location will automatically show up on the DC website, after it refreshes. </li> <li>Update URL for the DOI at DataCite Fabrica.</li> </ol>","path":["Administration Guide","De"],"tags":[]},{"location":"guides/de/#reference-genomes","level":3,"title":"Reference Genomes","text":"<p>Hosted reference genomes for featured genomic analyses</p>","path":["Administration Guide","De"],"tags":[]},{"location":"guides/de/#subscriptions","level":3,"title":"Subscriptions","text":"<p>View/Modify User account subscriptions for CPU hours and data storage capacity</p>","path":["Administration Guide","De"],"tags":[]},{"location":"guides/de/#tools","level":3,"title":"Tools","text":"<p>Create/Edit/Deprecate K8s templates for public Docker images hosted on public registries</p>","path":["Administration Guide","De"],"tags":[]},{"location":"guides/de/#vice-access","level":3,"title":"VICE Access","text":"<p>Grant access to interactive (K8s) run applications </p> <p>Limited access to verified accounts only.</p>","path":["Administration Guide","De"],"tags":[]},{"location":"guides/devops/","level":1,"title":"Playbooks","text":"<p>Ansible is an open source, agentless automation tool. The DE development team uses Ansible to provision/update our servers and deploy the DE. However, for this repository, we only expose the Ansible scripts that we use for deploying the DE. </p> <p>If you intend to use our ansible scripts, we highly suggest that you read the  Ansible documentation.</p>","path":["Administration Guide","Playbooks"],"tags":[]},{"location":"guides/devops/#installations","level":2,"title":"Installations","text":"<p> Ansible</p> <p> Docker</p> <p> Kubernetes (K8s) - <code>kubectl</code> for managing K8s clusters</p> <p> Terraform</p> <p>:simple-visualstudiocode: VS Code Kubernetes Extension - optional (recommended) </p>","path":["Administration Guide","Playbooks"],"tags":[]},{"location":"guides/devops/#setup","level":2,"title":"Setup","text":"<ul> <li> <p>Ansible Setup</p> </li> <li> <p>Docker-based Ansible Setup</p> </li> </ul>","path":["Administration Guide","Playbooks"],"tags":[]},{"location":"guides/devops/#design","level":2,"title":"Design","text":"<p>We have strived to follow Ansible's best practices.</p> <p>However, we have slightly diverged on the topics of  directory layout and role-separated top level playbooks.</p>","path":["Administration Guide","Playbooks"],"tags":[]},{"location":"guides/devops/#directory-layout","level":2,"title":"Directory Layout","text":"<p>The ansible best practices for directory layout suggests using a <code>group_vars</code> folder, but you may  have noticed that the repo doesn't contain a <code>ansible/group_vars</code> folder. Our default <code>group_vars</code>  folder resides in the <code>inventories</code> folder  <code>ansible/inventories/group_vars</code>.</p> <p>Also, this folder contains a single file, <code>all</code>, which contains all of the variables used by the  provided roles and playbooks with default values.</p> <p>This is done with the intent that developers will create their own <code>group_vars/all</code> file, which will override any of the defaults set in the <code>inventories/group_vars/all</code> file.</p> <p>You only need to include the variables you wish to override.</p>","path":["Administration Guide","Playbooks"],"tags":[]},{"location":"guides/devops/#role-separated-playbooks","level":2,"title":"Role-Separated Playbooks","text":"<p>We maintain role-separated playbooks, but they are kept in the  <code>ansible/playbooks/</code> folder. The  remaining playbooks in the root of the <code>ansible/</code> folder are composite (utilize more than one role) or one off playbooks (do not use any roles). </p> <p>If you wish to use these playbooks, we have created the  <code>single-role.yaml</code> playbook. </p> <p>The documentation on its use is contained within the playbook.</p>","path":["Administration Guide","Playbooks"],"tags":[]},{"location":"guides/devops/#inventories","level":2,"title":"Inventories","text":"<p>We have provided an example inventory file;  <code>example.cfg</code>. Our  roles and playbooks are written against the host groups in this inventory. Files with a <code>.cfg</code>  extension are ignored by git in the <code>inventories</code> folder. This is done to prevent us from  accidentally exposing our inventories to the public.</p> <p>The host groups within the example inventory reference the host machines for the DE's underlying  architecture, as well as host groups for the application itself. Each micro-service has a  corresponding host group in the inventory.</p> <p>Refer to the <code>example.cfg</code> file for more info.</p>","path":["Administration Guide","Playbooks"],"tags":[]},{"location":"guides/devops/#playbooks","level":1,"title":"Playbooks","text":"<ul> <li>Updating Databases</li> </ul>","path":["Administration Guide","Playbooks"],"tags":[]},{"location":"guides/ds/","level":1,"title":"Ds","text":"","path":["Administration Guide","Ds"],"tags":[]},{"location":"guides/ds/#container-storage-interface-csi-driver","level":2,"title":"Container Storage Interface (CSI) Driver","text":"","path":["Administration Guide","Ds"],"tags":[]},{"location":"guides/ds/#gocommands","level":2,"title":"GoCommands","text":"","path":["Administration Guide","Ds"],"tags":[]},{"location":"guides/ds/#3rd-party-applications","level":2,"title":"3<sup>rd</sup> Party Applications","text":"","path":["Administration Guide","Ds"],"tags":[]},{"location":"guides/ds/#cyberduck","level":3,"title":"Cyberduck","text":"","path":["Administration Guide","Ds"],"tags":[]},{"location":"guides/ds/#filezilla","level":3,"title":"FileZilla","text":"","path":["Administration Guide","Ds"],"tags":[]},{"location":"guides/ds/#sftp","level":3,"title":"SFTP","text":"","path":["Administration Guide","Ds"],"tags":[]},{"location":"guides/ds/#webdav","level":3,"title":"WebDAV","text":"","path":["Administration Guide","Ds"],"tags":[]},{"location":"guides/ds/#file-explorers","level":3,"title":"File Explorers","text":"","path":["Administration Guide","Ds"],"tags":[]},{"location":"guides/ds/#sharing-folders","level":2,"title":"Sharing Folders","text":"","path":["Administration Guide","Ds"],"tags":[]},{"location":"guides/ds/#community-released-folder-creation","level":2,"title":"Community Released Folder Creation","text":"","path":["Administration Guide","Ds"],"tags":[]},{"location":"guides/ds/#curated-folders","level":2,"title":"Curated Folders","text":"<p>DataCite DOI</p>","path":["Administration Guide","Ds"],"tags":[]},{"location":"guides/faq/","level":1,"title":"Frequently Asked Questions (FAQ)","text":"<p>Common questions about deploying, administering, and developing with CyVerse infrastructure.</p>","path":["Administration Guide","Frequently Asked Questions (FAQ)"],"tags":[]},{"location":"guides/faq/#deployment-installation","level":2,"title":"Deployment &amp; Installation","text":"","path":["Administration Guide","Frequently Asked Questions (FAQ)"],"tags":[]},{"location":"guides/faq/#how-do-i-deploy-cyverse-on-my-infrastructure","level":3,"title":"How do I deploy CyVerse on my infrastructure?","text":"<p>Start with the Getting Started Guide to review prerequisites, then follow the Deployment Guide for step-by-step deployment instructions. The deployment follows this sequence:</p> <ol> <li>Deploy Kubernetes cluster</li> <li>Set up storage (OpenEBS) and networking (Ingress NGINX)</li> <li>Deploy core services (KeyCloak, RabbitMQ, Redis, ElasticSearch)</li> <li>Provision databases</li> <li>Deploy application services (Discovery Environment, User Portal, VICE)</li> </ol> <p>See the deployment roadmap for detailed phase breakdown.</p>","path":["Administration Guide","Frequently Asked Questions (FAQ)"],"tags":[]},{"location":"guides/faq/#what-are-the-minimum-hardware-requirements","level":3,"title":"What are the minimum hardware requirements?","text":"<p>Minimum recommended configuration:</p> <ul> <li>8-node Kubernetes cluster</li> <li>32 CPU cores per node (256 cores total)</li> <li>128GB RAM per node (1TB total)</li> <li>10TB+ persistent storage (NFS, iRODS, or cloud block storage)</li> <li>10 Gbps network connectivity</li> <li>Public IP addresses for ingress services</li> </ul> <p>For smaller deployments (testing/development): - 3-node cluster - 16 cores per node - 64GB RAM per node - 1TB storage</p> <p>See Prerequisites for complete requirements.</p>","path":["Administration Guide","Frequently Asked Questions (FAQ)"],"tags":[]},{"location":"guides/faq/#can-i-deploy-cyverse-on-commercial-cloud-providers-aws-gcp-azure","level":3,"title":"Can I deploy CyVerse on commercial cloud providers (AWS, GCP, Azure)?","text":"<p>Yes! CyVerse can be deployed on:</p> <ul> <li>:simple-amazonaws: AWS - Use EKS for Kubernetes, EBS for storage</li> <li> Google Cloud - Use GKE for Kubernetes, Persistent Disks for storage</li> <li>:simple-azuredevops: Azure - Use AKS for Kubernetes, Azure Disks for storage</li> <li> OpenStack - CyVerse's primary cloud platform</li> </ul> <p>You'll need to adapt storage provisioning and load balancer configurations for your cloud provider. See the Kubernetes deployment guide.</p>","path":["Administration Guide","Frequently Asked Questions (FAQ)"],"tags":[]},{"location":"guides/faq/#what-kubernetes-distribution-should-i-use","level":3,"title":"What Kubernetes distribution should I use?","text":"<p>CyVerse is tested with:</p> <ul> <li>Upstream Kubernetes (1.23+) - Recommended for most deployments</li> <li>OpenShift - Enterprise Kubernetes with additional security features</li> <li>Rancher - Kubernetes management platform</li> <li>Cloud-managed Kubernetes - EKS, GKE, AKS</li> </ul> <p>Use the latest stable Kubernetes version supported by your distribution.</p>","path":["Administration Guide","Frequently Asked Questions (FAQ)"],"tags":[]},{"location":"guides/faq/#how-long-does-a-full-cyverse-deployment-take","level":3,"title":"How long does a full CyVerse deployment take?","text":"<p>Typical timeline (experienced DevOps team):</p> <ul> <li>Weeks 1-2: Infrastructure setup (Kubernetes, storage, networking)</li> <li>Week 3: Core services deployment (KeyCloak, RabbitMQ, Redis, ElasticSearch)</li> <li>Week 4: Database provisioning and configuration</li> <li>Weeks 5-6: Application deployment (DE, User Portal, VICE)</li> <li>Week 7: Testing, tuning, and documentation</li> </ul> <p>Total: 7-8 weeks for initial production deployment.</p> <p>Development/testing environments can be deployed faster (2-3 weeks).</p>","path":["Administration Guide","Frequently Asked Questions (FAQ)"],"tags":[]},{"location":"guides/faq/#do-i-need-to-deploy-all-cyverse-services","level":3,"title":"Do I need to deploy all CyVerse services?","text":"<p>No! CyVerse is modular. You can deploy:</p> <ul> <li>Core only: Discovery Environment for computational workflows</li> <li>Data Store only: iRODS-based data management</li> <li>Custom subset: Select services for your use case</li> </ul> <p>All services require Kubernetes, PostgreSQL databases, and KeyCloak authentication.</p>","path":["Administration Guide","Frequently Asked Questions (FAQ)"],"tags":[]},{"location":"guides/faq/#how-do-i-updateupgrade-cyverse-services","level":3,"title":"How do I update/upgrade CyVerse services?","text":"<p>Updates are managed through:</p> <ol> <li>Helm chart updates - Pull latest charts from repository</li> <li>Container image updates - Reference new image tags in deployments</li> <li>Database migrations - Run migration scripts before deploying new versions</li> <li>Rolling updates - Kubernetes handles zero-downtime deployments</li> </ol> <p>Always test updates in a staging environment first. See deployment documentation.</p>","path":["Administration Guide","Frequently Asked Questions (FAQ)"],"tags":[]},{"location":"guides/faq/#administration","level":2,"title":"Administration","text":"","path":["Administration Guide","Frequently Asked Questions (FAQ)"],"tags":[]},{"location":"guides/faq/#how-do-i-grant-vice-access-to-a-user","level":3,"title":"How do I grant VICE access to a user?","text":"<p>VICE (Visual Interactive Computing Environment) access is granted through the Discovery Environment admin interface:</p> <ol> <li>Log into the Discovery Environment as an administrator</li> <li>Navigate to Admin â User Management</li> <li>Search for the user</li> <li>Grant \"VICE Access\" permission</li> <li>User must meet requirements: valid account, accepted terms of service, sufficient quota</li> </ol> <p>See DE Administration Guide for detailed procedures.</p>","path":["Administration Guide","Frequently Asked Questions (FAQ)"],"tags":[]},{"location":"guides/faq/#how-do-i-process-a-doipermanent-id-request","level":3,"title":"How do I process a DOI/Permanent ID request?","text":"<p>DOI requests for data publishing follow this workflow:</p> <ol> <li>User submits request through Discovery Environment (Data â Permanent ID Request)</li> <li>Admin receives notification</li> <li>Review submission in admin interface for completeness</li> <li>Validate metadata and data quality</li> <li>Approve request - system creates DOI via DataCite</li> <li>Notify user of published DOI</li> </ol> <p>See Permanent ID Requests documentation for complete SOP.</p>","path":["Administration Guide","Frequently Asked Questions (FAQ)"],"tags":[]},{"location":"guides/faq/#how-do-i-add-a-new-application-to-the-discovery-environment","level":3,"title":"How do I add a new application to the Discovery Environment?","text":"<p>Publishing a containerized app to DE:</p> <ol> <li>Containerize your tool - Create Docker image with tool/software</li> <li>Push to registry - Upload to Docker Hub or Harbor</li> <li>Create integration - Use DE \"Apps\" interface to define:</li> <li>Input files</li> <li>Parameters</li> <li>Output files</li> <li>Resource requirements</li> <li>Test privately - Validate app functionality</li> <li>Publish publicly - Make available to all users</li> </ol> <p>See DE Administration Guide for step-by-step instructions.</p>","path":["Administration Guide","Frequently Asked Questions (FAQ)"],"tags":[]},{"location":"guides/faq/#how-do-i-manage-user-storage-quotas","level":3,"title":"How do I manage user storage quotas?","text":"<p>Storage quotas are managed through:</p> <ul> <li>iRODS resource management - Set per-user/per-group quotas in iRODS</li> <li>User Portal - Display quota usage to users</li> <li>Admin tools - Monitor and adjust quotas as needed</li> </ul> <p>Contact users approaching quota limits and provide options (clean up data, request increase, archive to cold storage).</p>","path":["Administration Guide","Frequently Asked Questions (FAQ)"],"tags":[]},{"location":"guides/faq/#how-do-i-back-up-cyverse-databases","level":3,"title":"How do I back up CyVerse databases?","text":"<p>Database backup strategy:</p> <pre><code># PostgreSQL backup example\npg_dump -h db-host -U username -d de_database &gt; de_backup.sql\n\n# Automated daily backups\n0 2 * * * /usr/local/bin/backup-cyverse-dbs.sh\n</code></pre> <p>Backup all service databases: - DE database - Metadata database - Notifications database - KeyCloak database - QMS database - Grouper database - Portal database - Unleash database</p> <p>See Database documentation for detailed backup procedures.</p>","path":["Administration Guide","Frequently Asked Questions (FAQ)"],"tags":[]},{"location":"guides/faq/#how-do-i-troubleshoot-service-failures","level":3,"title":"How do I troubleshoot service failures?","text":"<p>Systematic troubleshooting approach:</p> <ol> <li>Check pod status: <code>kubectl get pods -n &lt;namespace&gt;</code></li> <li>View logs: <code>kubectl logs -n &lt;namespace&gt; &lt;pod-name&gt;</code></li> <li>Check events: <code>kubectl describe pod -n &lt;namespace&gt; &lt;pod-name&gt;</code></li> <li>Verify dependencies: Ensure databases, RabbitMQ, Redis are accessible</li> <li>Check resource limits: CPU/memory constraints can cause crashes</li> <li>Review recent changes: Configuration updates, deployments, network changes</li> </ol> <p>Common issues: - Database connection failures (check credentials, network) - Out of memory (increase resource limits) - Image pull errors (check registry access) - Configuration errors (validate YAML syntax)</p>","path":["Administration Guide","Frequently Asked Questions (FAQ)"],"tags":[]},{"location":"guides/faq/#how-do-i-add-a-new-administrator","level":3,"title":"How do I add a new administrator?","text":"<p>Administrator permissions are managed through KeyCloak:</p> <ol> <li>Log into KeyCloak admin console</li> <li>Navigate to Users</li> <li>Find or create the user</li> <li>Assign admin role:</li> <li><code>de-admin</code> for Discovery Environment</li> <li><code>data-store-admin</code> for Data Store</li> <li><code>super-admin</code> for platform-wide access</li> <li>User logs out and back in to activate permissions</li> </ol> <p>See KeyCloak documentation for role management.</p>","path":["Administration Guide","Frequently Asked Questions (FAQ)"],"tags":[]},{"location":"guides/faq/#api-development","level":2,"title":"API &amp; Development","text":"","path":["Administration Guide","Frequently Asked Questions (FAQ)"],"tags":[]},{"location":"guides/faq/#how-do-i-authenticate-with-the-terrain-api","level":3,"title":"How do I authenticate with the Terrain API?","text":"<p>Terrain uses OAUTH 2.0 authentication via KeyCloak:</p> <p>Method 1: Get token via browser (authorization code flow) 1. Direct user to KeyCloak authorization URL 2. User authorizes your application 3. Exchange authorization code for access token</p> <p>Method 2: Get token via command line (password flow) <pre><code>TOKEN=$(curl -s -X POST \\\n  https://kc.cyverse.org/auth/realms/CyVerse/protocol/openid-connect/token \\\n  -d \"grant_type=password\" \\\n  -d \"client_id=de-client\" \\\n  -d \"username=YOUR_USERNAME\" \\\n  -d \"password=YOUR_PASSWORD\" \\\n  | jq -r '.access_token')\n</code></pre></p> <p>Use token in API calls: <pre><code>curl -H \"Authorization: Bearer $TOKEN\" \\\n  https://de.cyverse.org/terrain/filesystem/list\n</code></pre></p> <p>See Developer Guide for complete examples.</p>","path":["Administration Guide","Frequently Asked Questions (FAQ)"],"tags":[]},{"location":"guides/faq/#where-can-i-find-the-complete-api-documentation","level":3,"title":"Where can I find the complete API documentation?","text":"<ul> <li>Live Swagger UI - Interactive API testing</li> <li>Endpoint Index - Complete endpoint reference</li> <li>API Overview - Terrain API introduction</li> <li>Error Codes - Error handling guide</li> </ul> <p>All Terrain endpoints are documented with request/response schemas and examples.</p>","path":["Administration Guide","Frequently Asked Questions (FAQ)"],"tags":[]},{"location":"guides/faq/#how-do-i-migrate-from-tapis-v2-to-tapis-v3","level":3,"title":"How do I migrate from Tapis v2 to Tapis v3?","text":"<p>Tapis v3 introduces breaking changes. Follow the Tapis v2 to v3 Migration Guide which covers:</p> <ul> <li>API endpoint changes</li> <li>Authentication updates</li> <li>Request/response format changes</li> <li>Deprecated features</li> <li>New capabilities</li> </ul> <p>Plan for code changes in your integrations.</p>","path":["Administration Guide","Frequently Asked Questions (FAQ)"],"tags":[]},{"location":"guides/faq/#what-are-the-api-rate-limits","level":3,"title":"What are the API rate limits?","text":"<p>Current rate limiting (subject to change):</p> <ul> <li>100 requests/minute per user for authenticated endpoints</li> <li>10 requests/minute for unauthenticated endpoints</li> <li>Burst limit: 150 requests in 10 seconds</li> </ul> <p>If you exceed limits, you'll receive <code>HTTP 429 Too Many Requests</code>. Implement exponential backoff in your client code.</p> <p>For higher limits, contact CyVerse support with your use case.</p>","path":["Administration Guide","Frequently Asked Questions (FAQ)"],"tags":[]},{"location":"guides/faq/#how-do-i-upload-large-files-via-the-api","level":3,"title":"How do I upload large files via the API?","text":"<p>For large files (&gt;100MB), use the chunked upload endpoint:</p> <pre><code>import requests\n\ndef upload_large_file(access_token, local_file, dest_path, chunk_size=10*1024*1024):\n    \"\"\"Upload large file in chunks.\"\"\"\n    # 1. Initialize upload session\n    init_response = requests.post(\n        \"https://de.cyverse.org/terrain/secured/fileio/upload-init\",\n        headers={\"Authorization\": f\"Bearer {access_token}\"},\n        json={\"dest\": dest_path, \"filename\": \"largefile.dat\"}\n    )\n    upload_id = init_response.json()[\"upload_id\"]\n\n    # 2. Upload chunks\n    with open(local_file, \"rb\") as f:\n        chunk_num = 0\n        while True:\n            chunk = f.read(chunk_size)\n            if not chunk:\n                break\n            requests.post(\n                f\"https://de.cyverse.org/terrain/secured/fileio/upload-chunk/{upload_id}\",\n                headers={\"Authorization\": f\"Bearer {access_token}\"},\n                files={\"chunk\": chunk},\n                data={\"chunk_number\": chunk_num}\n            )\n            chunk_num += 1\n\n    # 3. Finalize upload\n    requests.post(\n        f\"https://de.cyverse.org/terrain/secured/fileio/upload-complete/{upload_id}\",\n        headers={\"Authorization\": f\"Bearer {access_token}\"}\n    )\n</code></pre> <p>See File I/O endpoints for details.</p>","path":["Administration Guide","Frequently Asked Questions (FAQ)"],"tags":[]},{"location":"guides/faq/#how-do-i-receive-notifications-when-my-job-completes","level":3,"title":"How do I receive notifications when my job completes?","text":"<p>Enable notifications when submitting a job:</p> <pre><code>payload = {\n    \"app_id\": \"app-uuid\",\n    \"name\": \"My Job\",\n    \"notify\": True,  # Enable notifications\n    \"config\": {...}\n}\n</code></pre> <p>You'll receive notifications via: - In-app notifications in Discovery Environment - Email (if configured in user preferences) - Webhook callbacks (if configured)</p> <p>See Notifications API and Callbacks API.</p>","path":["Administration Guide","Frequently Asked Questions (FAQ)"],"tags":[]},{"location":"guides/faq/#can-i-run-the-api-locally-for-development","level":3,"title":"Can I run the API locally for development?","text":"<p>Yes! Clone the terrain repository and other services:</p> <pre><code># Clone terrain\ngit clone https://github.com/cyverse-de/terrain.git\ncd terrain\n\n# Install dependencies (Clojure/Leiningen)\nlein deps\n\n# Configure local settings\ncp config/terrain.properties.example config/terrain.properties\n# Edit config to point to local databases\n\n# Run locally\nlein run\n</code></pre> <p>See repository README files for service-specific setup instructions.</p>","path":["Administration Guide","Frequently Asked Questions (FAQ)"],"tags":[]},{"location":"guides/faq/#troubleshooting","level":2,"title":"Troubleshooting","text":"","path":["Administration Guide","Frequently Asked Questions (FAQ)"],"tags":[]},{"location":"guides/faq/#why-cant-users-log-in-to-the-discovery-environment","level":3,"title":"Why can't users log in to the Discovery Environment?","text":"<p>Common authentication issues:</p> <ol> <li>KeyCloak service down - Check <code>kubectl get pods -n keycloak</code></li> <li>Database connection failure - KeyCloak can't reach its database</li> <li>LDAP sync issues - If using LDAP, verify connection to LDAP server</li> <li>Browser cache/cookies - Have user clear browser cache and try incognito</li> <li>CILogon integration broken - Check CILogon service status</li> <li>Certificate issues - Verify TLS certificates are valid</li> </ol> <p>Debug steps: <pre><code># Check KeyCloak logs\nkubectl logs -n keycloak deployment/keycloak\n\n# Test database connection\nkubectl exec -it -n keycloak deployment/keycloak -- psql -h db-host -U keycloak\n\n# Verify LDAP connectivity\nkubectl exec -it -n keycloak deployment/keycloak -- ldapsearch -x -H ldap://ldap-server\n</code></pre></p>","path":["Administration Guide","Frequently Asked Questions (FAQ)"],"tags":[]},{"location":"guides/faq/#why-is-the-data-store-slow","level":3,"title":"Why is the Data Store slow?","text":"<p>Performance bottlenecks:</p> <ol> <li>iRODS server overload - Check CPU/memory on iRODS servers</li> <li>Network congestion - Verify network bandwidth between nodes</li> <li>Slow storage backend - Check underlying storage performance (NFS, SAN)</li> <li>Database issues - iRODS catalog queries slow</li> <li>Too many concurrent users - Consider scaling iRODS servers</li> </ol> <p>Monitoring: <pre><code># Check iRODS server status\nils -L  # List with verbose output, observe latency\n\n# Monitor iRODS resource usage\nkubectl top pods -n irods\n\n# Check network performance\niperf3 -c irods-server\n</code></pre></p> <p>See Data Store documentation for optimization tips.</p>","path":["Administration Guide","Frequently Asked Questions (FAQ)"],"tags":[]},{"location":"guides/faq/#why-are-jobs-stuck-in-submitted-status","level":3,"title":"Why are jobs stuck in \"Submitted\" status?","text":"<p>Job execution issues:</p> <ol> <li>HTCondor/K8s not processing jobs - Check job execution platform</li> <li>Insufficient resources - No available compute nodes</li> <li>Input staging failures - Data transfer from Data Store failed</li> <li>App configuration errors - Invalid app definition</li> <li>Permission issues - User lacks access to required resources</li> </ol> <p>Debug steps: <pre><code># Check HTCondor queue (for batch jobs)\ncondor_q -analyze &lt;job-id&gt;\n\n# Check Kubernetes pods (for VICE jobs)\nkubectl get pods -n vice-apps\n\n# Check analyses service logs\nkubectl logs -n de deployment/analyses\n</code></pre></p>","path":["Administration Guide","Frequently Asked Questions (FAQ)"],"tags":[]},{"location":"guides/faq/#jobs-are-failing-with-out-of-memory-errors","level":3,"title":"Jobs are failing with \"Out of Memory\" errors","text":"<p>Memory issues:</p> <ol> <li>Insufficient container limits - Increase memory limit in app definition</li> <li>User requested too little memory - Guide users to request appropriate resources</li> <li>Node exhaustion - Add more Kubernetes nodes or increase node sizes</li> <li>Memory leaks in tool - Issue with the containerized tool itself</li> </ol> <p>Solutions: - Increase memory limits: Edit app in DE Apps interface - Add resource quotas: Define default/max memory for different app categories - Scale cluster: Add more compute nodes</p> <p>See Kubernetes resources documentation.</p>","path":["Administration Guide","Frequently Asked Questions (FAQ)"],"tags":[]},{"location":"guides/faq/#elasticsearch-is-using-too-much-disk-space","level":3,"title":"ElasticSearch is using too much disk space","text":"<p>ElasticSearch index management:</p> <pre><code># Check index sizes\ncurl -X GET \"localhost:9200/_cat/indices?v&amp;s=store.size:desc\"\n\n# Delete old indices\ncurl -X DELETE \"localhost:9200/old-index-name\"\n\n# Set up index lifecycle management (ILM)\ncurl -X PUT \"localhost:9200/_ilm/policy/cleanup-policy\" -H 'Content-Type: application/json' -d'\n{\n  \"policy\": {\n    \"phases\": {\n      \"delete\": {\n        \"min_age\": \"30d\",\n        \"actions\": {\"delete\": {}}\n      }\n    }\n  }\n}'\n</code></pre> <p>See ElasticSearch deployment documentation.</p>","path":["Administration Guide","Frequently Asked Questions (FAQ)"],"tags":[]},{"location":"guides/faq/#data-management","level":2,"title":"Data Management","text":"","path":["Administration Guide","Frequently Asked Questions (FAQ)"],"tags":[]},{"location":"guides/faq/#how-do-i-share-data-with-collaborators","level":3,"title":"How do I share data with collaborators?","text":"<p>Data sharing options:</p> <ol> <li> <p>Share within CyVerse - Give users/groups read or write permissions    <pre><code># Via Data Store API\nPOST /terrain/secured/filesystem/share\n{\n  \"paths\": [\"/iplant/home/user/folder\"],\n  \"permissions\": [\"read\"],\n  \"users\": [\"collaborator1\", \"collaborator2\"]\n}\n</code></pre></p> </li> <li> <p>Public links - Create anonymous access tickets</p> </li> <li> <p>In DE: Right-click file/folder â Share â Create Public Link</p> </li> <li> <p>DOI publication - Publish to Data Commons with permanent identifier</p> </li> </ol> <p>See Sharing API and Data Store Guide.</p>","path":["Administration Guide","Frequently Asked Questions (FAQ)"],"tags":[]},{"location":"guides/faq/#how-do-i-search-for-data-across-the-entire-data-store","level":3,"title":"How do I search for data across the entire Data Store?","text":"<p>Use the search API:</p> <pre><code>curl -H \"Authorization: Bearer $TOKEN\" \\\n  -X POST https://de.cyverse.org/terrain/secured/filesystem/search \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"query\": \"genomics\", \"type\": \"file\"}'\n</code></pre> <p>Search supports: - Full-text search in filenames and metadata - Filters by file type, date, size - User-defined metadata (AVU) searches</p> <p>See Search API documentation.</p>","path":["Administration Guide","Frequently Asked Questions (FAQ)"],"tags":[]},{"location":"guides/faq/#how-do-i-attach-metadata-to-data-files","level":3,"title":"How do I attach metadata to data files?","text":"<p>Add Attribute-Value-Unit (AVU) metadata:</p> <pre><code># Add metadata via API\nrequests.post(\n    \"https://de.cyverse.org/terrain/secured/filesystem/metadata\",\n    headers={\"Authorization\": f\"Bearer {token}\"},\n    json={\n        \"path\": \"/iplant/home/user/data.csv\",\n        \"metadata\": [\n            {\"attr\": \"experiment_date\", \"value\": \"2024-01-15\", \"unit\": \"\"},\n            {\"attr\": \"sample_size\", \"value\": \"1000\", \"unit\": \"samples\"}\n        ]\n    }\n)\n</code></pre> <p>Or use the DE interface: Right-click file â Metadata â Add</p> <p>See Metadata API.</p>","path":["Administration Guide","Frequently Asked Questions (FAQ)"],"tags":[]},{"location":"guides/faq/#how-do-i-recover-deleted-data","level":3,"title":"How do I recover deleted data?","text":"<p>Deleted files go to trash and can be restored within 30 days:</p> <p>Via Discovery Environment: 1. Navigate to Trash folder 2. Select files/folders to restore 3. Click \"Restore\"</p> <p>Via API: <pre><code>curl -H \"Authorization: Bearer $TOKEN\" \\\n  -X POST https://de.cyverse.org/terrain/secured/filesystem/restore \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"paths\": [\"/iplant/trash/user/deleted-folder\"]}'\n</code></pre></p> <p>After 30 days, files are permanently deleted. Implement backups for critical data.</p> <p>See Restore API.</p>","path":["Administration Guide","Frequently Asked Questions (FAQ)"],"tags":[]},{"location":"guides/faq/#whats-the-maximum-file-size-i-can-store","level":3,"title":"What's the maximum file size I can store?","text":"<p>File size limits:</p> <ul> <li>Single file: No hard limit (tested up to 100+ GB)</li> <li>Upload via web UI: 2 GB recommended (browser limitations)</li> <li>Upload via API/CLI: No limit</li> <li>iCommands (iRODS CLI): Recommended for files &gt;2 GB</li> </ul> <p>For very large files (&gt;100 GB), use: - iCommands: <code>iput</code> for direct iRODS uploads - GoCommands: CyVerse's modern iRODS CLI - Globus: For scheduled large transfers</p> <p>See Data Store documentation.</p>","path":["Administration Guide","Frequently Asked Questions (FAQ)"],"tags":[]},{"location":"guides/faq/#still-have-questions","level":2,"title":"Still Have Questions?","text":"<ul> <li>Search this documentation - Use the search bar at the top</li> <li>Check service-specific docs - See Deployment Guide, API Reference, or Admin Guides</li> <li>GitHub Issues - Report issues or ask questions at github.com/cyverse-de</li> <li>CyVerse Support - Contact support at cyverse.org/help</li> </ul>","path":["Administration Guide","Frequently Asked Questions (FAQ)"],"tags":[]},{"location":"guides/user_portal/","level":1,"title":"User portal","text":"<p> CyVerse User Portal Admin Panel</p>","path":["Administration Guide","User portal"],"tags":[]},{"location":"guides/user_portal/#administrative-panel","level":2,"title":"Administrative Panel","text":"","path":["Administration Guide","User portal"],"tags":[]},{"location":"guides/user_portal/#users","level":3,"title":"Users","text":"<p>Search across all CyVerse users and view details about individual users.</p>","path":["Administration Guide","User portal"],"tags":[]},{"location":"guides/user_portal/#restricted-usernames","level":3,"title":"Restricted Usernames","text":"<p>Show and edit restricted usernames.</p>","path":["Administration Guide","User portal"],"tags":[]},{"location":"guides/user_portal/#access-requests","level":3,"title":"Access Requests","text":"<p>Search across all access requests and view/deny/approve individual requests.</p>","path":["Administration Guide","User portal"],"tags":[]},{"location":"guides/user_portal/#services","level":3,"title":"Services","text":"<p>View and modify services.</p>","path":["Administration Guide","User portal"],"tags":[]},{"location":"guides/user_portal/#workshops","level":3,"title":"Workshops","text":"<p>View, create, and modify workshops.</p>","path":["Administration Guide","User portal"],"tags":[]},{"location":"guides/user_portal/#form-submissions","level":3,"title":"Form Submissions","text":"<p>Search across all form submissions and view individual submissions.</p>","path":["Administration Guide","User portal"],"tags":[]},{"location":"guides/user_portal/#forms","level":3,"title":"Forms","text":"<p>View and edit forms.</p>","path":["Administration Guide","User portal"],"tags":[]},{"location":"guides/setup/ansible/","level":1,"title":"Ansible","text":"","path":["Deployment Guide","Prerequisites & Setup","Ansible"],"tags":[]},{"location":"guides/setup/ansible/#installing-ansible","level":2,"title":"Installing Ansible","text":"<p>See http://docs.ansible.com/intro_installation.html for the long instructions.</p> <p>There's multiple ways to install ansible. I used Python's 'pip' command to install it on OS X, but you can also use homebrew or a git checkout.</p> <p>pip</p> <pre><code>sudo pip install ansible\n</code></pre> <p>homebrew</p> <pre><code>brew install ansible\n</code></pre> <p>checkout</p> <pre><code>git clone git://github.com/ansible/ansible.git\ncd ./ansible\nsource ./hacking/env-setup\n</code></pre> <p>If you use the checkout method, add a line to your ~/.profile (on OS X) or your ~/.bashrc file (all other sane OSes).</p> <p>You only need ansible on your local machine. It does not need to be installed on the servers.</p>","path":["Deployment Guide","Prerequisites & Setup","Ansible"],"tags":[]},{"location":"guides/setup/ansible/#installing-third-party-ansible-roles","level":2,"title":"Installing Third Party Ansible Roles","text":"<p>See http://docs.ansible.com/galaxy.html for more information about managing third party roles.</p> <p>In brief, you'll need to sign up for galaxy at https://galaxy.ansible.com and execute the following command in the de-ansible repo.</p> <pre><code>ansible-galaxy install --force -r requirements.yaml\n</code></pre>","path":["Deployment Guide","Prerequisites & Setup","Ansible"],"tags":[]},{"location":"guides/setup/ansible/#learning-about-ansible","level":2,"title":"Learning About Ansible","text":"<p>If you just want to use ansible for DE related tasks, move on to the other sections.</p> <p>If you want to make your own playbooks for existing inventories of servers, read: http://docs.ansible.com/playbooks_intro.html.</p> <p>If you want to create a new inventory or modify an existing one, read: http://docs.ansible.com/intro_inventory.html.</p> <p>Each playbook uses one or more modules. Modules encapsulate operations that run on servers and make them idempotent. There are a lot of existing modules, which you can read about at http://docs.ansible.com/modules_by_category.html.</p>","path":["Deployment Guide","Prerequisites & Setup","Ansible"],"tags":[]},{"location":"guides/setup/ansible/#ansible-config-settings","level":2,"title":"Ansible Config Settings","text":"<p>The design of the DE's ansible variables makes use of YAML \"hashes\". If you ever intend to  override a single value in a hash, you will need to set ansible's hash behaviour to \"merge\". The easiest way to set these are with environment variables. For example, add these lines to your <code>~/.bash_profile</code> or <code>~/.bashrc</code> file:</p> <pre><code>export ANSIBLE_HASH_BEHAVIOUR=\"merge\"\n</code></pre> <p>Or these settings can be updated in a local <code>ansible.cfg</code>.</p>","path":["Deployment Guide","Prerequisites & Setup","Ansible"],"tags":[]},{"location":"guides/setup/ansible/#preparing-servers","level":2,"title":"Preparing Servers","text":"","path":["Deployment Guide","Prerequisites & Setup","Ansible"],"tags":[]},{"location":"guides/setup/ansible/#simplejson","level":3,"title":"simplejson","text":"<p>Each server needs to have the simplejson Python library available for the default Python installation.</p> <p>CentOS â</p> <pre><code>sudo yum install python-simplejson\n</code></pre> <p>This should already be done for the development servers.</p>","path":["Deployment Guide","Prerequisites & Setup","Ansible"],"tags":[]},{"location":"guides/setup/ansible/#curl","level":3,"title":"curl","text":"<p>Each server needs to have curl on it so ansible can send messages to chat.  curl is provided by default on CentOS distributions, It needs to be manually installed on Ubuntu systems.</p> <p>Ubuntu</p> <pre><code>sudo apt-get install curl\n</code></pre>","path":["Deployment Guide","Prerequisites & Setup","Ansible"],"tags":[]},{"location":"guides/setup/ansible/#httplib2","level":3,"title":"httplib2","text":"<p>Each server needs to have httplib2 Python library available for the default Python installation. It needs to be manually installed on Ubuntu and CentOS 6 systems.</p>","path":["Deployment Guide","Prerequisites & Setup","Ansible"],"tags":[]},{"location":"guides/setup/ansible/#todo-is-manual-installation-still-necessary-the-private-registry-image-builder-role-installs-it-with-pip-on-centos7-systems-at-least","level":5,"title":"TODO: Is manual installation still necessary? The private-registry-image-builder role installs it with pip (on CentOS7 systems at least).","text":"<p>Ubuntu</p> <pre><code>sudo apt-get install python-httplib2\n</code></pre> <p>CentOS 6</p> <pre><code>sudo yum install python-httplib2\n</code></pre>","path":["Deployment Guide","Prerequisites & Setup","Ansible"],"tags":[]},{"location":"guides/setup/ansible/#setting-up-your-accounts","level":2,"title":"Setting Up Your Accounts","text":"<p>You will need passwordless ssh access to each of the servers listed in the inventory for the environment you're working in.</p>","path":["Deployment Guide","Prerequisites & Setup","Ansible"],"tags":[]},{"location":"guides/setup/ansible/#generate-rsa-private-and-public-keys","level":3,"title":"Generate RSA private and public keys","text":"<p>If you do not already have a ~/.ssh/id_rsa.pub file generated, then run this command to create it:</p> <pre><code>ssh-keygen -t rsa\n</code></pre>","path":["Deployment Guide","Prerequisites & Setup","Ansible"],"tags":[]},{"location":"guides/setup/ansible/#install-ssh-copy-id","level":3,"title":"Install ssh-copy-id","text":"<p>See https://github.com/beautifulcode/ssh-copy-id-for-OSX for instructions on setting up ssh-copy-id on OS X.</p>","path":["Deployment Guide","Prerequisites & Setup","Ansible"],"tags":[]},{"location":"guides/setup/ansible/#copying-ssh-keys","level":3,"title":"Copying ssh keys","text":"<pre><code>ssh-copy-id -i &lt;path-to-public-key&gt; &lt;server&gt;\n</code></pre> <p>For example:</p> <pre><code>ssh-copy-id -i ~/.ssh/id_rsa.pub user@example.iplantcollaborative.org\n</code></pre> <p>Do that for each of the servers in the inventory. I'd recommend setting up an SSH config that has entries for each of the servers (include the fully-qualified domain name) first; it will allow you to skip a lot of typing.</p> <p>Next, you need to generate entries in ~/.ssh/known_hosts for each of the servers. The easiest way to do this is to ssh into each of the servers once after you've set up passwordless ssh access. You need to SSH into the fully-qualified domain name of the host. For example:</p> <pre><code>ssh example.iplantcollaborative.org\n</code></pre> <p>You will also need sudo access on those servers for some operations. You should already have this if you're in the dev group on the servers.</p>","path":["Deployment Guide","Prerequisites & Setup","Ansible"],"tags":[]},{"location":"guides/setup/database/","level":1,"title":"Database","text":"","path":["Deployment Guide","Prerequisites & Setup","Database"],"tags":[]},{"location":"guides/setup/database/#updating-the-de-database","level":2,"title":"Updating the DE database","text":"<pre><code>ansible-playbook -i inventories/... -K [-u &lt;user&gt;] db-migrations.yaml\n</code></pre> <p>The <code>-i</code>, <code>-K</code>, and <code>-u</code> options are the same as in the other Ansible commands.</p>","path":["Deployment Guide","Prerequisites & Setup","Database"],"tags":[]},{"location":"guides/setup/docker/","level":1,"title":"Docker","text":"","path":["Deployment Guide","Prerequisites & Setup","Docker"],"tags":[]},{"location":"guides/setup/docker/#osx","level":2,"title":"OSX","text":"<p>To build on OS X, see Get Started with Docker for Mac OS X for instructions on installing Docker Toolbox</p>","path":["Deployment Guide","Prerequisites & Setup","Docker"],"tags":[]},{"location":"guides/setup/docker/#running-ansible-inside-a-docker-container","level":2,"title":"Running ansible inside a Docker container","text":"<p>The Dockerfile at the top-level of the de-ansible checkout can be used to create a personal container that is able to run the de-ansible playbooks.</p> <p>DO NOT PUSH YOUR PERSONAL de-ansible CONTAINER!</p> <p>To build the container, first run the create-ssh-configs.sh script at the top-level of the de-ansible checkout:</p> <pre><code>de-ansible&gt; ./create-ssh-configs.sh\n</code></pre> <p>Then run docker build:</p> <pre><code>de-ansible&gt; docker build .\n</code></pre> <p>Make a note of the image ID and use it in a docker run command:</p> <pre><code>de-ansible&gt; docker run --rm -it -v $(pwd):/de-ansible -w /de-ansible &lt;image ID&gt; /bin/bash\n</code></pre> <p>You should be able to run the ansible commands inside the container you created.</p>","path":["Deployment Guide","Prerequisites & Setup","Docker"],"tags":[]},{"location":"services/api_overview/","level":1,"title":"Terrain","text":"<p>Terrain provides the primary point of communication between the Discovery Environment (DE) UI and backend services. </p> <p>It's charged with two primary tasks: </p> <p>(1) to handle authentication and authorization for endpoints that require it, </p> <p>(2) to orchestrate calls to other lower-level services.</p> <p>The primary and most current source for Terrain API endpoint documentation are the Swagger docs hosted by the service itself: https://de.cyverse.org/terrain/docs</p> <p>Not all endpoints have been documented in those Swagger docs yet, and those endpoints will be listed under the default Swagger category. The documentation for those endpoints may still be found below.</p> <ul> <li> <p>Endpoints</p> </li> <li> <p>Endpoints Index</p> </li> <li> <p>Errors</p> </li> </ul>","path":["API Reference","Terrain"],"tags":[]},{"location":"services/api_overview/#authentication","level":2,"title":"Authentication","text":"<p>Authentication to the DE services is currently handled by Keycloak, allowing clients to obtain OAuth or OIDC tokens for accessing secured API endpoints.</p> <p>See the /terrain/token/keycloak endpoint docs for details on obtaining tokens.</p>","path":["API Reference","Terrain"],"tags":[]},{"location":"services/api_overview/#tapis-v2-app-migration-to-v3-for-the-discovery-environment","level":2,"title":"Tapis v2 App migration to v3 for the Discovery Environment","text":"","path":["API Reference","Terrain"],"tags":[]},{"location":"services/bisque/","level":1,"title":"Bisque","text":"<p>The Bio-Image Semantic Query User Environment (BisQue) was originally developed at UC Santa Barbara Center for Bio-Image Informatics. Later, it became ViQi AI</p> <p>CyVerse maintains a fork of the UCSB version of BisQue </p>","path":["System Architecture","Products & Services","Bisque"],"tags":[]},{"location":"services/bisque/#deployment-of-cyverse-bisque","level":2,"title":"Deployment of CyVerse BisQue","text":"<p> UCSB BisQue iRODS</p>","path":["System Architecture","Products & Services","Bisque"],"tags":[]},{"location":"services/cloud/","level":1,"title":"Cloud","text":"<p>CyVerse has a long history working with  OpenStack based clouds, including its deprecated \"Atmosphere\" and \"Jetstream\" User Interfaces.</p> <p>CyVerse is partnered with Jetstream2 to manage cloud-native applications such as Terraform, Argo Workflows, and Kubernetes.  </p> <p>Access to Jetstream2 login is managed through ACCESS-CI.</p> <p>CyVerse CACAO documentation can also be found on Jetstream2 Project docs.</p>","path":["System Architecture","Products & Services","Cloud"],"tags":[]},{"location":"services/cloud/#atmosphere-deprecated","level":2,"title":"Atmosphere (deprecated)","text":"<p>  Atmosphere Ansible</p> <p>  Atmosphere Docker </p> <p> Atmosphere Guides</p> <p>  Atmosphere Apache Guacamole Themes</p>","path":["System Architecture","Products & Services","Cloud"],"tags":[]},{"location":"services/cloud/#cloud-automation-continuous-analysis-orchestration-cacao","level":2,"title":"Cloud Automation &amp; Continuous Analysis Orchestration (CACAO)","text":"<p> CACAO is Infrastructure as Code (IaC) for multi-cloud deployment</p>","path":["System Architecture","Products & Services","Cloud"],"tags":[]},{"location":"services/dc/","level":1,"title":"Dc","text":"<p>DataCommons</p> <p>[Services]</p>","path":["System Architecture","Products & Services","Dc"],"tags":[]},{"location":"services/de/","level":1,"title":"Infrastructure","text":"<p>Discovery Environment User Guide</p> <p>Deployment of the Discovery Environment (DE) is provided in the Deployments section</p> <p></p> <p>Figure DE <code>executable</code> jobs use HTCondor</p> <p></p> <p>Figure DE <code>interactive</code> jobs use K8s</p>","path":["System Architecture","Products & Services","Infrastructure"],"tags":[]},{"location":"services/de/#infrastructure","level":1,"title":"Infrastructure","text":"<p>The following sections describe the key components of the infrastructure upon which the DE operates.</p>","path":["System Architecture","Products & Services","Infrastructure"],"tags":[]},{"location":"services/de/#data-store","level":2,"title":"Data Store","text":"<p>The DE provides access and management of data via the CyVerse  Data Store, which is built on top of  iRODS.</p>","path":["System Architecture","Products & Services","Infrastructure"],"tags":[]},{"location":"services/de/#compute-platforms","level":2,"title":"Compute Platform(s)","text":"<p>The DE integrates the Data Store with HTCondor and the Agave Platform to provide a large set of tools for performing resource intense analyses.</p>","path":["System Architecture","Products & Services","Infrastructure"],"tags":[]},{"location":"services/de/#postgresql","level":2,"title":"PostgreSQL","text":"<p>Nearly all applications use a database. The DE is backed by a  PostgreSQL database. </p> <p>The schema can be found in the de-database repository.</p>","path":["System Architecture","Products & Services","Infrastructure"],"tags":[]},{"location":"services/de/#rabbitmq","level":2,"title":"RabbitMQ","text":"<p>RabbitMQ is used throughout our services, but primarily to integrate our services with iRODS.</p>","path":["System Architecture","Products & Services","Infrastructure"],"tags":[]},{"location":"services/de/#elasticsearch","level":2,"title":"Elasticsearch","text":"<p>The DE uses Elasticsearch to provide search and  other capabilities.</p>","path":["System Architecture","Products & Services","Infrastructure"],"tags":[]},{"location":"services/de/#docker","level":2,"title":"Docker","text":"<p>Docker is used throughout the DE architecture. Most importantly, all of  the tools that run in the DE's HTCondor cluster run within docker containers, allowing us to  integrate new tools without affecting existing tools.</p> <p>Additionally, the components of the DE application are packaged as Docker containers.</p> <p>All of these images can be accessed through our organization page on  Docker Hub.</p>","path":["System Architecture","Products & Services","Infrastructure"],"tags":[]},{"location":"services/de/#architecture","level":1,"title":"Architecture","text":"<p>The DE is composed of backend services and a user interface (UI).</p>","path":["System Architecture","Products & Services","Infrastructure"],"tags":[]},{"location":"services/de/#backend-services","level":2,"title":"Backend Services","text":"<p>The DE backend is built as a micro-services architecture. Each of these services are contained in  the services/ folder.</p> <p>The functionality of the micro-service architecture is aggregated in the <code>Terrain</code> service, and exposed as a RESTful api.</p> <p>More information about the backend micro-service architecture and implementation may be found here.</p>","path":["System Architecture","Products & Services","Infrastructure"],"tags":[]},{"location":"services/de/#ui","level":2,"title":"UI","text":"<p>All of the UI services are provided by the DE api. The application itself is built with GXT, a UI component library built on top of GWT. </p>","path":["System Architecture","Products & Services","Infrastructure"],"tags":[]},{"location":"services/de/#discovery-environment","level":2,"title":"Discovery Environment","text":"<p>Here you will find all the  GitHub repositories for all services: </p> <p> analyses  : Provides a HTTP API for interacting with analyses in the Discovery Environment.</p> <p> app-exposer  : This is a service that runs inside of a Kubernetes cluster namespace and implements CRUD operations for exposing interactive apps as a Service and Endpoint.</p> <p> apply-labels  : A small service in the Discovery Environment backend that periodically hits the app-exposer service to trigger the application of labels on VICE-related K8s resources</p> <p> apps  : apps is a platform for hosting App Services for the Discovery Environment web application.</p> <p> async-tasks  : This service tracks and manages asynchronous tasks throughout the DE backend services.</p> <p> bulk-typer  : Like info-typer, but a bunch at once. hopefully.</p> <p> check-resource-access  : Looks up the permissions that a subject has for a resource. By default, the subject type is 'user' and the resource type is 'analysis'. Only performs look ups against the permissions service.</p> <p> clockwork  : Scheduled jobs for the CyVerse Discovery Environment.</p> <p> dashboard-aggregator  : Gathers data to populate the dashboard in Sonora.</p> <p> data-info  : data-info is a RESTful frontend for getting information about and manipulating information in an iRODS data store.</p> <p> data-usage-api  : A service that provides an API around data usage tracking, and updates data usage numbers on request or periodically.</p> <p>de-mailer  :  A go module that send email notifications to users. This module will support HTML and rich text emails.&lt;/del&gt; <p> de-nginx</p> <p>de-stats  : Service for obtaining CyVerse Discovery Environment stats and metrics.</p> <p> de-webhooks  : A service that listens to AMQP queues for DE notifications, check if the user has webhooks defined for that notification type and then post the notification to webhook if one is defined.</p> <p> dewey  : An AMQP message based iRODS indexer for elasticsearch.</p> <p> email-requests  : A simple service to wait for email requests to arrive over AMQP and forward them to cyverse-email.</p> <p> event-recorder  : This service listens to an AMQP topic for events, and records events that may be of interest to users in the notifications database.</p> <p>get-analysis-id : TODO: FIND the repo.</p> <p>grouper : - <code>grouper-loader</code> &amp; <code>grouper-ws</code> TODO: FIND the repo.   - From kubectl apply</p> <p> info-typer  : An AMQP message based info type detector</p> <p> infosquito2  : TODO FIND description.</p> <p> iplant-groups  : A RESTful facade in front of Grouper.</p> <p> jex-adapter  : TODO FIND description.</p> <p> job-status-recorder  : TODO FIND description.</p> <p> job-status-listener  : Listens over HTTP for job status updates, then publishes them to AMQP.</p> <p> kifshare  : A simple web page that allows users to download publicly available files without a CyVerse account.</p> <p>local-exim (exim-sender): TODO: FIND the repo. - From kubectl</p> <p> metadata  : The REST API for the Discovery Environment Metadata services.</p> <p> monkey  : This is a service that synchronizes the tag documents in the data search index with the metadata database</p> <p> notifications  : This service provides the RESTful API for the revised notification system.</p> <p> permissions  : This service manages permissions for the Discovery environment.</p> <p> requests  : Service for managing administrative requests in the CyVerse Discovery Environment.</p> <p> terrain  : Terrain provides the primary REST API used by the Discovery Environment. Its role is to validate user authentication and to coordinate calls to other web services. For more information, please see the Discovery Environment API Documentation .</p> <p> resource-usage-api  :  is a microservice developed as part of the CyVerse Discovery Environment that provides access to resource usage values (CPU hours, memory, etc.) consumed by users over a customizable time period.</p> <p>saved-searches  : A service for the CyVerse Discovery Environment that provides CRUD access to a user's saved searches.</p> <p> search  : This is a service which serves as a search facade for the DE and others to use. It uses the querydsl  library under the covers to translate requests and provide documentation, then passes off queries to configured elasticsearch servers.</p> <p> sonora  : UI for the Discovery Environment</p> <p> templeton  : includes <code>templeton-incremental</code> &amp; <code>templeton-periodic</code> TODO: add description.</p> <p> timelord  : timelord periodically queries the DE database for running applications and kills any of them that have gone over their time limit.</p> <p>unleash : TODO: FIND the repo. - From kubectl apply</p> <p> user-info  : A service for getting user-related information like sessions and preferences.</p> <p> vice-default-backend  : Provides a default backend handler for the Kubernetes Ingress that handles routing for VICE apps. This backend decides whether to redirect requests to the loading page service, the landing page service, or to a 404 page depending on whether the URL is valid or not.</p> <p> qms-adapter  : Forwards usage information gathered within the Discovery Environment to the Quota Management System [QMS](https://github.com/cyverse/QMS</p> <p> qms  : QMS is the CyVerse Quota Management System. Its purpose is to keep track of resource usage limits and totals for CyVerse users.</p> <p>irods-csi-driver  : iRODS Container Storage Interface (CSI) Driver implements the CSI Specification  to provide container orchestration engines (like Kubernetes) iRODS access.</p> <p>dataone-indexer  : Event indexer for the DataONE member node service.","path":["System Architecture","Products & Services","Infrastructure"],"tags":[]},{"location":"services/dnasubway/","level":1,"title":"Dnasubway","text":"<p>DNA Subway</p>","path":["System Architecture","Products & Services","Dnasubway"],"tags":[]},{"location":"services/ds/","level":1,"title":"Ds","text":"<p>Data Storage in CyVerse is managed both internally and through federation.</p> What is Federation? <p>Data federation allows institutions to manage their own hardware, or buy space on commercial cloud, and integrate it with our Data Store.</p> <p>Data that are federated do not appear any differently than data that are hosted in the primary CyVerse Data Store.</p> <p>This is not federation in the iRODS sense, where the the federated storage is managed in a separate zone. The storage managed by the institution is in the same zone, <code>iplant</code>, as the CyVerse managed storage.</p> <p></p> <p>Figure: Access to the Data Store can be accomplished over  HTTPS (<code>https://</code>), SFTP (<code>sftp://</code>) or iRODS Protocol</p>","path":["System Architecture","Products & Services","Ds"],"tags":[]},{"location":"services/ds/#irods","level":2,"title":"iRODS","text":"<p>CyVerse uses iRODS (integrated Rule Oriented Data System) to manage its users data and uses PostgreSQL to manage the catalog (ICAT) database for iRODS.</p> <ul> <li> iRODS Documentation</li> <li> PostgreSQL Documentation</li> </ul>","path":["System Architecture","Products & Services","Ds"],"tags":[]},{"location":"services/ds/#sftp","level":2,"title":"SFTP","text":"<p>CyVerse uses SFTPGo along with a custom iRODS storage backend to provide SFTP access to data in the Data Store.</p> <ul> <li> SFTPGo Documentation</li> <li> SFTGO with iRODS Storage Backend Documentation</li> </ul>","path":["System Architecture","Products & Services","Ds"],"tags":[]},{"location":"services/ds/#webdav","level":2,"title":"WebDAV","text":"<p>CyVerse uses apache along with the davrods module to manage the WebDAV service for accessing the Data Store over the HTTPS and WebDAVS protocols. Varnish HTTP Cache is used internally for caching requested files.</p> <ul> <li> Apache Documentation</li> <li> Davrods Documentation</li> <li> Varnish HTTP Cache Documentation</li> </ul>","path":["System Architecture","Products & Services","Ds"],"tags":[]},{"location":"services/ds/#haproxy","level":2,"title":"HAProxy","text":"<p>CyVerse uses HAProxy to provide a common point of entry, data.cyverse.org, for clients to access all of the Data Store services.</p> <ul> <li> HAProxy Documentation</li> </ul>","path":["System Architecture","Products & Services","Ds"],"tags":[]},{"location":"services/ds/#amqp","level":2,"title":"AMQP","text":"<p>CyVerse uses RabbitMQ to provide an AMQP-based message bus for notifying other CyVerse services like DataWatch about data related events.</p> <ul> <li> RabbitMQ Documentation</li> </ul>","path":["System Architecture","Products & Services","Ds"],"tags":[]},{"location":"services/getting_started/","level":1,"title":"Getting Started with CyVerse Deployment","text":"<p>This guide will help you get started with deploying and managing CyVerse infrastructure. Choose the path that matches your role and objectives.</p>","path":["Getting Started","Getting Started with CyVerse Deployment"],"tags":[]},{"location":"services/getting_started/#prerequisites","level":2,"title":"Prerequisites","text":"<p>Infrastructure Requirements</p> <p>Hardware/Cloud:</p> <ul> <li>Access to bare metal hardware,  OpenStack cloud, or commercial provider (:simple-amazonaws: AWS,  Google Cloud, :simple-azuredevops: Microsoft Azure)</li> <li>Minimum recommended: 8-node Kubernetes cluster with 32 CPU cores and 128GB RAM per node</li> <li>Persistent storage capability (NFS, iRODS, or cloud block storage)</li> <li>Public IP addresses and DNS management</li> </ul> <p>Skills &amp; Knowledge:</p> <ul> <li>Advanced understanding of  Linux system administration and file permissions</li> <li>Experience with  Kubernetes (K8s) cluster management</li> <li>Familiarity with  Docker containerization</li> <li>Understanding of Infrastructure as Code (IaC) principles</li> <li>Experience with  Ansible for configuration management</li> <li>Networking knowledge (DNS, load balancing, ingress controllers)</li> </ul> <p>Tools &amp; Access:</p> <ul> <li> GitHub or  GitLab with private repositories for sensitive credentials</li> <li><code>kubectl</code>, <code>helm</code>, and other Kubernetes CLI tools</li> <li>Access via <code>ssh</code> to infrastructure nodes</li> <li>Web-enabled browser for administrative interfaces</li> </ul> <p>Personal Qualities:</p> <ul> <li>Patience &amp; Perseverance - complex distributed systems require methodical troubleshooting</li> </ul>","path":["Getting Started","Getting Started with CyVerse Deployment"],"tags":[]},{"location":"services/getting_started/#deployment-roadmap","level":2,"title":"Deployment Roadmap","text":"<p>Deploying CyVerse follows a structured sequence. Each component builds upon the previous layers:</p> <pre><code>graph TD\n    A[1. Kubernetes Cluster] --&gt; B[2. Core Infrastructure]\n    B --&gt; C[3. Core Services]\n    C --&gt; D[4. Application Services]\n    D --&gt; E[5. Databases]\n    E --&gt; F[6. Discovery Environment]\n\n    B --&gt; B1[Storage: OpenEBS]\n    B --&gt; B2[Networking: Ingress NGINX]\n    B --&gt; B3[iRODS CSI Driver]\n\n    C --&gt; C1[KeyCloak: Authentication]\n    C --&gt; C2[RabbitMQ: Message Queue]\n    C --&gt; C3[Redis: Cache]\n    C --&gt; C4[ElasticSearch: Search]\n\n    D --&gt; D1[User Portal]\n    D --&gt; D2[VICE]\n    D --&gt; D3[Exim4: Mail]\n\n    E --&gt; E1[PostgreSQL Databases]\n    E --&gt; E2[Grouper]\n    E --&gt; E3[Unleash]</code></pre>","path":["Getting Started","Getting Started with CyVerse Deployment"],"tags":[]},{"location":"services/getting_started/#component-dependencies","level":3,"title":"Component Dependencies","text":"Component Depends On Purpose Kubernetes Cluster Hardware/Cloud Container orchestration foundation OpenEBS Kubernetes Persistent volume management Ingress NGINX Kubernetes External traffic routing KeyCloak Kubernetes, PostgreSQL User authentication and authorization RabbitMQ Kubernetes Message passing between services Redis HA Kubernetes Caching and session management ElasticSearch Kubernetes Full-text search capabilities Discovery Environment All core services Main user-facing application VICE DE, Kubernetes Interactive computing environments","path":["Getting Started","Getting Started with CyVerse Deployment"],"tags":[]},{"location":"services/getting_started/#deployment-phases","level":3,"title":"Deployment Phases","text":"<p>Phase 1: Foundation (Weeks 1-2) - Set up Kubernetes cluster - Deploy storage (OpenEBS) and networking (Ingress NGINX) - Configure iRODS CSI driver for data storage - Verify cluster health and resource allocation</p> <p>Phase 2: Core Services (Week 3) - Deploy and configure KeyCloak for authentication - Set up RabbitMQ message broker - Deploy Redis HA for caching - Configure ElasticSearch for search functionality - Deploy monitoring (Jaeger)</p> <p>Phase 3: Databases (Week 4) - Provision PostgreSQL databases for all services - Initialize database schemas - Configure backup and recovery procedures - Set up Grouper for group management - Deploy Unleash for feature flags</p> <p>Phase 4: Applications (Weeks 5-6) - Deploy User Portal - Configure Discovery Environment services - Set up VICE for interactive applications - Deploy mail services (Exim4) - Configure external integrations</p> <p>Phase 5: Verification &amp; Tuning (Week 7) - End-to-end testing - Performance optimization - Security hardening - Documentation of deployment specifics</p>","path":["Getting Started","Getting Started with CyVerse Deployment"],"tags":[]},{"location":"services/getting_started/#quick-start-by-role","level":2,"title":"Quick Start by Role","text":"","path":["Getting Started","Getting Started with CyVerse Deployment"],"tags":[]},{"location":"services/getting_started/#for-devops-engineers","level":3,"title":"For DevOps Engineers","text":"<p>Goal: Deploy CyVerse infrastructure from scratch</p>","path":["Getting Started","Getting Started with CyVerse Deployment"],"tags":[]},{"location":"services/getting_started/#1-prepare-your-environment","level":4,"title":"1. Prepare Your Environment","text":"<p>Start with the setup guides to configure your deployment tools:</p> <ul> <li>Ansible Setup - Configure Ansible for infrastructure automation</li> <li>Docker Setup - Set up Docker and container registry access</li> <li>Database Setup - Prepare PostgreSQL deployment tools</li> </ul>","path":["Getting Started","Getting Started with CyVerse Deployment"],"tags":[]},{"location":"services/getting_started/#2-deploy-core-infrastructure","level":4,"title":"2. Deploy Core Infrastructure","text":"<p>Follow the deployment sequence:</p> <ol> <li>Kubernetes Cluster - Deploy and configure your K8s cluster</li> <li>Kubernetes Resources - Set up namespaces, resource quotas, and RBAC</li> <li>Storage (OpenEBS) - Deploy persistent volume management</li> <li>iRODS CSI Driver - Connect to iRODS data storage</li> <li>Networking - Configure ingress for external access</li> </ol>","path":["Getting Started","Getting Started with CyVerse Deployment"],"tags":[]},{"location":"services/getting_started/#3-deploy-services","level":4,"title":"3. Deploy Services","text":"<p>With infrastructure in place, deploy the service layer:</p> <ol> <li>KeyCloak - Authentication and identity management</li> <li>RabbitMQ - Message broker for service communication</li> <li>Redis HA - High-availability caching</li> <li>ElasticSearch - Search engine</li> <li>Databases - PostgreSQL for all services</li> </ol>","path":["Getting Started","Getting Started with CyVerse Deployment"],"tags":[]},{"location":"services/getting_started/#4-deploy-applications","level":4,"title":"4. Deploy Applications","text":"<p>Finally, deploy the user-facing applications:</p> <ol> <li>Discovery Environment - Main DE platform</li> <li>User Portal - User account management interface</li> <li>VICE - Interactive computing</li> </ol>","path":["Getting Started","Getting Started with CyVerse Deployment"],"tags":[]},{"location":"services/getting_started/#5-verify-deployment","level":4,"title":"5. Verify Deployment","text":"<ul> <li>Check all pods are running: <code>kubectl get pods --all-namespaces</code></li> <li>Verify services are accessible through ingress</li> <li>Test authentication flow through KeyCloak</li> <li>Review logs for errors: <code>kubectl logs -n &lt;namespace&gt; &lt;pod-name&gt;</code></li> </ul> <p>Next Steps: - Review DevOps operational procedures - Set up monitoring and alerting - Configure backup procedures for databases - Plan disaster recovery procedures</p>","path":["Getting Started","Getting Started with CyVerse Deployment"],"tags":[]},{"location":"services/getting_started/#for-system-administrators","level":3,"title":"For System Administrators","text":"<p>Goal: Manage users, apps, and daily operations</p>","path":["Getting Started","Getting Started with CyVerse Deployment"],"tags":[]},{"location":"services/getting_started/#1-understand-the-platform","level":4,"title":"1. Understand the Platform","text":"<p>Before managing CyVerse, familiarize yourself with the architecture:</p> <ul> <li>System Overview - How CyVerse components work together</li> <li>Discovery Environment - The main user-facing platform</li> <li>Data Store - iRODS-based data management</li> </ul>","path":["Getting Started","Getting Started with CyVerse Deployment"],"tags":[]},{"location":"services/getting_started/#2-learn-administrative-tools","level":4,"title":"2. Learn Administrative Tools","text":"<p>Review the admin guides for operational procedures:</p> <ul> <li>DE Administration - User management, app publishing, VICE access grants</li> <li>Data Store Administration - Data permissions, storage management</li> <li>User Portal Administration - Account management</li> </ul>","path":["Getting Started","Getting Started with CyVerse Deployment"],"tags":[]},{"location":"services/getting_started/#3-common-administrative-tasks","level":4,"title":"3. Common Administrative Tasks","text":"<p>User Management: - Grant VICE access to qualified users - Manage user quotas and resource limits - Process user support requests</p> <p>App Publishing: - Review and approve tool integration requests - Publish containerized apps to the Discovery Environment - Test and validate app functionality</p> <p>Data Management: - Process Permanent ID/DOI requests for data publishing - Manage data sharing permissions - Monitor storage usage and quotas</p>","path":["Getting Started","Getting Started with CyVerse Deployment"],"tags":[]},{"location":"services/getting_started/#4-resources","level":4,"title":"4. Resources","text":"<ul> <li>FAQ - Common questions and troubleshooting</li> <li>Permanent ID Requests - DOI workflow documentation</li> <li>Terrain API - Understanding the backend API</li> </ul> <p>Next Steps: - Bookmark frequently used admin interfaces - Join CyVerse staff communication channels - Review common user support scenarios - Familiarize yourself with escalation procedures</p>","path":["Getting Started","Getting Started with CyVerse Deployment"],"tags":[]},{"location":"services/getting_started/#for-application-developers","level":3,"title":"For Application Developers","text":"<p>Goal: Integrate with CyVerse APIs or contribute to the platform</p>","path":["Getting Started","Getting Started with CyVerse Deployment"],"tags":[]},{"location":"services/getting_started/#1-understand-the-api-architecture","level":4,"title":"1. Understand the API Architecture","text":"<p>Start with API fundamentals:</p> <ul> <li>API Overview - Introduction to Terrain API</li> <li>API Endpoint Index - Complete endpoint reference</li> <li>Developer Guide - Development environment setup</li> </ul>","path":["Getting Started","Getting Started with CyVerse Deployment"],"tags":[]},{"location":"services/getting_started/#2-authentication-access","level":4,"title":"2. Authentication &amp; Access","text":"<p>Learn how to authenticate with CyVerse services:</p> <ul> <li>Authentication (KeyCloak) - OAUTH 2.0 flow and token management</li> <li>Error Handling - API error codes and responses</li> </ul>","path":["Getting Started","Getting Started with CyVerse Deployment"],"tags":[]},{"location":"services/getting_started/#3-common-integration-patterns","level":4,"title":"3. Common Integration Patterns","text":"<p>Data Operations: - Filesystem API - Browse and manage data in the Data Store - File I/O - Upload and download files - Metadata - Attach metadata to data objects</p> <p>Compute Operations: - App Metadata - Query available analysis tools - Job Submission - Launch computational analyses - Callbacks - Receive job status updates</p> <p>User Interactions: - Notifications - Send messages to users - Comments - Enable collaborative annotations - Favorites - Manage user bookmarks</p>","path":["Getting Started","Getting Started with CyVerse Deployment"],"tags":[]},{"location":"services/getting_started/#4-contributing-to-cyverse","level":4,"title":"4. Contributing to CyVerse","text":"<p>If you're contributing code to CyVerse:</p> <ul> <li>Review the Developer Guide for contribution workflow</li> <li>Browse the CyVerse-DE GitHub organization</li> <li>Test against the live Terrain API</li> </ul> <p>Migration Guides: - Tapis v2 to v3 Migration - Upgrade from legacy Tapis APIs</p> <p>Next Steps: - Set up a CyVerse development account - Review API rate limits and usage policies - Explore example integrations in GitHub - Join developer community channels</p>","path":["Getting Started","Getting Started with CyVerse Deployment"],"tags":[]},{"location":"services/getting_started/#installation-tools","level":2,"title":"Installation Tools","text":"<p>The DevOps Guide provides a complete list of required software for managing a CyVerse deployment, including:</p> <ul> <li>Kubernetes CLI tools (<code>kubectl</code>, <code>helm</code>)</li> <li>Ansible for configuration management</li> <li>Docker for container operations</li> <li>Database administration tools</li> <li>Monitoring and logging tools</li> </ul>","path":["Getting Started","Getting Started with CyVerse Deployment"],"tags":[]},{"location":"services/getting_started/#technology-stack-overview","level":2,"title":"Technology Stack Overview","text":"","path":["Getting Started","Getting Started with CyVerse Deployment"],"tags":[]},{"location":"services/getting_started/#authentication","level":3,"title":"Authentication","text":"<p>CyVerse authentication relies upon: - LDAP - Directory services for user accounts - OAUTH 2.0 protocol - Modern authentication standard - CILogon - Federated identity for research institutions</p> <p>See KeyCloak for authentication deployment details.</p>","path":["Getting Started","Getting Started with CyVerse Deployment"],"tags":[]},{"location":"services/getting_started/#security-considerations","level":3,"title":"Security Considerations","text":"<p>Experience operating in a Science DMZ network architecture is beneficial for deploying CyVerse on university infrastructure. Key security topics include:</p> <ul> <li>Firewall rules for high-performance data transfer</li> <li>Network segmentation between public and private services</li> <li>TLS certificate management for secure communications</li> <li>Secrets management for API keys and credentials</li> </ul>","path":["Getting Started","Getting Started with CyVerse Deployment"],"tags":[]},{"location":"services/getting_started/#core-apis","level":3,"title":"Core APIs","text":"<p> Terrain API is the backbone service aggregating all Discovery Environment functionality. It provides a unified RESTful interface for:</p> <ul> <li>Data management (Data Store operations)</li> <li>App execution (job submission and monitoring)</li> <li>User services (preferences, notifications, favorites)</li> <li>Administrative functions (user management, resource allocation)</li> </ul> <p>Detailed endpoint documentation is available in the API endpoints section.</p>","path":["Getting Started","Getting Started with CyVerse Deployment"],"tags":[]},{"location":"services/getting_started/#platform-components","level":3,"title":"Platform Components","text":"<p>User-Facing Products:</p> <ul> <li>Discovery Environment - Web-based data science workbench with 1000+ pre-integrated tools</li> <li>Data Store - 6+ PB iRODS-based storage with data management, hosting, and sharing</li> <li>Data Commons - Community data repository with DataCite DOI publishing</li> <li>VICE - Visual Interactive Computing (Jupyter, RStudio, Shiny apps)</li> <li>BisQue - Browser-based large image analysis platform</li> <li>DNA Subway - Educational genomics software for students</li> </ul> <p>Backend Services:</p> <ul> <li>Core Services - Microservices architecture overview</li> <li>Authentication (KeyCloak) - Identity and access management</li> <li>Cloud Services (CACAO) - Multi-cloud automation and orchestration</li> </ul>","path":["Getting Started","Getting Started with CyVerse Deployment"],"tags":[]},{"location":"services/getting_started/#deployment-platform","level":3,"title":"Deployment Platform","text":"<p>All CyVerse services are deployed on Kubernetes (K8s) using:</p> <ul> <li>Helm charts for package management</li> <li>Ansible playbooks for configuration</li> <li>GitOps practices for infrastructure as code</li> <li>Namespace isolation for service boundaries</li> </ul> <p>See the complete Deployments overview for details.</p>","path":["Getting Started","Getting Started with CyVerse Deployment"],"tags":[]},{"location":"services/getting_started/#database-infrastructure","level":3,"title":"Database Infrastructure","text":"<p>CyVerse uses  PostgreSQL as its primary database platform. Each service maintains its own database for isolation and independent scaling:</p> <ul> <li>DE Database - Discovery Environment core data</li> <li>Metadata Database - User-defined metadata</li> <li>Notifications Database - User notification system</li> <li>KeyCloak Database - Authentication data</li> <li>And more...</li> </ul>","path":["Getting Started","Getting Started with CyVerse Deployment"],"tags":[]},{"location":"services/getting_started/#next-steps","level":2,"title":"Next Steps","text":"<p>After completing your getting started tasks:</p> <ol> <li>Verify Deployment - Test core functionality end-to-end</li> <li>Review Troubleshooting Resources - Familiarize yourself with common issues in the FAQ</li> <li>Set Up Monitoring - Implement logging and alerting for production operations</li> <li>Join the Community - Connect with other CyVerse operators and developers via GitHub</li> <li>Plan for Scale - Review performance tuning and capacity planning for your workload</li> </ol> <p>Need Help?</p> <ul> <li>Check the FAQ for common questions</li> <li>Review deployment-specific documentation in the Deployment Guide</li> <li>Explore the API Reference for integration details</li> <li>Consult the Developer Guide for contribution workflow</li> </ul>","path":["Getting Started","Getting Started with CyVerse Deployment"],"tags":[]},{"location":"services/keycloak/","level":1,"title":"Keycloak","text":"<p>CyVerse Authentication via Keycloak, CILogon, &amp; OAUTH </p> <pre><code>sequenceDiagram\n  autonumber\n  User-&gt;&gt;Browser: Click on external Auth\n  Browser--&gt;&gt;Keycloak: Authentication request (TOKEN)\n  loop\n      Keycloak--&gt;&gt;Browser: Browser opened with ../auth?=client_id=de-prod=TOKEN\n  end\n  Keycloak--&gt;&gt;CILogon: Auth Request\n  User-&gt;&gt;CILogon: Enter Credentials\n  Keycloak--&gt;&gt;OAUTH: Auth Response\n  CILogon--&gt;&gt;Keycloak: Auth Response\n  Browser--&gt;&gt;OAUTH: Ask for Token\n  OAUTH--&gt;&gt;Browser: Retrieve Token</code></pre> <p>Mermaid Diagram Users authenticate (starting on left side) via their browser, which passes through Keycloack to either CILogon or OAUTH.</p> <p> Keycloak service manages authenticaation via CILogon and OAUTH.</p>","path":["System Architecture","Products & Services","Keycloak"],"tags":[]},{"location":"services/keycloak/#keycloak","level":2,"title":"Keycloak","text":"<p>Keycloak is provisioned and deployed as part of the main K8s </p> <p> Keycloak provisioning with K8s</p>","path":["System Architecture","Products & Services","Keycloak"],"tags":[]},{"location":"services/services_overview/","level":1,"title":"Products &amp; Services Overview","text":"<p>CyVerse provides multiple end-user services.</p> <p> </p> The top of the CyVerse layer cake includes its Products &amp; Services <p>Primarily the Products and Services layers are served directly over <code>https://</code> websites which then link to the CyVerse Terrain API, K8s clusters, Data Store, and Authentication layers.</p> <p>API (Terrain)</p> <p>Authentication</p> <p>BisQue</p> <p>Cloud Services</p> <p>Data Publishing</p> <p>Data Storage</p> <p>Discovery Environment</p> <p>DNA Subway</p>","path":["System Architecture","Products &amp; Services Overview"],"tags":[]},{"location":"services/subscriptions/","level":1,"title":"Subscriptions","text":"<p>CyVerse subscriptions provide enhanced resource allocations for computational analysis and data storage.</p>","path":["Getting Started","Subscriptions"],"tags":[]},{"location":"services/subscriptions/#subscription-enrollment","level":2,"title":"Subscription Enrollment","text":"<p>Subscribe or manage your subscription at subscribe.cyverse.org</p>","path":["Getting Started","Subscriptions"],"tags":[]},{"location":"services/subscriptions/#what-subscriptions-provide","level":3,"title":"What Subscriptions Provide","text":"<ul> <li>Increased compute hours for analysis jobs</li> <li>Additional storage allocations in the Data Store</li> <li>Priority access to computational resources</li> <li>Extended resource limits for VICE applications</li> <li>Dedicated support for subscription holders</li> </ul>","path":["Getting Started","Subscriptions"],"tags":[]},{"location":"services/subscriptions/#subscription-management","level":2,"title":"Subscription Management","text":"<p>External Management: - Credit card billing and invoices are managed through the subscription portal at subscribe.cyverse.org - Users can subscribe, update payment information, and manage billing preferences</p> <p>Internal Management: - CyVerse administrators manage user account status and allocation settings through the Discovery Environment Administrator Panel - Resource monitoring includes compute hours and storage utilization - Quota adjustments and resource allocation changes are applied based on subscription tier</p>","path":["Getting Started","Subscriptions"],"tags":[]},{"location":"services/subscriptions/#for-administrators","level":2,"title":"For Administrators","text":"<p>Subscription status and resource allocations are managed through administrative interfaces:</p> <ul> <li>User subscription verification</li> <li>Resource quota assignment based on subscription tier</li> <li>Usage monitoring and reporting</li> <li>Subscription renewal notifications</li> </ul>","path":["Getting Started","Subscriptions"],"tags":[]},{"location":"services/system_overview/","level":1,"title":"System overview","text":"<p>CyVerse is both a Software as a Service (SaaS) and the Infrastructure as Code (IaC) necessary to manage a full stack cyberinfrastructure.</p> <p>The US public CyVerse primarily runs on hardware located at The University of Arizona, with a full data store mirror at the Texas Advanced Computing Center (TACC), and federated compute resources located across the US.</p> <p>The full CyVerse SaaS stack can be deployed either on-premises consumer hardware or on cloud resources.</p> <p>Data storage is managed by an iRODS  Data Store.</p> <p>Computing can be done in either the  Discovery Environment (DE) data science workbench or with the  CACAO IaC which leverages both public research computing and commercial cloud.</p> <p>Event-based triggers are accomplished through the DataWatch API.</p> <p> </p> CyVerse's Infrastructure as Code (IaC) provides computing, storage, and event-based components researchers rely upon for data intensive science.","path":["Getting Started","System overview"],"tags":[]},{"location":"services/system_overview/#application-programming-interfaces-apis","level":2,"title":"Application Programming Interfaces (APIs)","text":"<p>All CyVerse APIs are  OpenAPI compliant.</p> <p> Terrain API is the main API for Discovery Environment and uses a  Swagger interface.</p> <ul> <li> Terrain API Jupyter Notebooks - provide an introduction to Terrain and show how to start and stop analyses.</li> <li> https://de.cyverse.org/terrain/swagger.json</li> </ul> <p> CACAO API - Infrastructure as Code API for cloud automation with OpenAPI</p> <p>Data Watch API - event based triggers for workflows with OpenAPI</p> <p>CyVerse public-facing APIs are frequently leveraged by \"Powered-by-CyVerse\" projects which utilize specific parts of the platform.</p>","path":["Getting Started","System overview"],"tags":[]},{"location":"services/system_overview/#cloud-services","level":2,"title":"Cloud Services","text":"<p> Continous Automation / Continuous Analysis &amp; Orchestration (CACAO) - Infrastructure as Code for multi-cloud deployments</p> <ul> <li> CACAO Terraform Templates</li> <li> DataWatch - a notification system for reporting data events</li> </ul>","path":["Getting Started","System overview"],"tags":[]},{"location":"services/system_overview/#compute-resources","level":2,"title":"Compute Resources","text":"<p>The DE runs on-premises hardware located at University of Arizona (UArizona) in the UITS colocation space at the high performance computing center. The data store is mirrored nightly at TACC.</p> <p>CyVerse staff maintain over XXX servers at UArizona and 1 server at TACC.</p> <p>Hardware is added, replaced, or upgraded every few months. Table values below may not be up-to-date.</p> <p>Primary Hardware Specifications</p> <p>Compute Nodes (XXX nodes)</p> System Configuration Aggregate information Per Node (Compute Node) Machine types Dell, SuperMicro, XXX Operating Systems Centos, Rocky Centos, Rocky Processor cores XX,XXX average XX CPUs 128, 64, 40, 32, 16 1, 2 RAM XXX TiB 256, 128, 64, 32 GiB Network 100 Gbps to Internet2 10 Gpbs to switch Storage X PB X TB <p>GPU Nodes (XXX nodes)</p> System Configuration Aggregate information Per Node (Compute Node) Machine types Dell, SuperMicro, XXX Operating Systems Centos, Rocky Centos, Rocky Processor cores 256 CPUs 2 RAM 1 TB, 512 GB GPUs NVIDIA (A100 80GB), (Tesla T4 16GB) 4 Network 100 Gbps to Internet2 10 Gpbs to switch Storage XXX TB 28 TB SSD, 21 TB NVMe <p>Storage Resource Nodes (44 nodes)</p> System Configuration Aggregate information Per Node (Compute Node) Machine types Dell, SuperMicro, XXX Operating Systems Centos, Ubuntu Centos, Ubuntu Processor cores 1506 average XX CPUs 128, 64, 40, 32, 16 1, 2 RAM 11 TiB 256, 128, 64, 32 GiB Network 100 Gbps to Internet2 10 Gpbs to switch Storage 18 PB X TB","path":["Getting Started","System overview"],"tags":[]},{"location":"services/system_overview/#federated-kubernetes-clusters","level":3,"title":"Federated Kubernetes Clusters","text":"<ul> <li>CyVerse runs mainly on a locally managed K8s cluster, but it can be federated to other K8s clusters.</li> <li>The National Research Platform offers federated K8s resources. These resources are currently in development.</li> </ul>","path":["Getting Started","System overview"],"tags":[]},{"location":"services/system_overview/#openstack-cloud","level":3,"title":"OpenStack Cloud","text":"<ul> <li>CyVerse maintains its own OpenStack Cloud (formerly \"Atmosphere\") for internal use and development of CACAO.</li> <li>Jetstream2 is primarily operated at Indiana University, but test clusters are shared across other universities in the US</li> </ul>","path":["Getting Started","System overview"],"tags":[]},{"location":"services/system_overview/#high-throughput-computing-environments","level":3,"title":"High Throughput Computing Environments:","text":"<p>DE uses HTCondor for <code>executable</code> jobs on CyVerse resources and <code>osg</code> jobs on the OpenScienceGrid</p> <p></p> <p>Federation to the OpenScienceGrid can be accomplished in the DE</p>","path":["Getting Started","System overview"],"tags":[]},{"location":"services/system_overview/#high-performance-computing-environments","level":3,"title":"High Performance Computing Environments","text":"<p>University of Arizona resources are colocated with the CyVerse data store and compute clusters</p> <p>CyVerse is partnered with Texas Advanced Computing Center (TACC) where its data store is replicated nightly. US based researchers can request access to HPC via:</p> <ul> <li>ACCESS-CI</li> <li>TACC Allocation request</li> </ul>","path":["Getting Started","System overview"],"tags":[]},{"location":"services/system_overview/#data-storage","level":2,"title":"Data Storage","text":"<p>The CyVerse Data Store manages over 6 PB data via iRODS (integrated Rule Oriented Data System) within the <code>iplant</code> zone. The zone name is related to the original project name. It is retained to preserve access to data through URLs published during the time period of the original project.</p> <p>Data storage is organized into resources. The main resource is named <code>CyVerseRes</code>, and it holds all user data and most project data. Data on <code>CyVerseRes</code> are stored ath the University of Arizona. This resource is mirrored with a second resource named <code>taccRes</code> which is backed by storage located at the Texas Advanced Computing Center (TACC). There are also special purpose resources dedicated to certain projects. The data in these resources are stored on hardware owned by these projects.</p> <p></p>","path":["Getting Started","System overview"],"tags":[]},{"location":"services/system_overview/#interfaces","level":2,"title":"Interfaces","text":"<p> User Portal - a User Portal for creating and managing accounts, requesting and granting access to platforms, and a user management space for individuals and groups and workshops.</p> <p> Discovery Environment  - Custom interactive web based data science workbench</p> <p> KeyCloak - federated OAUTH to CyVerse resources, including Google, GitHub, ORCID,&amp; CILogon</p> <p> WebDAV - A service that provides secure HTTP/WebDAV access to the Data Store. It provides anonymous access to public data and authenticated access to private and shared data.</p> <p> SFTP - A service that provides secure FTP access to the Data Store. The service can be accessed through sftp://data.cyverse.org.</p> <p> Data Commons - This service provides secure HTTP access to published datasets that are hosted in the CyVerse Data Store. The Data Commons presents any metadata which have been added by the owners to their datasets.</p>","path":["Getting Started","System overview"],"tags":[]},{"location":"services/system_overview/#monitoring-services","level":2,"title":"Monitoring Services","text":"<p> Health Status - system status monitor</p> <p> perfSONAR web toolkit - network measurement toolkit</p>","path":["Getting Started","System overview"],"tags":[]},{"location":"services/api/endpoint-index/","level":1,"title":"Endpoint index","text":"<p>Jump to:</p> <p><code>/admin</code></p> <p><code>/apps</code></p> <p><code>/coge</code></p> <p><code>/favorites</code></p> <p><code>/filesystem</code></p> <p><code>/permanent-id-requests</code></p> <p><code>/secured</code></p> <p><code>/send-notification</code></p> <p><code>/uuid</code></p>","path":["API Reference","Endpoint index"],"tags":[]},{"location":"services/api/endpoint-index/#get","level":2,"title":"get","text":"<p><code>GET /</code></p>","path":["API Reference","Endpoint index"],"tags":[]},{"location":"services/api/endpoint-index/#admin","level":2,"title":"admin","text":"<p><code>GET /admin/apps/categories</code> </p> <p><code>GET /admin/apps/categories/search</code> </p> <p><code>POST /admin/apps/categories/{system-id}</code> </p> <p><code>DELETE /admin/apps/categories/{system-id}/{category-id}</code> </p> <p><code>PATCH /admin/apps/categories/{system-id}/{category-id}</code> </p> <p><code>DELETE /admin/apps/{app-id}/comments/{comment-id}</code> </p> <p><code>PATCH /admin/apps/{app-id}/comments/{comment-id}</code> </p> <p><code>GET /admin/apps/{app-id}/metadata</code> </p> <p><code>POST /admin/apps/{app-id}/metadata</code> </p> <p><code>PUT /admin/apps/{app-id}/metadata</code> </p> <p><code>DELETE /admin/filesystem/entry/{entry-id}/comments/{comment-id}</code> </p> <p><code>PATCH /admin/filesystem/entry/{entry-id}/comments/{comment-id}</code> </p> <p><code>GET /admin/filesystem/metadata/templates</code> </p> <p><code>POST /admin/filesystem/metadata/templates</code> </p> <p><code>DELETE /admin/filesystem/metadata/templates/{template-id}</code> </p> <p><code>POST /admin/filesystem/metadata/templates/{template-id}</code> </p> <p><code>GET /admin/notifications/system</code> </p> <p><code>PUT /admin/notifications/system</code> </p> <p><code>GET /admin/notifications/system-types</code> </p> <p><code>DELETE /admin/notifications/system/:uuid</code> </p> <p><code>GET /admin/notifications/system/:uuid</code> </p> <p><code>POST /admin/notifications/system/:uuid</code> </p> <p><code>GET /admin/ontologies</code> </p> <p><code>POST /admin/ontologies</code> </p> <p><code>DELETE /admin/ontologies/{ontology-version}</code> </p> <p><code>GET /admin/ontologies/{ontology-version}</code> </p> <p><code>POST /admin/ontologies/{ontology-version}</code> </p> <p><code>DELETE /admin/ontologies/{ontology-version}/{root-iri}</code> </p> <p><code>GET /admin/ontologies/{ontology-version}/{root-iri}</code> </p> <p><code>PUT /admin/ontologies/{ontology-version}/{root-iri}</code> </p> <p><code>GET /admin/ontologies/{ontology-version}/{root-iri}/apps</code> </p> <p><code>GET /admin/ontologies/{ontology-version}/{root-iri}/unclassified</code> </p> <p><code>GET /admin/permanent-id-requests</code> </p> <p><code>GET /admin/permanent-id-requests/{request-id}</code> </p> <p><code>POST /admin/permanent-id-requests/{request-id}/ezid</code> </p> <p><code>POST /admin/permanent-id-requests/{request-id}/status</code> </p> <p><code>DELETE /admin/workspaces</code> </p> <p><code>GET /admin/workspaces</code> </p>","path":["API Reference","Endpoint index"],"tags":[]},{"location":"services/api/endpoint-index/#apps","level":2,"title":"apps","text":"<p><code>GET /apps/{app-id}/comments</code> </p> <p><code>POST /apps/{app-id}/comments</code> </p> <p><code>PATCH /apps/{app-id}/comments/{comment-id}</code> </p> <p><code>PATCH /apps/{app-id}/comments/{comment-id}</code> </p>","path":["API Reference","Endpoint index"],"tags":[]},{"location":"services/api/endpoint-index/#coge","level":2,"title":"coge","text":"<p><code>GET /coge/genomes</code> </p> <p><code>POST /coge/genomes/load</code> </p> <p><code>POST /coge/genomes/{genome-id}/export-fasta</code> </p>","path":["API Reference","Endpoint index"],"tags":[]},{"location":"services/api/endpoint-index/#favorites","level":2,"title":"favorites","text":"<p><code>GET /favorites/filesystem</code> </p>","path":["API Reference","Endpoint index"],"tags":[]},{"location":"services/api/endpoint-index/#filesystem","level":2,"title":"filesystem","text":"<p><code>PATCH /filesystem/entry/{entry-id}/comments/{comment-id}</code> </p>","path":["API Reference","Endpoint index"],"tags":[]},{"location":"services/api/endpoint-index/#permanent-id-requests","level":2,"title":"permanent-id-requests","text":"<p><code>GET /permanent-id-requests</code> </p> <p><code>POST /permanent-id-requests</code> </p> <p><code>GET /permanent-id-requests/status-codes</code> </p> <p><code>GET /permanent-id-requests/types</code> </p> <p><code>GET /permanent-id-requests/{request-id}</code> </p>","path":["API Reference","Endpoint index"],"tags":[]},{"location":"services/api/endpoint-index/#secured","level":2,"title":"secured","text":"<p><code>GET /secured/favorites/filesystem</code> </p> <p><code>DELETE /secured/favorites/filesystem/{favorite}</code> </p> <p><code>PUT /secured/favorites/filesystem/{favorite}</code> </p> <p><code>POST /secured/favorites/filter</code> </p> <p><code>GET /secured/fileio/download</code> </p> <p><code>POST /secured/fileio/save</code> </p> <p><code>POST /secured/fileio/saveas</code> </p> <p><code>POST /secured/fileio/upload</code> </p> <p><code>POST /secured/fileio/urlupload</code> </p> <p><code>POST /secured/filesystem/delete</code> </p> <p><code>POST /secured/filesystem/delete-contents</code> </p> <p><code>POST /secured/filesystem/delete-tickets</code> </p> <p><code>POST /secured/filesystem/directories</code> </p> <p><code>GET /secured/filesystem/directory</code> </p> <p><code>POST /secured/filesystem/directory/create</code> </p> <p><code>GET /secured/filesystem/display-download</code> </p> <p><code>GET /secured/filesystem/entry/{entry-id}/comments</code> </p> <p><code>POST /secured/filesystem/entry/{entry-id}/comments</code> </p> <p><code>PATCH /secured/filesystem/entry/{entry-id}/comments/{comment-id}</code> </p> <p><code>POST /secured/filesystem/exists</code> </p> <p><code>GET /secured/filesystem/file/manifest</code> </p> <p><code>GET /secured/filesystem/index</code> </p> <p><code>POST /secured/filesystem/list-tickets</code> </p> <p><code>POST /secured/filesystem/metadata/csv-parser</code> </p> <p><code>GET /secured/filesystem/metadata/template/attr/{attribute-id}</code> </p> <p><code>GET /secured/filesystem/metadata/template/{template-id}</code> </p> <p><code>GET /secured/filesystem/metadata/template/{template-id}/blank-csv</code> </p> <p><code>GET /secured/filesystem/metadata/template/{template-id}/guide-csv</code> </p> <p><code>GET /secured/filesystem/metadata/templates</code> </p> <p><code>POST /secured/filesystem/move</code> </p> <p><code>POST /secured/filesystem/move-contents</code> </p> <p><code>GET /secured/filesystem/paged-directory</code> </p> <p><code>POST /secured/filesystem/path-list-creator</code> </p> <p><code>POST /secured/filesystem/read-chunk</code> </p> <p><code>POST /secured/filesystem/read-csv-chunk</code> </p> <p><code>POST /secured/filesystem/rename</code> </p> <p><code>POST /secured/filesystem/restore</code> </p> <p><code>POST /secured/filesystem/restore-all</code> </p> <p><code>GET /secured/filesystem/root</code> </p> <p><code>POST /secured/filesystem/stat</code> </p> <p><code>POST /secured/filesystem/tickets</code> </p> <p><code>DELETE /secured/filesystem/trash</code> </p> <p><code>POST /secured/filesystem/user-permissions</code> </p> <p><code>GET /secured/filesystem/{data-id}/metadata</code> </p> <p><code>POST /secured/filesystem/{data-id}/metadata</code> </p> <p><code>POST /secured/filesystem/{data-id}/metadata/copy</code> </p> <p><code>POST /secured/filesystem/{data-id}/metadata/save</code> </p> <p><code>POST /secured/filesystem/{data-id}/ore/save</code> </p> <p><code>GET /secured/notifications/count-messages</code> </p> <p><code>POST /secured/notifications/delete</code> </p> <p><code>DELETE /secured/notifications/delete-all</code> </p> <p><code>GET /secured/notifications/last-ten-messages</code> </p> <p><code>POST /secured/notifications/mark-all-seen</code> </p> <p><code>GET /secured/notifications/messages</code> </p> <p><code>POST /secured/notifications/seen</code> </p> <p><code>POST /secured/notifications/system/delete</code> </p> <p><code>DELETE /secured/notifications/system/delete-all</code> </p> <p><code>POST /secured/notifications/system/mark-all-received</code> </p> <p><code>POST /secured/notifications/system/mark-all-seen</code> </p> <p><code>GET /secured/notifications/system/messages</code> </p> <p><code>GET /secured/notifications/system/new-messages</code> </p> <p><code>POST /secured/notifications/system/received</code> </p> <p><code>POST /secured/notifications/system/seen</code> </p> <p><code>GET /secured/notifications/system/unseen-messages</code> </p> <p><code>GET /secured/notifications/unseen-messages</code> </p> <p><code>GET /secured/oauth/access-code/{api-name}</code> </p> <p><code>DELETE /secured/preferences</code> </p> <p><code>GET /secured/preferences</code> </p> <p><code>POST /secured/preferences</code> </p> <p><code>DELETE /secured/sessions</code> </p> <p><code>GET /secured/sessions</code> </p> <p><code>POST /secured/sessions</code> </p>","path":["API Reference","Endpoint index"],"tags":[]},{"location":"services/api/endpoint-index/#send-notification","level":2,"title":"send-notification","text":"<p><code>POST /send-notification.</code> </p>","path":["API Reference","Endpoint index"],"tags":[]},{"location":"services/api/endpoint-index/#uuid","level":2,"title":"uuid","text":"<p><code>GET /uuid</code> </p>","path":["API Reference","Endpoint index"],"tags":[]},{"location":"services/api/errors/","level":1,"title":"Errors","text":"<p>If a service call causes an exception that is not caught by the service itself then Terrain will respond with a standardized error message:</p> <pre><code>{\n    \"error_code\": \"ERR_UNCHECKED_EXCEPTION\",\n    \"message\": reason-for-error\n}\n</code></pre> <p>The HTTP status code that is returned will either be a 400 or a 500, depending on which type of exception is caught. In either case, the reason for the error should be examined. If the logging level is set to error or lower then the exception will be logged in Terrain's log file along with a stack trace. This can be helpful in cases where the true cause of the error isn't obvious at first.</p>","path":["API Reference","Errors"],"tags":[]},{"location":"services/api/tapis-v2-v3-migration/","level":1,"title":"Tapis v2 (Agave) App migration to v3 for the Discovery Environment","text":"<p>The Tapis v3 App docs can be referenced when creating a new app from scratch, and for other details beyond the scope of this migration guide, but the easiest way to show how to migrate a Tapis v2 (Agave) app to v3 for the Discovery Environment (DE) might be with the following example.</p>","path":["API Reference","Migration Guides","Tapis v2 (Agave) App migration to v3 for the Discovery Environment"],"tags":[]},{"location":"services/api/tapis-v2-v3-migration/#system-permission-requirements-for-app-creators","level":2,"title":"System Permission Requirements for App Creators","text":"<p>Before creating HPC apps for Tapis v3, the app's execution system and the iRODS system defined in the Tapis v3 <code>cyverse</code> tenant must be shared with the app creator with <code>MODIFY</code> permissions (note that this will not grant the app creator modify permissions on the underlying iRODS directories).</p> <p>This has to do with the fact that these systems use proxy admin users to act on behalf of DE users when running Tapis v3 apps and when reading and writing iRODS data in the Data Store.</p>","path":["API Reference","Migration Guides","Tapis v2 (Agave) App migration to v3 for the Discovery Environment"],"tags":[]},{"location":"services/api/tapis-v2-v3-migration/#tapis-v2-app-definition","level":2,"title":"Tapis v2 App Definition","text":"<p>First consider a Tapis v2 app definition like the following:</p> <pre><code>{\n  \"id\": \"CyVerse-QA-Test-App-0.1u1\",\n  \"name\": \"CyVerse QA Test App\",\n  \"defaultMaxRunTime\": \"00:02:00\",\n  \"version\": \"0.1\",\n  \"shortDescription\": \"CyVerse QA Test App\",\n  \"longDescription\": \"CyVerse QA Test App for all parameter types.\",\n  \"helpURI\": \"https://docs.cyverse.org/services/api_overview/\",\n  \"tags\": [\n    \"QA\",\n    \"test\"\n  ],\n  \"executionType\": \"HPC\",\n  \"executionSystem\": \"stampede2.tacc.utexas.edu\",\n  \"deploymentPath\": \"/api/2/apps/qatesttool.zip\",\n  \"deploymentSystem\": \"data.iplantcollaborative.org\",\n  \"templatePath\": \"word-count.sh\",\n  \"testPath\": \"test.sh\",\n  \"inputs\": [\n    {\n      \"id\": \"requiredInput\",\n      \"value\": {\n        \"visible\": true,\n        \"required\": true\n      },\n      \"details\": {\n        \"label\": \"Required Input File\",\n        \"description\": \"Required input file.\"\n      },\n      \"semantics\": {\n        \"minCardinality\": 1,\n        \"maxCardinality\": 1,\n        \"fileTypes\": [\n          \"TEXT-0\",\n          \"RAW-0\"\n        ]\n      }\n    },\n    {\n      \"id\": \"optionalInput\",\n      \"value\": {\n        \"visible\": true,\n        \"required\": false\n      },\n      \"details\": {\n        \"label\": \"Optional Input File\",\n        \"description\": \"Not required, excluded if empty.\"\n      },\n      \"semantics\": {\n        \"minCardinality\": 0,\n        \"maxCardinality\": 1,\n        \"fileTypes\": [\n          \"TEXT-0\",\n          \"RAW-0\"\n        ]\n      }\n    },\n    {\n      \"id\": \"fixedInput\",\n      \"value\": {\n        \"visible\": false,\n        \"required\": true,\n        \"default\": \"agave://data.iplantcollaborative.org/home/shared/cyverse_training/example/coffee_cake.txt\"\n      },\n      \"details\": {\n        \"description\": \"Fixed input.\"\n      },\n      \"semantics\": {\n        \"minCardinality\": 1,\n        \"maxCardinality\": 1,\n        \"fileTypes\": [\n          \"TEXT-0\",\n          \"RAW-0\"\n        ]\n      }\n    }\n  ],\n  \"parameters\": [\n    {\n      \"id\": \"requiredOutput\",\n      \"value\": {\n        \"visible\": true,\n        \"required\": true,\n        \"type\": \"string\",\n        \"default\": \"out.txt\"\n      },\n      \"details\": {\n        \"label\": \"Output File\",\n        \"description\": \"Output File command line option.\",\n        \"argument\": null\n      },\n      \"semantics\": {\n        \"minCardinality\": 1,\n        \"maxCardinality\": 1,\n        \"ontology\": [\n          \"xs:string\"\n        ]\n      }\n    },\n    {\n      \"id\": \"textInput\",\n      \"value\": {\n        \"visible\": true,\n        \"required\": false,\n        \"type\": \"string\"\n      },\n      \"details\": {\n        \"label\": \"Text Input\",\n        \"description\": \"Single-line text.\"\n      }\n    },\n    {\n      \"id\": \"flagInput\",\n      \"value\": {\n        \"visible\": true,\n        \"required\": false,\n        \"type\": \"flag\"\n      },\n      \"details\": {\n        \"label\": \"Flag Input\",\n        \"description\": \"Checkbox input.\",\n        \"argument\": \"-f\",\n        \"showArgument\": true\n      },\n      \"semantics\": {\n        \"minCardinality\": 0,\n        \"maxCardinality\": 1,\n        \"ontology\": [\n          \"xs:boolean\"\n        ]\n      }\n    },\n    {\n      \"id\": \"flagInputAlt\",\n      \"value\": {\n        \"visible\": true,\n        \"required\": false,\n        \"type\": \"string\"\n      },\n      \"details\": {\n        \"label\": \"Flag Input 2\",\n        \"description\": \"Another Checkbox input.\",\n        \"argument\": \"-f2\",\n        \"showArgument\": true\n      },\n      \"semantics\": {\n        \"minCardinality\": 0,\n        \"maxCardinality\": 1,\n        \"ontology\": [\n          \"xs:boolean\"\n        ]\n      }\n    },\n    {\n      \"id\": \"integerInput\",\n      \"value\": {\n        \"visible\": true,\n        \"required\": false,\n        \"type\": \"number\"\n      },\n      \"details\": {\n        \"label\": \"Integer\",\n        \"description\": \"Integer input.\"\n      },\n      \"semantics\": {\n        \"minCardinality\": 0,\n        \"maxCardinality\": 1,\n        \"ontology\": [\n          \"xs:int\"\n        ]\n      }\n    },\n    {\n      \"id\": \"doubleInput\",\n      \"value\": {\n        \"visible\": true,\n        \"required\": false,\n        \"type\": \"number\"\n      },\n      \"details\": {\n        \"label\": \"Decimal\",\n        \"description\": \"Decimal input.\"\n      }\n    },\n    {\n      \"id\": \"listInput\",\n      \"value\": {\n        \"visible\": true,\n        \"required\": false,\n        \"type\": \"enumeration\",\n        \"order\": 0,\n        \"enquote\": false,\n        \"default\": null,\n        \"enum_values\": [\n          {\n            \"val1\": \"Value 1\"\n          },\n          {\n            \"val2\": \"Value 2\"\n          },\n          {\n            \"val3\": \"Value 3\"\n          }\n        ]\n      },\n      \"details\": {\n        \"label\": \"Selection List\",\n        \"description\": \"List input.\",\n        \"argument\": \"--list \",\n        \"showArgument\": true\n      },\n      \"semantics\": {\n        \"minCardinality\": 0,\n        \"maxCardinality\": 1,\n        \"ontology\": []\n      }\n    }\n  ],\n  \"outputs\": [\n    {\n      \"id\": \"requiredOutput\",\n      \"value\": {\n        \"default\": \"out.txt\"\n      },\n      \"details\": {\n        \"label\": \"Output File\",\n        \"description\": \"Output File command line option.\"\n      },\n      \"semantics\": {\n        \"minCardinality\": 1,\n        \"maxCardinality\": 1,\n        \"ontology\": [],\n        \"fileTypes\": [\n          \"TEXT-0\"\n        ]\n      }\n    }\n  ]\n}\n</code></pre>","path":["API Reference","Migration Guides","Tapis v2 (Agave) App migration to v3 for the Discovery Environment"],"tags":[]},{"location":"services/api/tapis-v2-v3-migration/#tapis-v3-app-definition","level":2,"title":"Tapis v3 App Definition","text":"<p>That v2 app could be migrated to v3 like the following:</p> <pre><code>{\n  \"id\": \"CyVerse-QA-Test-App\",\n  \"version\": \"0.1\",\n  \"tenant\": \"cyverse\",\n  \"description\": \"QA Test app for all parameter types.\",\n  \"runtime\": \"DOCKER\",\n  \"containerImage\": \"discoenv/qatesttool\",\n  \"jobType\": \"FORK\",\n  \"tags\": [\n    \"QA\",\n    \"test\"\n  ],\n  \"notes\": {\n    \"name\": \"CyVerse QA Test App\",\n    \"helpURI\": \"https://docs.cyverse.org/services/api_overview/\",\n    \"outputs\": [\n      {\n        \"name\": \"requiredOutput\",\n        \"description\": \"Output File command line option.\",\n        \"arg\": \"out.txt\",\n        \"details\": {\n          \"label\": \"Output File\"\n        }\n      }\n    ]\n  },\n  \"jobAttributes\": {\n    \"execSystemId\": \"cyverse-qacondor1-qa-test3\",\n    \"maxMinutes\": 2,\n    \"parameterSet\": {\n      \"containerArgs\": [\n        {\n          \"name\": \"workdir\",\n          \"arg\": \"-w /TapisOutput\",\n          \"inputMode\": \"FIXED\"\n        }\n      ],\n      \"envVariables\": [\n        {\n          \"key\": \"NEW_ENV_VAR\",\n          \"value\": \"testing env\",\n          \"inputMode\": \"FIXED\"\n        }\n      ],\n      \"appArgs\": [\n        {\n          \"name\": \"requiredOutput\",\n          \"description\": \"Output File command line option.\",\n          \"arg\": \"out.txt\",\n          \"inputMode\": \"REQUIRED\",\n          \"notes\": {\n            \"details\": {\n              \"label\": \"Output File\"\n            },\n            \"value\": {\n              \"default\": \"out.txt\"\n            }\n          }\n        },\n        {\n          \"name\": \"textInput\",\n          \"description\": \"Single-line text.\",\n          \"notes\": {\n            \"details\": {\n              \"label\": \"Text Input\"\n            }\n          }\n        },\n        {\n          \"name\": \"flagInput\",\n          \"description\": \"Checkbox input.\",\n          \"arg\": \"-f\",\n          \"notes\": {\n            \"details\": {\n              \"label\": \"Flag Input\"\n            },\n            \"value\": {\n              \"type\": \"flag\"\n            }\n          }\n        },\n        {\n          \"name\": \"flagInputAlt\",\n          \"description\": \"Another Checkbox input.\",\n          \"arg\": \"-f2\",\n          \"notes\": {\n            \"details\": {\n              \"label\": \"Flag Input 2\"\n            },\n            \"value\": {\n              \"type\": \"string\"\n            },\n            \"semantics\": {\n              \"ontology\": [\n                \"xs:boolean\"\n              ]\n            }\n          }\n        },\n        {\n          \"name\": \"integerInput\",\n          \"description\": \"Integer input.\",\n          \"notes\": {\n            \"details\": {\n              \"label\": \"Integer\"\n            },\n            \"value\": {\n              \"type\": \"number\"\n            },\n            \"semantics\": {\n              \"ontology\": [\n                \"xs:int\"\n              ]\n            }\n          }\n        },\n        {\n          \"name\": \"doubleInput\",\n          \"description\": \"Decimal input.\",\n          \"notes\": {\n            \"details\": {\n              \"label\": \"Decimal\"\n            },\n            \"value\": {\n              \"type\": \"number\"\n            }\n          }\n        },\n        {\n          \"name\": \"listInput\",\n          \"description\": \"List input.\",\n          \"notes\": {\n            \"value\": {\n              \"visible\": true,\n              \"required\": false,\n              \"type\": \"enumeration\",\n              \"order\": 0,\n              \"default\": null,\n              \"enum_values\": [\n                {\n                  \"--list val1\": \"Value 1\"\n                },\n                {\n                  \"--list val2\": \"Value 2\"\n                },\n                {\n                  \"--list val3\": \"Value 3\"\n                }\n              ]\n            },\n            \"details\": {\n              \"label\": \"Selection List\"\n            }\n          }\n        },\n        {\n          \"name\": \"requiredInput\",\n          \"description\": \"Required input file.\",\n          \"inputMode\": \"REQUIRED\",\n          \"notes\": {\n            \"details\": {\n              \"label\": \"Required Input File\"\n            }\n          }\n        },\n        {\n          \"name\": \"optionalInput\",\n          \"description\": \"Not required, excluded if empty.\",\n          \"notes\": {\n            \"details\": {\n              \"label\": \"Optional Input File\"\n            }\n          }\n        }\n      ]\n    },\n    \"fileInputs\": [\n      {\n        \"name\": \"requiredInput\",\n        \"description\": \"Required input.\",\n        \"inputMode\": \"REQUIRED\",\n        \"targetPath\": \"*\"\n      },\n      {\n        \"name\": \"optionalInput\",\n        \"description\": \"Not required, excluded if empty.\",\n        \"targetPath\": \"*\"\n      },\n      {\n        \"name\": \"fixedInput\",\n        \"description\": \"Fixed input.\",\n        \"inputMode\": \"FIXED\",\n        \"sourceUrl\": \"tapis://data.cyverse.rocks/home/shared/cyverse_training/example/coffee_cake.txt\",\n        \"targetPath\": \"*\"\n      }\n    ]\n  }\n}\n</code></pre>","path":["API Reference","Migration Guides","Tapis v2 (Agave) App migration to v3 for the Discovery Environment"],"tags":[]},{"location":"services/api/tapis-v2-v3-migration/#tapis-v3-migration-details","level":2,"title":"Tapis v3 Migration Details","text":"","path":["API Reference","Migration Guides","Tapis v2 (Agave) App migration to v3 for the Discovery Environment"],"tags":[]},{"location":"services/api/tapis-v2-v3-migration/#the-notes-field","level":3,"title":"The <code>notes</code> Field","text":"<p>Some parameter fields are no longer used in Tapis v3, but they can be moved into a <code>notes</code> field for use by the DE, such as app and parameter <code>name</code> and <code>label</code> display fields.</p> <p>The DE will use the app's <code>notes.label</code> or <code>notes.name</code>, followed by the app's <code>version</code>, when displaying the app name in listings or the in the app launch form. If no <code>label</code> or <code>name</code> is found in the app's <code>notes</code>, then the DE will simply use the app's <code>id</code>.</p>","path":["API Reference","Migration Guides","Tapis v2 (Agave) App migration to v3 for the Discovery Environment"],"tags":[]},{"location":"services/api/tapis-v2-v3-migration/#parameters-and-app-args","level":3,"title":"Parameters and App Args","text":"<p>Now take the following v2 parameter, for example:</p> <pre><code>{\n  \"id\": \"textInput\",\n  \"value\": {\n    \"visible\": true,\n    \"required\": false,\n    \"type\": \"string\",\n    \"default\": \"default_value\"\n  },\n  \"details\": {\n    \"label\": \"Text Input\",\n    \"description\": \"Single-line text.\"\n  }\n}\n</code></pre> <p>This parameter can be defined in v3 <code>appArgs</code> like the following:</p> <pre><code>{\n  \"name\": \"textInput\",\n  \"description\": \"Single-line text.\",\n  \"arg\": \"default_value\",\n  \"notes\": {\n    \"details\": {\n      \"label\": \"Text Input\"\n    }\n  }\n}\n</code></pre> <p>The <code>id</code> field becomes <code>name</code>, the <code>description</code> moves to the top level, and the <code>value.default</code> field becomes the <code>arg</code> field; otherwise the remaining fields move into the <code>notes</code> field.</p> <p>If a <code>notes.details.label</code> field is not present, then the DE will use the <code>name</code> as the parameter's form field label.</p> <p>Note that the <code>visible</code>, <code>required</code>, and <code>type</code> fields are omitted in this example, since those are the defaults the DE will use for those parameter fields.</p> <p>If the v3 parameter has an <code>inputMode</code> field with a <code>REQUIRED</code> value, then the DE will treat that parameter as required and ignore the <code>notes.value.required</code> field.</p> <p>If the v3 parameter has an <code>inputMode</code> field with a <code>FIXED</code> value, then the DE will treat that parameter as hidden and ignore the <code>notes.value.visible</code> field.</p> <p>The <code>notes</code> object can contain any other custom fields (so the entire v2 parameter can be copied as the v3 <code>notes</code> field), which will be ignored by the DE, except for certain fields in specific parameter types, detailed in the following sections.</p>","path":["API Reference","Migration Guides","Tapis v2 (Agave) App migration to v3 for the Discovery Environment"],"tags":[]},{"location":"services/api/tapis-v2-v3-migration/#parameter-types","level":3,"title":"Parameter Types","text":"","path":["API Reference","Migration Guides","Tapis v2 (Agave) App migration to v3 for the Discovery Environment"],"tags":[]},{"location":"services/api/tapis-v2-v3-migration/#inputs","level":4,"title":"Inputs","text":"<p>If an input value is also required as a parameter on the command line, then the <code>name</code> of the input in the <code>fileInputs</code> parameter field should match the <code>name</code> of the corresponding <code>appArgs</code> parameter (or the <code>key</code> of the corresponding <code>envVariables</code> parameter).</p> <p>If the app's <code>runtime</code> value is <code>DOCKER</code>, then the DE will automatically prepend <code>/TapisInput/</code> to the file or folder name submitted by the user, since that is the directory mounted inside the container by Tapis for inputs. Otherwise only the base name of the file or folder will be submitted for the command line argument.</p>","path":["API Reference","Migration Guides","Tapis v2 (Agave) App migration to v3 for the Discovery Environment"],"tags":[]},{"location":"services/api/tapis-v2-v3-migration/#outputs","level":4,"title":"Outputs","text":"<p>The <code>outputs</code> field is not used by Tapis, but if a user wishes to create a pipeline workflow with multiple Tapis and DE apps, then the DE requires an app output to be defined so that it can be used as an app's input in a subsequent step in the workflow. If the output value is also required as a parameter on the command line, then the <code>name</code> of the output in the <code>notes</code> field should match the <code>name</code> of the corresponding <code>appArgs</code> parameter (or the <code>key</code> of the corresponding <code>envVariables</code> parameter).</p> <p>If the app's <code>runtime</code> value is <code>DOCKER</code>, then the DE will automatically prepend <code>/TapisOutput/</code> to the parameter value submitted by the user, since that is the directory mounted inside the container by Tapis for outputs. Otherwise the DE will automatically prepend <code>output/</code> to the parameter value submitted by the user, since that is the directory created by Tapis for outputs.</p>","path":["API Reference","Migration Guides","Tapis v2 (Agave) App migration to v3 for the Discovery Environment"],"tags":[]},{"location":"services/api/tapis-v2-v3-migration/#flags-or-booleans","level":4,"title":"Flags or Booleans","text":"<p>If the parameter has a <code>notes.value.type</code> field value of <code>bool</code>, <code>boolean</code>, or <code>flag</code>, then the DE will display that parameter as a checkbox. Parameters with a <code>notes.semantics.ontology</code> list where the first value is <code>xs:boolean</code> will also display as a checkbox.</p> <p>Note that the value of a v3 parameter's <code>arg</code> is used in job submissions when the user checks a flag parameter type in the submission form, and the <code>notes.details.argument</code> field is not used.</p>","path":["API Reference","Migration Guides","Tapis v2 (Agave) App migration to v3 for the Discovery Environment"],"tags":[]},{"location":"services/api/tapis-v2-v3-migration/#enumeration-lists","level":4,"title":"Enumeration Lists","text":"<p>If the parameter has a <code>notes.value.type</code> field value of <code>enumeration</code>, then the DE will display that parameter as a selection list.</p> <p>The parameter should also have a <code>notes.value.enum_values</code> field with an array of object values.</p> <p>Each of these enum objects should have a key that is the full command line argument that should be submitted as the parameter's <code>arg</code> value in the job submission, and a value that will be used as the display label by the DE in the form's selection list.</p> <p>As with Flag/Boolean parameter types, the <code>notes.details.argument</code> field is not used.</p>","path":["API Reference","Migration Guides","Tapis v2 (Agave) App migration to v3 for the Discovery Environment"],"tags":[]},{"location":"services/api/tapis-v2-v3-migration/#numbers","level":4,"title":"Numbers","text":"<p>If the parameter has a <code>notes.value.type</code> field value of <code>number</code>, then the DE will display that parameter as a number field. The DE will use the first <code>xs:*</code> value in the <code>notes.semantics.ontology</code> field to determine if the user's input should be restricted to integers or decimal values.</p> <p>See https://github.com/cyverse-de/mescal/blob/main/src/mescal/agave_de_v2/params.clj for a list of supported number XSD types (otherwise defaulting to decimal values).</p>","path":["API Reference","Migration Guides","Tapis v2 (Agave) App migration to v3 for the Discovery Environment"],"tags":[]},{"location":"services/api/tapis-v2-v3-migration/#migration-helper-jq","level":2,"title":"Migration helper <code>jq</code>","text":"<p>The following <code>jq</code> command can be used to bootstrap a migration from a v2 app into a v3 format. It's not exhaustive, so some manual editing of the output will be required, particularly for the <code>execSystemId</code>, <code>containerImage</code>, and <code>enumeration</code> type parameter fields; but it can at least help with some tedious tasks, such as copying v2 fields used by the DE into v3 <code>notes</code> fields.</p> <pre><code>jq 'def params: . | {\"name\": .id, \"arg\": ((.details.argument // .value.default) | tostring), \"description\": .details.description, \"inputMode\": (.value.required | if . then \"REQUIRED\" else \"INCLUDE_ON_DEMAND\" end), \"notes\": .} | if (.description | length) &gt; 0 then . else del(.description) end; {id, version, \"description\": .longDescription, \"runtime\": \"ZIP\", \"containerImage\": \"tapis://\\(.deploymentSystem)\\(.deploymentPath)\", \"jobType\": \"BATCH\", tags, \"jobAttributes\":{\"execSystemId\": \"stampede3\", \"maxMinutes\": 1440, \"parameterSet\": {\"appArgs\": [.parameters[] | params]}, \"fileInputs\": [.inputs[] | params | {\"targetPath\": \"*\"} + .]}, \"notes\": {name, \"label\": .label, owner, shortDescription, longDescription, helpURI, ontology, executionType, executionSystem, deploymentPath, deploymentSystem, templatePath, testPath, modules, outputs}}' v2_app.json\n</code></pre> <p>Note that Tapis no longer automatically passes job parameters to the template wrapper script as environment variables by the parameter ID, so the app's wrapper script will also need to be updated to use command line arguments instead of env vars.</p> <p>If the wrapper script was something like the following: <pre><code>singularity exec $IMG run_prodigal -o \"prodigal-out\" ${QUERY} ${WRITE_PROT} ${CLOSED_ENDS} ${WRITE_NUCL} ${OUTPUT_FORMAT} ${NS_AS_MASKED} ${BYPASS_SHINE_DALGARNO} ${PROCEDURE} ${WRITE_GENES}\n</code></pre></p> <p>Then it could be simplified for v3 without relying on environment variables: <pre><code>singularity exec $IMG run_prodigal -o \"prodigal-out\" \"$@\"\necho $? &gt; \"${_tapisSysRootDir}${_tapisExecSystemOutputDir}/tapisjob.exitcode\"\n</code></pre> See https://tapis.readthedocs.io/en/latest/technical/jobs.html#zip about <code>tapisjob.exitcode</code>.</p> <p>If the app's wrapper script has logic that depends on the environment variable values, and it would be too difficult to convert the wrapper script for command line arguments, then use the following <code>jq</code> command, which will populate the v3 app's <code>envVariables</code> array instead of the <code>appArgs</code> parameter array:</p> <pre><code>jq 'def params: . | {\"name\": .id, \"arg\": ((.details.argument // .value.default) | tostring), \"description\": .details.description, \"inputMode\": (.value.required | if . then \"REQUIRED\" else \"INCLUDE_ON_DEMAND\" end), \"notes\": .} | if (.description | length) &gt; 0 then . else del(.description) end; {id, version, \"description\": .longDescription, \"runtime\": \"ZIP\", \"containerImage\": \"tapis://\\(.deploymentSystem)\\(.deploymentPath)\", \"jobType\": \"BATCH\", tags, \"jobAttributes\":{\"execSystemId\": \"stampede3\", \"maxMinutes\": 1440, \"parameterSet\": {\"envVariables\": ([.parameters[] | params] | map(.key = .name | .value = .arg | del(.name, .arg)))}, \"fileInputs\": [.inputs[] | params | {\"targetPath\": \"*\"} + .]}, \"notes\": {name, \"label\": .label, owner, shortDescription, longDescription, helpURI, ontology, executionType, executionSystem, deploymentPath, deploymentSystem, templatePath, testPath, modules, outputs}}' v2_app.json\n</code></pre> <p>The DE will process and display <code>envVariables</code> fields the same way that <code>appArgs</code> parameter fields are processed and displayed, as described in the previous sections, except the env var's <code>key</code> and <code>value</code> are used in place of <code>name</code> and <code>arg</code>.</p> <p>With the help of this guide and the Tapis v3 docs, hopefully the migration will not be too difficult.</p>","path":["API Reference","Migration Guides","Tapis v2 (Agave) App migration to v3 for the Discovery Environment"],"tags":[]},{"location":"services/api/tapis-v2-v3-migration/#tapis-v3-curl-commands","level":1,"title":"Tapis v3 <code>curl</code> Commands","text":"<p>The following shell environment variables, aliases, and curl commands can be used to publish v3 app JSON (such as the JSON output above).</p>","path":["API Reference","Migration Guides","Tapis v2 (Agave) App migration to v3 for the Discovery Environment"],"tags":[]},{"location":"services/api/tapis-v2-v3-migration/#set-tapis_access_token-and-tapis_auth_header-env-vars","level":2,"title":"Set TAPIS_ACCESS_TOKEN and TAPIS_AUTH_HEADER env vars","text":"<p>Assuming the env vars <code>CYVERSE_USER</code> and <code>CYVERSE_PASSWORD</code> are set:</p> <pre><code>export TAPIS_ACCESS_TOKEN=$(curl -H \"Content-Type: application/json\" -s -d \"{\\\"username\\\": \\\"$CYVERSE_USER\\\", \\\"password\\\": \\\"$CYVERSE_PASSWORD\\\", \\\"grant_type\\\": \\\"password\\\" }\" https://cyverse.tapis.io/v3/oauth2/tokens | jq -r '.result.access_token')\n</code></pre> <pre><code>export TAPIS_AUTH_HEADER=\"X-Tapis-Token: $(echo $TAPIS_ACCESS_TOKEN | jq -r .access_token)\"\n</code></pre>","path":["API Reference","Migration Guides","Tapis v2 (Agave) App migration to v3 for the Discovery Environment"],"tags":[]},{"location":"services/api/tapis-v2-v3-migration/#set-a-curl-alias-that-references-the-tapis_auth_header","level":2,"title":"Set a curl alias that references the $TAPIS_AUTH_HEADER","text":"<pre><code>alias curl-tapis='curl -H \"Content-Type: application/json\" -H \"$TAPIS_AUTH_HEADER\"'\n</code></pre>","path":["API Reference","Migration Guides","Tapis v2 (Agave) App migration to v3 for the Discovery Environment"],"tags":[]},{"location":"services/api/tapis-v2-v3-migration/#list-systems","level":2,"title":"List Systems","text":"<pre><code>curl-tapis -s \"https://cyverse.tapis.io/v3/systems?listType=ALL\"\n</code></pre>","path":["API Reference","Migration Guides","Tapis v2 (Agave) App migration to v3 for the Discovery Environment"],"tags":[]},{"location":"services/api/tapis-v2-v3-migration/#apps","level":2,"title":"Apps","text":"","path":["API Reference","Migration Guides","Tapis v2 (Agave) App migration to v3 for the Discovery Environment"],"tags":[]},{"location":"services/api/tapis-v2-v3-migration/#create-an-app","level":3,"title":"Create an App","text":"<pre><code>curl-tapis -s -d @app-wc.json https://cyverse.tapis.io/v3/apps\n</code></pre>","path":["API Reference","Migration Guides","Tapis v2 (Agave) App migration to v3 for the Discovery Environment"],"tags":[]},{"location":"services/api/tapis-v2-v3-migration/#get-app-details","level":3,"title":"Get App Details","text":"<pre><code>curl-tapis -s \"https://cyverse.tapis.io/v3/apps/cyverse-word-count-psarando?select=id,jobAttributes.execSystemId,version,updated,tenant,description,isPublic,owner,enabled\"\n</code></pre>","path":["API Reference","Migration Guides","Tapis v2 (Agave) App migration to v3 for the Discovery Environment"],"tags":[]},{"location":"services/api/tapis-v2-v3-migration/#update-an-app","level":3,"title":"Update an App","text":"<pre><code>curl-tapis -s -X PUT -d @app-wc.json \"https://cyverse.tapis.io/v3/apps/cyverse-word-count-psarando/0.1\"\n</code></pre> <pre><code>curl-tapis -s -X PATCH -d '{\"jobAttributes\": {\"execSystemId\": \"cyverse-qacondor1-qa-test3\"}}' \"https://cyverse.tapis.io/v3/apps/cyverse-hello-world-psarando/0.1\"\n</code></pre> <pre><code>curl-tapis -s -X PATCH -d '{\"jobAttributes\": {\"archiveSystemId\": \"cyverse-irods-qa\"}}' \"https://cyverse.tapis.io/v3/apps/cyverse-hello-world-psarando/0.1\"\n</code></pre> <pre><code>curl-tapis -s -X PATCH -d '{\"tags\": [\"test-tag\", \"testing\"]}' \"https://cyverse.tapis.io/v3/apps/cyverse-hello-world-psarando/0.1\"\n</code></pre>","path":["API Reference","Migration Guides","Tapis v2 (Agave) App migration to v3 for the Discovery Environment"],"tags":[]},{"location":"services/api/tapis-v2-v3-migration/#make-app-public","level":3,"title":"Make App Public","text":"<pre><code>curl-tapis -s -X POST \"https://cyverse.tapis.io/v3/apps/share_public/cyverse-hello-world-psarando\"\n</code></pre> <pre><code>curl-tapis -s -X POST \"https://cyverse.tapis.io/v3/apps/unshare_public/cyverse-hello-world-psarando\"\n</code></pre>","path":["API Reference","Migration Guides","Tapis v2 (Agave) App migration to v3 for the Discovery Environment"],"tags":[]},{"location":"services/api/tapis-v2-v3-migration/#jobs","level":2,"title":"Jobs","text":"","path":["API Reference","Migration Guides","Tapis v2 (Agave) App migration to v3 for the Discovery Environment"],"tags":[]},{"location":"services/api/tapis-v2-v3-migration/#list-jobs","level":3,"title":"List Jobs","text":"<pre><code>curl-tapis -s \"https://cyverse.tapis.io/v3/jobs/list?limit=2&amp;orderBy=lastUpdated(desc),name(asc)&amp;computeTotal=true\" | jq .\n</code></pre>","path":["API Reference","Migration Guides","Tapis v2 (Agave) App migration to v3 for the Discovery Environment"],"tags":[]},{"location":"services/api/tapis-v2-v3-migration/#submit-a-job","level":3,"title":"Submit a Job","text":"<pre><code>curl-tapis -s -d @job.json https://cyverse.tapis.io/v3/jobs/submit | jq .\n</code></pre>","path":["API Reference","Migration Guides","Tapis v2 (Agave) App migration to v3 for the Discovery Environment"],"tags":[]},{"location":"services/api/tapis-v2-v3-migration/#get-job-status","level":3,"title":"Get Job Status","text":"<pre><code>curl-tapis -s \"https://cyverse.tapis.io/v3/jobs/5f660fd9-0718-4935-92ad-a67497d45013-007/status\" | jq .\n</code></pre>","path":["API Reference","Migration Guides","Tapis v2 (Agave) App migration to v3 for the Discovery Environment"],"tags":[]},{"location":"services/api/tapis-v2-v3-migration/#list-job-history","level":3,"title":"List Job History","text":"<pre><code>curl-tapis -s \"https://cyverse.tapis.io/v3/jobs/5f660fd9-0718-4935-92ad-a67497d45013-007/history\" | jq .\n</code></pre>","path":["API Reference","Migration Guides","Tapis v2 (Agave) App migration to v3 for the Discovery Environment"],"tags":[]},{"location":"services/api/tapis-v2-v3-migration/#list-job-outputs","level":3,"title":"List Job Outputs","text":"<pre><code>curl-tapis -s \"https://cyverse.tapis.io/v3/jobs/5f660fd9-0718-4935-92ad-a67497d45013-007/output/list/\" | jq .\n</code></pre>","path":["API Reference","Migration Guides","Tapis v2 (Agave) App migration to v3 for the Discovery Environment"],"tags":[]},{"location":"services/api/tapis-v2-v3-migration/#list-folder-contents","level":2,"title":"List Folder Contents","text":"<pre><code>curl-tapis -s \"https://cyverse.tapis.io/v3/files/ops/cyverse-irods-qa/home/psarando/analyses/Tapis_QA_Job\" | jq .\n</code></pre>","path":["API Reference","Migration Guides","Tapis v2 (Agave) App migration to v3 for the Discovery Environment"],"tags":[]},{"location":"services/api/endpoints/app-metadata/","level":1,"title":"Application Metadata Endpoints","text":"<p>Jump to:</p> <ul> <li> <p>Application Metadata Endpoints</p> </li> <li> <p>Adding Categories</p> </li> <li> <p>Searching for Categories by Name</p> </li> <li> <p>Deleting a Category by ID</p> </li> <li> <p>Updating an App Category</p> </li> <li> <p>Managing App AVU Metadata</p> </li> <li> <p>Listing App Categories</p> </li> <li> <p>Listing Workspaces</p> </li> <li> <p>Deleting Workspaces</p> </li> </ul>","path":["API Reference","Endpoints","Application Metadata Endpoints"],"tags":[]},{"location":"services/api/endpoints/app-metadata/#application-metadata-endpoints","level":1,"title":"Application Metadata Endpoints","text":"<p>Note that secured endpoints in Terrain and apps are a little different from each other. Please see Terrain Vs. Apps for more information.</p>","path":["API Reference","Endpoints","Application Metadata Endpoints"],"tags":[]},{"location":"services/api/endpoints/app-metadata/#adding-categories","level":2,"title":"Adding Categories","text":"<ul> <li>POST /admin/apps/categories/{system-id}</li> </ul> <p>This endpoint is a passthrough to the apps endpoint using the same path. Please see the apps service documentation for more information.</p>","path":["API Reference","Endpoints","Application Metadata Endpoints"],"tags":[]},{"location":"services/api/endpoints/app-metadata/#searching-for-categories-by-name","level":2,"title":"Searching for Categories by Name","text":"<ul> <li>GET /admin/apps/categories/search</li> </ul> <p>This endpoint is a passthrough to the apps endpoint using the same path. Please see the apps service documentation for more information.</p>","path":["API Reference","Endpoints","Application Metadata Endpoints"],"tags":[]},{"location":"services/api/endpoints/app-metadata/#deleting-a-category-by-id","level":2,"title":"Deleting a Category by ID","text":"<ul> <li>DELETE /admin/apps/categories/{system-id}/{category-id}</li> </ul> <p>This endpoint is a passthrough to the apps endpoint using the same path. Please see the apps service documentation for more information.</p>","path":["API Reference","Endpoints","Application Metadata Endpoints"],"tags":[]},{"location":"services/api/endpoints/app-metadata/#updating-an-app-category","level":2,"title":"Updating an App Category","text":"<ul> <li>PATCH /admin/apps/categories/{system-id}/{category-id}</li> </ul> <p>This endpoint is a passthrough to the apps endpoint using the same path. Please see the apps service documentation for more information.</p>","path":["API Reference","Endpoints","Application Metadata Endpoints"],"tags":[]},{"location":"services/api/endpoints/app-metadata/#managing-app-avu-metadata","level":2,"title":"Managing App AVU Metadata","text":"<ul> <li>GET /admin/apps/{app-id}/metadata</li> <li>POST /admin/apps/{app-id}/metadata</li> <li>PUT /admin/apps/{app-id}/metadata</li> </ul> <p>These endpoints are passthroughs to the apps endpoints using the same paths. Please see the corresponding service documentation for more information.</p>","path":["API Reference","Endpoints","Application Metadata Endpoints"],"tags":[]},{"location":"services/api/endpoints/app-metadata/#listing-app-categories","level":2,"title":"Listing App Categories","text":"<ul> <li>GET /admin/apps/categories</li> </ul> <p>Delegates to apps: <code>GET /admin/apps/categories</code></p> <p>These endpoints are passthroughs to the apps endpoints using the same path. Please see the apps service documentation for more information.</p>","path":["API Reference","Endpoints","Application Metadata Endpoints"],"tags":[]},{"location":"services/api/endpoints/app-metadata/#listing-workspaces","level":2,"title":"Listing Workspaces","text":"<ul> <li>GET /admin/workspaces</li> </ul> <p>This service is a passthrough to the apps endpoint using the same path. Please see the apps service documentation for more details.</p>","path":["API Reference","Endpoints","Application Metadata Endpoints"],"tags":[]},{"location":"services/api/endpoints/app-metadata/#deleting-workspaces","level":2,"title":"Deleting Workspaces","text":"<ul> <li>DELETE /admin/workspaces</li> </ul> <p>This service is a passthrough to the apps endpoint using the same path. Please see the apps service documentation for more details.</p>","path":["API Reference","Endpoints","Application Metadata Endpoints"],"tags":[]},{"location":"services/api/endpoints/app-ontologies/","level":1,"title":"Table of Contents","text":"<ul> <li>Categorizing Apps with Ontology Hierarchies<ul> <li>Save an Ontology XML Document</li> <li>Listing Saved Ontology Details</li> <li>Logically Deleting an Ontology</li> <li>Set Active Ontology Version</li> <li>Save an Ontology Hierarchy</li> <li>Deleting an Ontology Hierarchy</li> <li>Listing Hierarchies for any Ontology</li> <li>Listing Filtered Hierarchies for any Ontology</li> <li>Listing Apps in Hierarchies for any Ontology</li> <li>Listing Unclassified Apps for any Ontology</li> </ul> </li> </ul>","path":["API Reference","Endpoints","Table of Contents"],"tags":[]},{"location":"services/api/endpoints/app-ontologies/#categorizing-apps-with-ontology-hierarchies","level":1,"title":"Categorizing Apps with Ontology Hierarchies","text":"<ol> <li>First an admin must upload an ontology XML document,    which will be stored in the metadata database,    and later parsed with the OWLAPI libraries in order to build the app categories.<ul> <li>Save an Ontology XML Document</li> </ul> </li> <li>Once 1 or more ontology XML documents have been uploaded,    the details of each available ontology may be listed.    Each uploaded document is stored with a unique \"version\" ID.    This version ID is used in the remaining endpoints in order to save and list ontology classes and    hierarchies parsed from the associated ontology.<ul> <li>Listing Saved Ontology Details</li> <li>Ontologies may be removed from this listing by marking them as deleted:<ul> <li>Logically Deleting an Ontology</li> </ul> </li> </ul> </li> <li>Next an admin must choose which hierarchies (and the ontology classes in them)    will be available for use in the DE.<ul> <li>Save an Ontology Hierarchy</li> <li>An admin may delete all classes under any ontology class hierarchy   which will allow the admin to selectively remove sub-hierarchies,   or the entire hierarchy from the root.<ul> <li>Deleting an Ontology Hierarchy</li> <li>Deleted classes and sub-hierarchies can easily be re-added by re-saving the hierarchy root   (only classes and hierarchies that are not already saved under the given root are added).</li> </ul> </li> </ul> </li> <li>Finally, the admin sets an ontology version as the default,    <code>active</code> version used by the DE when listing hierarchies or ontology classes for regular users.<ul> <li>Set Active Ontology Version</li> <li>This active version is used by the apps service in the following endpoints:<ul> <li>Listing Ontology Hierarchies</li> <li>Listing Filtered Ontology Hierarchies</li> <li>Listing Unclassified Apps for the Active Ontology</li> </ul> </li> </ul> </li> <li>Admins or users with app \"write\" permissions may categorize those apps under ontology classes    by attaching the class IRIs as metadata.<ul> <li>Managing App AVU Metadata</li> </ul> </li> <li>Apps with an ontology class attached as metadata, or any class under the hierarchy of that root class,    may be listed with the following endpoint:<ul> <li>Listing Apps in Hierarchies for the Active Ontology</li> </ul> </li> <li>An admin may add hierarchies for other ontology versions    and preview their filtered hierarchies and app listings,    without affecting the active version in use by normal users.<ul> <li>Listing Hierarchies for any Ontology</li> <li>Listing Filtered Hierarchies for any Ontology</li> <li>Listing Apps in Hierarchies for any Ontology</li> <li>Listing Unclassified Apps for any Ontology</li> </ul> </li> </ol>","path":["API Reference","Endpoints","Table of Contents"],"tags":[]},{"location":"services/api/endpoints/app-ontologies/#save-an-ontology-xml-document","level":2,"title":"Save an Ontology XML Document","text":"<p>Secured Endpoint: POST /admin/ontologies</p> <p>Delegates to metadata: POST /admin/ontologies</p> <p>This endpoint is a passthrough to the metadata endpoint using the same path. Please see the metadata service documentation for more information.</p>","path":["API Reference","Endpoints","Table of Contents"],"tags":[]},{"location":"services/api/endpoints/app-ontologies/#listing-saved-ontology-details","level":2,"title":"Listing Saved Ontology Details","text":"<p>Secured Endpoint: GET /admin/ontologies</p> <p>Delegates to apps: GET /admin/ontologies</p> <p>This endpoint is a passthrough to the apps endpoint using the same path. Please see the apps service documentation for more information.</p>","path":["API Reference","Endpoints","Table of Contents"],"tags":[]},{"location":"services/api/endpoints/app-ontologies/#logically-deleting-an-ontology","level":2,"title":"Logically Deleting an Ontology","text":"<p>Secured Endpoint: DELETE /admin/ontologies/{ontology-version}</p> <p>Delegates to apps: DELETE /admin/ontologies/{ontology-version}</p> <p>This endpoint is a passthrough to the apps endpoint using the same path. Please see the apps service documentation for more information.</p>","path":["API Reference","Endpoints","Table of Contents"],"tags":[]},{"location":"services/api/endpoints/app-ontologies/#set-active-ontology-version","level":2,"title":"Set Active Ontology Version","text":"<p>Secured Endpoint: POST /admin/ontologies/{ontology-version}</p> <p>Delegates to apps: POST /admin/ontologies/{ontology-version}</p> <p>This endpoint is a passthrough to the apps endpoint using the same path. Please see the apps service documentation for more information.</p>","path":["API Reference","Endpoints","Table of Contents"],"tags":[]},{"location":"services/api/endpoints/app-ontologies/#save-an-ontology-hierarchy","level":2,"title":"Save an Ontology Hierarchy","text":"<p>Secured Endpoint: PUT /admin/ontologies/{ontology-version}/{root-iri}</p> <p>Delegates to metadata: PUT /admin/ontologies/{ontology-version}/{root-iri}</p> <p>This endpoint is a passthrough to the metadata endpoint using the same path. Please see the metadata service documentation for more information.</p>","path":["API Reference","Endpoints","Table of Contents"],"tags":[]},{"location":"services/api/endpoints/app-ontologies/#deleting-an-ontology-hierarchy","level":2,"title":"Deleting an Ontology Hierarchy","text":"<p>Secured Endpoint: DELETE /admin/ontologies/{ontology-version}/{root-iri}</p> <p>Delegates to metadata: DELETE /admin/ontologies/{ontology-version}/{root-iri}</p> <p>This endpoint is a passthrough to the metadata endpoint using the same path. Please see the metadata service documentation for more information.</p>","path":["API Reference","Endpoints","Table of Contents"],"tags":[]},{"location":"services/api/endpoints/app-ontologies/#listing-hierarchies-for-any-ontology","level":2,"title":"Listing Hierarchies for any Ontology","text":"<p>Secured Endpoint: GET /admin/ontologies/{ontology-version}</p> <p>Delegates to metadata: GET /ontologies/{ontology-version}</p> <p>This endpoint is a passthrough to the metadata endpoint using the same path. Please see the metadata service documentation for more information.</p>","path":["API Reference","Endpoints","Table of Contents"],"tags":[]},{"location":"services/api/endpoints/app-ontologies/#listing-filtered-hierarchies-for-any-ontology","level":2,"title":"Listing Filtered Hierarchies for any Ontology","text":"<p>Secured Endpoint: GET /admin/ontologies/{ontology-version}/{root-iri}</p> <p>Delegates to apps: GET /admin/ontologies/{ontology-version}/{root-iri}</p> <p>This endpoint is a passthrough to the apps endpoint using the same path. Please see the apps service documentation for more information.</p>","path":["API Reference","Endpoints","Table of Contents"],"tags":[]},{"location":"services/api/endpoints/app-ontologies/#listing-apps-in-hierarchies-for-any-ontology","level":2,"title":"Listing Apps in Hierarchies for any Ontology","text":"<p>Secured Endpoint: GET /admin/ontologies/{ontology-version}/{root-iri}/apps</p> <p>Delegates to apps: GET /admin/ontologies/{ontology-version}/{root-iri}/apps</p> <p>This endpoint is a passthrough to the apps endpoint using the same path. Please see the apps service documentation for more information.</p>","path":["API Reference","Endpoints","Table of Contents"],"tags":[]},{"location":"services/api/endpoints/app-ontologies/#listing-unclassified-apps-for-any-ontology","level":2,"title":"Listing Unclassified Apps for any Ontology","text":"<p>Secured Endpoint: GET /admin/ontologies/{ontology-version}/{root-iri}/unclassified</p> <p>Delegates to apps: GET /admin/ontologies/{ontology-version}/{root-iri}/unclassified</p> <p>This endpoint is a passthrough to the apps endpoint using the same path. Please see the apps service documentation for more information.</p>","path":["API Reference","Endpoints","Table of Contents"],"tags":[]},{"location":"services/api/endpoints/callbacks/","level":1,"title":"Callback Endpoints","text":"<p>These endpoints listed in this document accept callbacks from other services indicating that some event has occurred.</p>","path":["API Reference","Endpoints","Callback Endpoints"],"tags":[]},{"location":"services/api/endpoints/callbacks/#obtaining-oauth-authorization-codes","level":2,"title":"Obtaining OAuth Authorization Codes","text":"<p>Secured Endpoint: GET /secured/oauth/access-code/{api-name}</p> <p>Delegates to apps: GET /secured/oauth/access-code/{api-name}</p> <p>The only API name that is currently supported is <code>agave</code>.</p> <p>The DE calls this endpoint after the user gives the DE permission to access a third-party API on his or her behalf. Agave sends a callback to a servlet in the DE, which obtains a CAS proxy ticket and sends a request to this service to obtain an access token for the user. This service requires the following query parameters:</p> ParameterDescription code The authorization code provided by the OAuth server. state A UUID referring to the original authorization request. <p>Upon success, the response to this service is in the following format:</p> <pre><code>{\n    \"state_info\": \"{arbitrary-state-information}\"\n}\n</code></pre> <p>This service is used any time another service determines that an authorization code is required in order to proceed. The steps are described in detail below:</p>","path":["API Reference","Endpoints","Callback Endpoints"],"tags":[]},{"location":"services/api/endpoints/callbacks/#step-1-the-other-service-determines-that-authorization-is-required","level":3,"title":"Step 1: The other service determines that authorization is required.","text":"<p>This can happen in two different ways:</p> <ol> <li>No access token is found in the database for the user.</li> <li>An access token is found, but attempts to use or refresh the token failed.</li> </ol>","path":["API Reference","Endpoints","Callback Endpoints"],"tags":[]},{"location":"services/api/endpoints/callbacks/#step-2-the-other-service-stores-state-information-in-the-database","level":3,"title":"Step 2: The other service stores state information in the database.","text":"<p>This state information is specific to each service, and enables the DE to route the user back to the same window in the DE after the authorization process is complete. The state information is associated with a UUID and the username of the current user. This adds an extra layer of security because it allows this service (the service that accepts the authorization code) to ensure that the user who obtained the authorization code is the same as the user who initiated the request that required it.</p>","path":["API Reference","Endpoints","Callback Endpoints"],"tags":[]},{"location":"services/api/endpoints/callbacks/#step-3-the-user-is-redirected-to-the-oauth-authorization-service","level":3,"title":"Step 3: The user is redirected to the OAuth authorization service.","text":"<p>This redirection contains several query parameters that are either required or recommended by the OAuth 2.0 specification:</p> ParameterDescription response_type The type of response requested (always set to \"code\"). client_id The DE's OAuth API client identifier. redirect_uri The URI to redirect the user to after authorization state The UUID associated with the state information from step 2.","path":["API Reference","Endpoints","Callback Endpoints"],"tags":[]},{"location":"services/api/endpoints/callbacks/#step-4-the-user-either-grants-or-denies-authorization","level":3,"title":"Step 4: The user either grants or denies authorization.","text":"<p>This step happens outside of the DE. The user authenticates to the external service and either grants or denies the authorization request.</p>","path":["API Reference","Endpoints","Callback Endpoints"],"tags":[]},{"location":"services/api/endpoints/callbacks/#step-5-the-user-is-redirected-back-to-the-de","level":3,"title":"Step 5: The user is redirected back to the DE.","text":"<p>After granting or denying authorization, the user is redirected to the URI specified in the <code>redirect_uri</code> parameter described above. There are two possibilities for this step: either the user granted or denied authorization.</p> <p>If the user granted authorization then two query parameters will be included in the request:</p> ParameterDescription code The authorization code provided by the OAuth server. state The same value that was sent to the authorization service. <p>In this case, a request is sent to Terrain so that an access token can be obtained.</p> <p>If the user denied authorization or an error occurred, then the response will contain at least two and, possibly up to four query parameters:</p> ParameterRequired error Yes An error code indicating what went wrong. error_description No A human-readable description of the error. error_uri No A link to a human-readable description of the error. state Yes The same value that was sent to the authorization service. <p>In this case, the user is redirected back to the main page in the DE along with some query parameters indicating that authorization was not obtained.</p> <p>This request is handled by a servlet that fields requests to any URI path that begins with the context path followed by <code>oauth/callback/</code>. There should be one additional path element: the name of the API. For example, assuming that the context path is <code>/de</code> and the API name is <code>agave</code>, the path in the request would be <code>/de/oauth/callback/agave</code>.</p>","path":["API Reference","Endpoints","Callback Endpoints"],"tags":[]},{"location":"services/api/endpoints/callbacks/#step-6-a-request-is-sent-to-the-access-code-service","level":3,"title":"Step 6: A request is sent to the access-code service.","text":"<p>This step only occurs if the user granted authorization to the DE. The servlet handling the redirection in the previous step extracts the API name from the URI path and the authorization code and state identifier from the query string.</p> <p>The API name is used to construct the URI path for the service request. For example, if the API name is <code>agave</code> then the URI path for the service request is <code>/secured/oauth/access-code/agave</code>. The query string parameters are passed to the service in the query string along with the usual CAS proxy token.</p>","path":["API Reference","Endpoints","Callback Endpoints"],"tags":[]},{"location":"services/api/endpoints/callbacks/#step-7-the-state-identifier-is-validated","level":3,"title":"Step 7: The state identifier is validated.","text":"<p>This step only occurs if the user granted authorization to the DE. The <code>/secured/oauth/access-code/{api-name}</code> service obtains the user information using the CAS proxy token and gets the state identifier from the query string. The state information is then retrieved from the database using the state identifier. If the state information isn't found or is associated with a different user, the service responds with an error status. Otherwise, the state information is removed from the database and the serivce proceeds to the next step.</p>","path":["API Reference","Endpoints","Callback Endpoints"],"tags":[]},{"location":"services/api/endpoints/callbacks/#step-8-the-service-requests-a-token-from-the-oauth-server","level":3,"title":"Step 8: The service requests a token from the OAuth server.","text":"<p>This step only occurs if the user granted authorization to the DE. The authorization code that was provided by the OAuth server is sent to the OAuth access token endpoint. This request includes four query parameters:</p> ParameterDescription grant_type Always set to \"authorization_code\". code The authorization code provided by the OAuth server. redirect_uri The same redirect URI sent to the authorization endpoint. client_id The API client identifier associated with the DE. <p>If the OAuth server responds with an error status then this service also responds with an error status. Otherwise, the response will contain the access token information.</p>","path":["API Reference","Endpoints","Callback Endpoints"],"tags":[]},{"location":"services/api/endpoints/callbacks/#step-9-the-service-stores-the-token-information-in-the-database","level":3,"title":"Step 9: The service stores the token information in the database.","text":"<p>This step only occurs if the user granted authorization and an access token was successfully obtained.</p> <p>The response from the OAuth server's token endpoint will contain the access token, the number of seconds until the token expires, and a refresh token that can be used to obtain a new access token when the current one expires. This information is stored in the database associated with the API name and the current user. After storing the token information, the service responds with a JSON object containing the state information that was stored in the database.</p>","path":["API Reference","Endpoints","Callback Endpoints"],"tags":[]},{"location":"services/api/endpoints/callbacks/#step-10-the-user-is-redirected-back-to-the-main-page-in-the-de","level":3,"title":"Step 10: The user is redirected back to the main page in the DE.","text":"<p>This step occurs whether or not authorization was obtained. If authorization was obtained the state information from the service call is passed to the main DE page in the query string. If authorization was not obtained then some query parameters indicating what went wrong are included in the query string.</p>","path":["API Reference","Endpoints","Callback Endpoints"],"tags":[]},{"location":"services/api/endpoints/comments/","level":1,"title":"Comment Endpoints","text":"<p>This document describes the comments resource.</p> <p>A comment is something that a user records about a given app, file, or folder.</p>","path":["API Reference","Endpoints","Comment Endpoints"],"tags":[]},{"location":"services/api/endpoints/comments/#comment-endpoints","level":1,"title":"Comment Endpoints","text":"","path":["API Reference","Endpoints","Comment Endpoints"],"tags":[]},{"location":"services/api/endpoints/comments/#creating-a-comment","level":2,"title":"Creating a comment","text":"<p><code>POST /apps/{app-id}/comments</code></p> <p>Delegates to metadata: <code>POST /apps/{app-id}/comments</code></p> <p><code>POST /secured/filesystem/entry/{entry-id}/comments</code></p> <p>Delegates to metadata: <code>POST /filesystem/entry/{entry-id}/comments</code></p> <p>This endpoint allows an authenticated user to post a comment on any app, accessible file, or accessible folder. <code>{app-id}</code> is the UUID of the app being commented on. <code>{entry-id}</code> is the UUID of the file or folder being commented on.</p> <p>These endpoints forward requests to their corresponding metadata service endpoints. Please see the metadata documentation for more information.</p>","path":["API Reference","Endpoints","Comment Endpoints"],"tags":[]},{"location":"services/api/endpoints/comments/#request","level":3,"title":"Request","text":"<p>A request to this endpoint requires no parameters. The user that owns the comment is determined from the authentication. Any query parameters will be ignored.</p>","path":["API Reference","Endpoints","Comment Endpoints"],"tags":[]},{"location":"services/api/endpoints/comments/#response","level":3,"title":"Response","text":"Status Code Cause 201 The comment was successfully posted 400 The request body wasn't syntactically correct 401 Either the authentication header was not provided, or its value wasn't correct. 404 From the <code>/apps/{app-id}/comments</code> endpoint, the <code>app-id</code> didn't correspond to an existing app. From the <code>/secured/filesystem/entry/{entry-id}/comments</code> endpoint, <code>entry-id</code> didn't correspond to an existing file or folder, or is not accessible by the user 413 The request body is too large <p>Error responses may include a <code>reason</code> field, providing a short, human readable explanation of the failure.</p>","path":["API Reference","Endpoints","Comment Endpoints"],"tags":[]},{"location":"services/api/endpoints/comments/#example","level":3,"title":"Example","text":"<p><pre><code>? curl -X POST -H \"$AUTH_HEADER\" -d '{ \"comment\" : \"That was interesting.\" }' localhost/secured/filesystem/entry/f86700ac-df88-11e3-bf3b-6abdce5a08d5/comments\n</code></pre> <pre><code>{\n  \"comment\" : {\n    \"id\"        : \"68a6a1f0-f745-11e3-b125-73dece2a6978\",\n    \"commenter\" : \"tedgin\",\n    \"post_time\" : 1403093431927,\n    \"retracted\" : false,\n    \"comment\"   : \"That was interesting.\"\n  }\n}\n</code></pre></p>","path":["API Reference","Endpoints","Comment Endpoints"],"tags":[]},{"location":"services/api/endpoints/comments/#listing-comments","level":2,"title":"Listing comments","text":"<p><code>GET /apps/{app-id}/comments</code></p> <p>Delegates to metadata: <code>GET /apps/{app-id}/comments</code></p> <p><code>GET /secured/filesystem/entry/{entry-id}/comments</code></p> <p>Delegates to metadata: <code>GET /filesystem/entry/{entry-id}/comments</code></p> <p>This endpoint allows an authenticated user to retrieve all of the comments made on an accessible file or folder, or any app. <code>{app-id}</code> is the UUID associated with the app. <code>entry-id</code> is the UUID associated with the file or folder.</p> <p>These endpoints forward requests to their corresponding metadata service endpoints. Please see the metadata documentation for more information.</p>","path":["API Reference","Endpoints","Comment Endpoints"],"tags":[]},{"location":"services/api/endpoints/comments/#request_1","level":3,"title":"Request","text":"<p>A request to this endpoint requires no parameters. The user that owns the comment is determined from the authentication. Any query parameters will be ignored.</p> <p>Any attached request body will be ignored.</p>","path":["API Reference","Endpoints","Comment Endpoints"],"tags":[]},{"location":"services/api/endpoints/comments/#response_1","level":3,"title":"Response","text":"Status Code Cause 200 The list of comments will be in the response body 401 Either the authentication header was not provided, or its value wasn't correct. 404 From the <code>/apps/{app-id}/comments</code> endpoint, the <code>app-id</code> didn't correspond to an existing app. From the <code>/secured/filesystem/entry/{entry-id}/comments</code> endpoint, <code>entry-id</code> didn't correspond to an existing file or folder, or is not accessible by the user <p>Upon failure, a JSON document with a <code>reason</code> field will the returned. The <code>reason</code> field will provide a short, human readable explanation of the failure.</p>","path":["API Reference","Endpoints","Comment Endpoints"],"tags":[]},{"location":"services/api/endpoints/comments/#example_1","level":3,"title":"Example","text":"<p><pre><code>? curl -H \"$AUTH_HEADER\" localhost/secured/filesystem/entry/f86700ac-df88-11e3-bf3b-6abdce5a08d5/comments\n</code></pre> <pre><code>{\n  \"comments\" : [\n    {\n      \"id\"        : \"68a6a1f0-f745-11e3-b125-73dece2a6978\",\n      \"commenter\" : \"tedgin\",\n      \"post_time\" : 1403093431927,\n      \"retracted\" : false,\n      \"comment\"   : \"That was interesting.\"\n    },\n    {\n      \"id\"        : \"79a6a1f0-0745-21e3-c125-73dece2a6989\",\n      \"commenter\" : \"fool\",\n      \"post_time\" : 1403093433001,\n      \"retracted\" : false,\n      \"comment\"   : \"No it wasn't.\"\n    }\n  ]\n}\n</code></pre></p>","path":["API Reference","Endpoints","Comment Endpoints"],"tags":[]},{"location":"services/api/endpoints/comments/#retractingreadmitting-a-comment","level":2,"title":"Retracting/Readmitting a comment","text":"<p><code>PATCH /apps/{app-id}/comments/{comment-id}</code></p> <p><code>PATCH /secured/filesystem/entry/{entry-id}/comments/{comment-id}</code></p> <p>Delegates to metadata:</p> <p><code>PATCH /apps/{app-id}/comments/{comment-id}</code></p> <p><code>PATCH /admin/apps/{app-id}/comments/{comment-id}</code></p> <p><code>PATCH /filesystem/entry/{entry-id}/comments/{comment-id}</code></p> <p><code>PATCH /admin/filesystem/entry/{entry-id}/comments/{comment-id}</code></p> <p>These endpoints allow an authenticated user to retract a given comment or to readmit a retracted comment on a given app, file, or folder. <code>app-id</code> is the UUID of the app. <code>entry-id</code> is the UUID of the file or folder. <code>comment-id</code> is the UUID of the comment.</p> <p>These endpoints forward requests to their corresponding metadata service endpoints. In the case that the user is the owner of the app, file, or folder, then the request is forwarded to the corresponding metadata service <code>/admin</code> endpoint. Please see the metadata documentation for more information.</p>","path":["API Reference","Endpoints","Comment Endpoints"],"tags":[]},{"location":"services/api/endpoints/comments/#request_2","level":3,"title":"Request","text":"<p>This endpoint requires a boolean <code>retracted</code> parameter.</p> <p>Any body attached to the request will be ignored.</p>","path":["API Reference","Endpoints","Comment Endpoints"],"tags":[]},{"location":"services/api/endpoints/comments/#response_2","level":3,"title":"Response","text":"Status Code Cause 200 The comment corresponding to the <code>comment-id</code> UUID has been marked as retracted. 400 The <code>retracted</code> parameter was missing or had a value other than <code>true</code> or <code>false</code>. 401 Either the authentication header was not provided, or its value wasn't correct. 403 See 403. 404 <code>comment-id</code> doesn't exist, <code>app-id</code> doesn't exist, or <code>entry-id</code> doesn't exist or isn't accessible by the user. 409 One of the query parameters was passed more than once with different values. <p>Error responses may include a <code>reason</code> field, providing a short, human readable explanation of the failure.</p>","path":["API Reference","Endpoints","Comment Endpoints"],"tags":[]},{"location":"services/api/endpoints/comments/#403","level":4,"title":"403","text":"<p>When a comment is being retracted, a 403 will result if the app, file, or folder is not owned by the user and the comment was not created by the user. When a comment is being readmitted, a 403 will result if the comment wasn't originally retracted by the user.</p>","path":["API Reference","Endpoints","Comment Endpoints"],"tags":[]},{"location":"services/api/endpoints/comments/#example_2","level":3,"title":"Example","text":"<pre><code>curl -X PATCH -H \"$AUTH_HEADER\" \"localhost/secured/filesystem/f86700ac-df88-11e3-bf3b-6abdce5a08d5/comments/79a6a1f0-0745-21e3-c125-73dece2a6989?retracted=true\"\n</code></pre>","path":["API Reference","Endpoints","Comment Endpoints"],"tags":[]},{"location":"services/api/endpoints/comments/#administratively-deleting-a-comment","level":2,"title":"Administratively deleting a comment","text":"<p><code>DELETE /admin/apps/{app-id}/comments/{comment-id}</code></p> <p>Delegates to metadata: <code>DELETE /admin/apps/{app-id}/comments/{comment-id}</code></p> <p><code>DELETE /admin/filesystem/entry/{entry-id}/comments/{comment-id}</code></p> <p>Delegates to metadata: <code>DELETE /admin/filesystem/entry/{entry-id}/comments/{comment-id}</code></p> <p>This endpoint allows an administrative user to delete a given comment on a given app, file, or folder. <code>comment-id</code> is the UUID of the comment. <code>app-id</code> is the UUID of the app. <code>entry-id</code> is the UUID of the file or folder.</p> <p>These endpoints forward requests to their corresponding metadata service endpoints. Please see the metadata documentation for more information.</p>","path":["API Reference","Endpoints","Comment Endpoints"],"tags":[]},{"location":"services/api/endpoints/comments/#request_3","level":3,"title":"Request","text":"<p>A request to this endpoint requires no parameters. Any query parameters that are provided will be ignored.</p> <p>Any body attached to the request will be ignored.</p>","path":["API Reference","Endpoints","Comment Endpoints"],"tags":[]},{"location":"services/api/endpoints/comments/#response_3","level":3,"title":"Response","text":"Status Code Cause 200 The comment corresponding to the <code>comment-id</code> UUID has been deleted. 401 Either the authentication header was not provided, or its value wasn't correct. 404 Either the app corresponding to <code>app-id</code> doesn't exist, the file or folder corresponding to <code>entry-id</code> doesn't exist, or the comment corresponding to <code>comment-id</code> doesn't. <p>Error responses may include a <code>reason</code> field, providing a short, human readable explanation of the failure.</p>","path":["API Reference","Endpoints","Comment Endpoints"],"tags":[]},{"location":"services/api/endpoints/comments/#example_3","level":3,"title":"Example","text":"<pre><code>curl -X DELETE -H \"$AUTH_HEADER\" \"localhost/admin/filesystem/entry/f86700ac-df88-11e3-bf3b-6abdce5a08d5/comments/79a6a1f0-0745-21e3-c125-73dece2a6989\"\n</code></pre>","path":["API Reference","Endpoints","Comment Endpoints"],"tags":[]},{"location":"services/api/endpoints/endpoints/","level":1,"title":"Terrain Endpoints","text":"<p>All URLs referenced in endpoint documentation are listed as relative URLs with value names enclosed in braces. For example, the service to get a list of workflow elements is accessed using the URL, <code>/get-workflow-elements/{element-type}</code>. Where <code>{element-type}</code> refers to the type of workflow element that is being retrieved. For example, to get a list of known property types, you can access the URL, <code>/get-workflow-elements/property-types</code>. On the other hand, all examples use fully qualified URLs.</p> <p>Request and response bodies are in JSON format unless otherwise noted.</p> <ul> <li> <p>App Metadata</p> </li> <li> <p>Callback</p> </li> <li> <p>Categorizing Apps with Ontology Hierarchies</p> </li> <li> <p>Comments</p> </li> <li> <p>Data Search</p> </li> <li> <p>Favorites</p> </li> <li> <p>Notification</p> </li> <li> <p>Permanent ID Requests</p> </li> <li> <p>Quick Launches</p> </li> <li> <p>Miscellaneous</p> </li> </ul>","path":["API Reference","Endpoints","Terrain Endpoints"],"tags":[]},{"location":"services/api/endpoints/favorites/","level":1,"title":"Resources","text":"<p>This document describes the favorites resource.</p> <p>A favorite is something that a user has decided is important enough that it should be more readily accessible than other resources of the same time.</p>","path":["API Reference","Endpoints","Resources"],"tags":[]},{"location":"services/api/endpoints/favorites/#resources","level":1,"title":"Resources","text":"","path":["API Reference","Endpoints","Resources"],"tags":[]},{"location":"services/api/endpoints/favorites/#favorite","level":2,"title":"Favorite","text":"<p>A favorite is modeled as a UUID having the same value has the important resource's UUID.</p> <p>Example</p> <pre><code>f86700ac-df88-11e3-bf3b-6abdce5a08d1\n</code></pre>","path":["API Reference","Endpoints","Resources"],"tags":[]},{"location":"services/api/endpoints/favorites/#data-id-collection","level":2,"title":"Data Id Collection","text":"<p>A collection of data Ids is its own resource. It is a JSON document (media type <code>application/json</code>) with a single <code>filesystem</code> field that holds an array of UUIDs, each for a file or folder.</p> <p>Example</p> <pre><code>{\n  \"filesystem\" : [\n    \"f86700ac-df88-11e3-bf3b-6abdce5a08d1\",\n    \"9cdb9492-f288-11e3-ab3e-13be1320bb50\"\n  ]\n}\n</code></pre>","path":["API Reference","Endpoints","Resources"],"tags":[]},{"location":"services/api/endpoints/favorites/#favorite-data-collection","level":2,"title":"Favorite Data Collection","text":"<p>A collection of favorite data or filesystem entities is its own resource. It is a JSON document (media type <code>application/json</code>) with the following fields.</p> Field Type Description files array an array of favorite file objects folders array an array of favorite folder objects total number the total number of favorite files and folders for a given authenticated user","path":["API Reference","Endpoints","Resources"],"tags":[]},{"location":"services/api/endpoints/favorites/#favorite-file-object","level":3,"title":"Favorite File Object","text":"<p>A favorite file object has the following fields.</p> Field Type Description date-created number the time when the file was created in ms since the POSIX epoch date-modified number the time when the file was last modified in ms since the POSIX epoch file-size number the size in bytes of the file id string the absolute path to the file infoType string the semantic type of the content of the file isFavorite boolean <code>true</code> label string the name of file relative to its containing folder mime-type string the media type of the file path string the absolute path to the file permission string the permission the authenticated user has on the file, <code>\"read\"|\"write\"|\"own\"</code> share-count number the number of other users this file has been shared with type string <code>\"file\"</code> uuid string the file's UUID","path":["API Reference","Endpoints","Resources"],"tags":[]},{"location":"services/api/endpoints/favorites/#favorite-folder-object","level":3,"title":"Favorite Folder Object","text":"<p>A favorite folder object has the following fields.</p> Field Type Description date-created number the time when the folder was created in ms since the POSIX epoch date-modified number the time when the folder was last modified (i.e. had a member file or folder added or removed) in ms since the POSIX epoch dir-count number the number of member folders file-count number the number of member files file-size number <code>0</code> id string the absolute path to the folder isFavorite boolean <code>true</code> label string the name of folder relative to its containing folder path string the absolute path to the folder permission string the permission the authenticated user has on the folder, <code>\"read\"|\"write\"|\"own\"</code> share-count number the number of other users this folder has been shared with type string <code>\"dir\"</code> uuid string the folder's UUID","path":["API Reference","Endpoints","Resources"],"tags":[]},{"location":"services/api/endpoints/favorites/#endpoints","level":1,"title":"Endpoints","text":"","path":["API Reference","Endpoints","Resources"],"tags":[]},{"location":"services/api/endpoints/favorites/#marking-a-data-resource-as-favorite","level":2,"title":"Marking a Data Resource as Favorite","text":"<p><code>PUT /secured/favorites/filesystem/{favorite}</code></p> <p>Delegates to metadata: <code>PUT /favorites/filesystem/{favorite}</code></p> <p>This endpoint marks a given file or folder a favorite of the authenticated user. <code>{favorite}</code> is the UUID of the file or folder being marked.</p> <p>This endpoint forwards requests to the corresponding metadata service endpoint. Please see the metadata documentation for more information.</p>","path":["API Reference","Endpoints","Resources"],"tags":[]},{"location":"services/api/endpoints/favorites/#request","level":3,"title":"Request","text":"<p>A request to this endpoint requires no parameters. The user that owns the favorite is determined from the authentication. Any query parameters will be ignored.</p> <p>Any body attached to the request will be ignored.</p>","path":["API Reference","Endpoints","Resources"],"tags":[]},{"location":"services/api/endpoints/favorites/#response","level":3,"title":"Response","text":"Status Code Cause 200 The file or folder corresponding to the <code>&lt;favorite&gt;</code> UUID has been marked as a favorite of the authenticated user. 401 Either the authentication header was not provided, or its value wasn't correct. 404 The <code>{favorite}</code> UUID doesn't belong to a known file or folder or the file or folder isn't readable by the authenticated user. <p>Error responses may contain a <code>\"reason\"</code> field, providing a short, human readable explanation of the failure.</p>","path":["API Reference","Endpoints","Resources"],"tags":[]},{"location":"services/api/endpoints/favorites/#example","level":3,"title":"Example","text":"<pre><code>? curl -XPUT -H \"$AUTH_HEADER\" localhost/secured/favorites/filesystem/f86700ac-df88-11e3-bf3b-6abdce5a08d1\n</code></pre>","path":["API Reference","Endpoints","Resources"],"tags":[]},{"location":"services/api/endpoints/favorites/#removing-a-data-resource-from-being-a-favorite","level":2,"title":"Removing a Data Resource from Being a Favorite","text":"<p><code>DELETE /secured/favorites/filesystem/{favorite}</code></p> <p>Delegates to metadata: <code>DELETE /favorites/filesystem/{favorite}</code></p> <p>This endpoint removes a given file or folder from the authenticated user's favorites. <code>&lt;favorite&gt;</code> is the UUID of the file or folder.</p> <p>This endpoint forwards requests to the corresponding metadata service endpoint. Please see the metadata documentation for more information.</p>","path":["API Reference","Endpoints","Resources"],"tags":[]},{"location":"services/api/endpoints/favorites/#request_1","level":3,"title":"Request","text":"<p>A request to this endpoint requires no parameters. The user that owns the favorite is determined from the authentication. Any query parameters will be ignored.</p> <p>Any body attached to the request will be ignored.</p>","path":["API Reference","Endpoints","Resources"],"tags":[]},{"location":"services/api/endpoints/favorites/#response_1","level":3,"title":"Response","text":"Status Code Cause 200 The file or folder corresponding to the <code>favorite</code> UUID has been marked as a favorite of the authenticated user. 401 Either the authentication header was not provided, or its value wasn't correct. 404 The file or folder corresponding to the <code>favorite</code> UUID wasn't marked as a favorite. <p>Error responses may include a <code>reason</code> field, providing a short, human readable explanation of the failure.</p>","path":["API Reference","Endpoints","Resources"],"tags":[]},{"location":"services/api/endpoints/favorites/#example_1","level":3,"title":"Example","text":"<pre><code>? curl -H \"$AUTH_HEADER\" -XDELETE localhost/secured/favorites/filesystem/f86700ac-df88-11e3-bf3b-6abdce5a08d1\n</code></pre>","path":["API Reference","Endpoints","Resources"],"tags":[]},{"location":"services/api/endpoints/favorites/#listing-stat-info-for-favorite-data","level":3,"title":"Listing Stat Info for Favorite Data","text":"<p><code>GET /secured/favorites/filesystem</code></p> <p>Requires metadata endpoint: <code>GET /favorites/filesystem</code></p> <p>This endpoint lists stat information for the authenticated user's favorite files and folders. Only files and folders accessible to the user will be listed. The result set is paged.</p> <p>This endpoint fetches favorite information from the corresponding metadata service endpoint before applying filters, sorting, and additional stat information. Please see the metadata documentation for more information.</p>","path":["API Reference","Endpoints","Resources"],"tags":[]},{"location":"services/api/endpoints/favorites/#request_2","level":3,"title":"Request","text":"<p>A request to this endpoint requires the parameters in the following table.</p> Parameter Required? Default Description sort-col yes the field used to sort the filesystem entries in the result set. This can be <code>NAME|ID|LASTMODIFIED|DATECREATED|SIZE</code>. All values are case insensitive. sort-dir yes the sorting direction. It can be <code>ASC|DESC</code>. Both values are case insensitive. limit yes the maximum number of filesystem entries to return offset yes the number entries in the sorted total result set to skip before including entries in the response document. entity-type no ANY the type of entities to return. It can be <code>ANY|FILE|FOLDER</code>. All values are case-insensitive. info-type no no filtering filter the files portion of the result set so that only files with this info type are returned. To return multiple info types, and this parameter more than once. <p>Any additional parameters will be ignored.</p> <p>Any body attached to the request will be ignored.</p>","path":["API Reference","Endpoints","Resources"],"tags":[]},{"location":"services/api/endpoints/favorites/#response_2","level":3,"title":"Response","text":"Status Code Cause 200 The list of stat info was obtained and is included in the response body. 400 one of the parameters was missing or had a nonsensical value. 401 Either the authentication header was not provided, or its value wasn't correct. <p>Upon success, the response body will be a data collection JSON document containing the stat information of the favorite files and folders.</p> <p>Error responses may include a <code>reason</code> field, providing a short, human readable explanation of the failure.</p>","path":["API Reference","Endpoints","Resources"],"tags":[]},{"location":"services/api/endpoints/favorites/#example_2","level":3,"title":"Example","text":"<p><pre><code>? curl -H \"$AUTH_HEADER\" \"localhost/secured/favorites/filesystem/favorites?sort-col=ID&amp;sort-dir=ASC&amp;limit=1&amp;offset=0\"\n</code></pre> <pre><code>{\n    \"filesystem\": {\n        \"files\": [],\n        \"folders\": [\n            {\n                \"date-created\": 1.397233899e+12,\n                \"date-modified\": 1.397233899e+12,\n                \"dir-count\": 256,\n                \"file-count\": 0,\n                \"id\": \"/iplant/home/wregglej/analyses\",\n                \"isFavorite\": true,\n                \"label\": \"analyses\",\n                \"path\": \"/iplant/home/wregglej/analyses\",\n                \"permission\": \"own\",\n                \"share-count\": 1,\n                \"type\": \"dir\",\n                \"uuid\": \"0d880c78-df8a-11e3-bfa5-6abdce5a08d5\"\n            }\n        ],\n        \"total\": 3\n    }\n}\n</code></pre></p>","path":["API Reference","Endpoints","Resources"],"tags":[]},{"location":"services/api/endpoints/favorites/#filter-a-set-of-resources-for-favorites","level":2,"title":"Filter a Set of Resources for Favorites","text":"<p><code>POST /secured/favorites/filter</code></p> <p>Delegates to metadata: <code>POST /favorites/filter</code></p> <p>This endpoint forwards requests to the corresponding metadata service endpoint. Please see the metadata documentation for more information.</p> <p>This endpoint fetches the filtered favorite IDs from the corresponding metadata service endpoint before further filtering only UUIDs for files and folders accessible to the user.</p>","path":["API Reference","Endpoints","Resources"],"tags":[]},{"location":"services/api/endpoints/favorites/#request_3","level":3,"title":"Request","text":"<p>A request to this endpoint requires no parameters. The user that owns the favorite is determined from the authentication. Any query parameters will be ignored.</p>","path":["API Reference","Endpoints","Resources"],"tags":[]},{"location":"services/api/endpoints/favorites/#response_3","level":3,"title":"Response","text":"Status Code Cause 200 The filtered list of UUIDs was generated and is included in the response body. 400 The request body wasn't a syntactically correct data id collection. 401 Either the authentication header was not provided, or its value wasn't correct. <p>Upon success, the response body will be a data id collection JSON document containing the UUIDs from the request body that correspond to favorite files and folders of the user.</p> <p>Error responses may include a <code>reason</code> field, providing a short, human readable explanation of the failure.</p>","path":["API Reference","Endpoints","Resources"],"tags":[]},{"location":"services/api/endpoints/favorites/#example_3","level":3,"title":"Example","text":"<p><pre><code>? curl -XPOST -H \"$AUTH_HEADER\" -d '\n    {\n      \"filesystem\" : [\n        \"f86700ac-df88-11e3-bf3b-6abdce5a08d1\",\n        \"f86700ac-df88-11e3-bf3b-6abdce5a08d5\"\n      ]\n    }' localhost/secured/favorites/filter\n</code></pre> <pre><code>{\n  \"filesystem\" : [\n    \"f86700ac-df88-11e3-bf3b-6abdce5a08d1\"\n  ]\n}\n</code></pre></p>","path":["API Reference","Endpoints","Resources"],"tags":[]},{"location":"services/api/endpoints/fileio/","level":1,"title":"File IO","text":"<p>Provides a REST-like API for uploading and downloading files to and from iRODS.</p>","path":["API Reference","Endpoints","File IO"],"tags":[]},{"location":"services/api/endpoints/fileio/#error-handling","level":2,"title":"Error handling","text":"<p>If you try to hit an endpoint that doesn't exist, you'll get a 404.</p> <p>For all other errors, you should receive a 500 HTTP status code and a JSON body in the following format:</p> <pre><code>    {\n        \"error_code\" : \"&lt;Scruffian error code&gt;\"\n    }\n</code></pre> <p>Most errors will return other contextual fields, but they will vary from error to error. For programmatic usage, only depend on the three fields listed above.</p> <p>Each section listed below lists the error codes that you may encounter. In addition to these, you may run into the ERR_UNCHECKED_EXCEPTION, which means that an uncaught exception was encountered.</p>","path":["API Reference","Endpoints","File IO"],"tags":[]},{"location":"services/api/endpoints/fileio/#downloading","level":2,"title":"Downloading","text":"<p>URL Path: /secured/fileio/download</p> <p>HTTP Method: GET</p> <p>URL Path: /secured/filesystem/display-download</p> <p>HTTP Method: GET</p> <p>Request Query Parameters:</p> <ul> <li>path - The path to the file in iRODS to be downloaded.</li> </ul> <p>Error Codes:</p> <ul> <li>ERR_INVALID_JSON (wrong content-type or JSON syntax errors)</li> <li>ERR_BAD_OR_MISSING_FIELD (JSON field is missing or has an invalid value)</li> <li>ERR_MISSING_QUERY_PARAMETER (Query parameter is missing)</li> <li>ERR_NOT_A_USER (invalid user specified)</li> <li>ERR_DOES_NOT_EXIST (File request doesn't exist)</li> <li>ERR_NOT_READABLE (File requested isn't readable by the specified user)</li> </ul> <p>Curl Command:</p> <pre><code>curl -H \"$AUTH_HEADER\" 'http://127.0.0.1:31370/secured/fileio/download?path=/iplant/home/testuser/myfile.txt'\n</code></pre> <p>This will result is the file contents being printed out to stdout. Redirect to a file to actually get the file.</p> <p>When using fileio/download, it's always downloaded as an attachment and the content-type is always application/octet-stream. When using display-download, attachment is a parameter that can be passed along.</p> <p>These endpoints delegate to data-info's GET /data/path/:zone/:path endpoint, with some processing.</p>","path":["API Reference","Endpoints","File IO"],"tags":[]},{"location":"services/api/endpoints/fileio/#uploading","level":2,"title":"Uploading","text":"<p>URL Path: /secured/fileio/upload</p> <p>HTTP Method: POST</p> <p>Request Query Parameters:</p> <ul> <li>dest - The path to the iRODS folder where the file(s) will be uploaded.</li> </ul> <p>Request Form Fields:</p> <ul> <li>file - The contents of the file to be uploaded.</li> </ul> <p>Error Codes:</p> <ul> <li>ERR_MISSING_FORM_FIELD (One of the form data fields is missing)</li> <li>ERR_MISSING_QUERY_PARAMETER (Query parameter is missing)</li> <li>ERR_NOT_A_USER (Invalid user specified)</li> <li>ERR_DOES_NOT_EXIST (Destination directory doesn't exist)</li> <li>ERR_NOT_WRITEABLE (Destination directory isn't writeable)</li> </ul> <p>Response Body:</p> <p>A success will return JSON like this:</p> <pre><code>{\n    \"file\": {\n        \"id\": \"&lt;path to the file&gt;\",\n        \"path\": \"&lt;path to the file&gt;\",\n        \"label\": \"&lt;basename of the file path&gt;\",\n        \"permission\": \"own\",\n        \"date-created\": &lt;seconds since the epoch&gt;,\n        \"date-modified\": &lt;seconds since the epoch&gt;,\n        \"file-size\": &lt;size in bytes&gt;\n    }\n}\n</code></pre> <p>Curl Command:</p> <p>Uploading is handled through multipart requests:</p> <pre><code>curl -H \"$AUTH_HEADER\" -F file=@testfile.txt \"localhost:31325/secured/fileio/upload?dest=/iplant/home/testuser\"\n</code></pre> <p>Notice that the <code>dest</code> value points to a directory and not a file.</p> <p>This endpoint delegates to data-info's POST /data endpoint.</p>","path":["API Reference","Endpoints","File IO"],"tags":[]},{"location":"services/api/endpoints/fileio/#url-uploads","level":2,"title":"URL Uploads","text":"<p>URL Path: /secured/fileio/urlupload</p> <p>HTTP Method: POST</p> <p>Error codes:</p> <ul> <li>ERR_INVALID_JSON (Missing content-type or JSON syntax error)</li> <li>ERR_BAD_OR_MISSING_FIELD (Missing JSON field or invalid JSON field value)</li> <li>ERR_MISSING_QUERY_PARAMETER (One of the query parameters is missing)</li> <li>ERR_NOT_A_USER (Invalid user specified)</li> <li>ERR_NOT_WRITEABLE (Destination directory isn't writeable by the specified user)</li> <li>ERR_EXISTS (Destination file already exists)</li> <li>ERR_REQUEST_FAILED (General failure to spawn upload thread)</li> <li>ERR_INVALID_URL (URL that was passed in couldn't be used)</li> </ul> <p>Request Query Parameters:</p> <p>Request Body:</p> <pre><code>{\n    \"dest\" : \"/iplant/home/testuser/\",\n    \"address\" : \"http://www.google.com/index.html\"\n}\n</code></pre> <p>Response Body:</p> <p>On success you should get JSON that looks like this:</p> <pre><code>{\n    \"msg\" : \"Upload scheduled.\",\n    \"url\" : \"&lt;URL&gt;\",\n    \"label\" : \"&lt;URL base filename&gt;\",\n    \"dest\" : \"&lt;destination in irods&gt;\"\n}\n</code></pre> <p>On on error, you'll either get a stacktrace or JSON that looks like this:</p> <pre><code>{\n    \"msg\" : \"&lt;JSON passed in through the request&gt;\",\n    \"error_code\" : \"ERR_REQUEST_FAILED\"\n}\n</code></pre> <p>If the URL passed in is incorrect, then the error message will look like this:</p> <pre><code>{\n    \"error_code\" : \"ERR_INVALID_URL\",\n    \"url\" : \"&lt;URL Passed in&gt;\"\n}\n</code></pre> <p>Curl Command:</p> <pre><code>curl -H \"$AUTH_HEADER\" -d '{\"dest\" : \"/iplant/home/testuser/\", \"address\" : \"http://www.google.com/index.html\"}' http://127.0.0.1:31370/secured/fileio/urlupload\n</code></pre> <p>The 'dest' value in the JSON refers to the path to the directory in iRODS that the file will be saved off to. The filename of the file will be extracted from the path portion of the URL.</p>","path":["API Reference","Endpoints","File IO"],"tags":[]},{"location":"services/api/endpoints/fileio/#save","level":2,"title":"Save","text":"<p>URL Path: /secured/fileio/save</p> <p>HTTP Method: POST</p> <p>Error Codes:</p> <ul> <li>ERR_INVALID_JSON (Missing content-type or JSON syntax error)</li> <li>ERR_BAD_OR_MISSING_FIELD (Missing JSON field or invalid JSON field value)</li> <li>ERR_NOT_A_USER (Invalid user specified)</li> <li>ERR_DOES_NOT_EXIST (The destination directory does not exist)</li> <li>ERR_NOT_WRITEABLE (The destination directory is not writable by the user)</li> <li>ERR_FILE_SIZE_TOO_LARGE (The size of the \"content\" field is larger than the terrain.fileio.max-edit-file-size config setting)</li> </ul> <p>Request Body:</p> <pre><code>    {\n        \"content\" : \"This is the content for the file.\",\n        \"dest\" : \"/iplant/home/testuser/savedfile.txt\"\n    }\n</code></pre> <p>Response Body:</p> <pre><code>{\n    \"file\": {\n        \"id\": \"&lt;path to the file&gt;\",\n        \"path\": \"&lt;path to the file&gt;\",\n        \"label\": \"&lt;basename of the file path&gt;\",\n        \"permission\": \"own\",\n        \"date-created\": &lt;seconds since the epoch&gt;,\n        \"date-modified\": &lt;seconds since the epoch&gt;,\n        \"file-size\": &lt;size in bytes&gt;\n    }\n}\n</code></pre> <p>Curl Command:</p> <pre><code>curl -H \"$AUTH_HEADER\" -d '{\"dest\" : \"/iplant/home/testuser/savedfile.txt\", \"content\" : \"This is the content for the file.\"}' 'http://127.0.0.1:31370/secured/fileio/save'\n</code></pre>","path":["API Reference","Endpoints","File IO"],"tags":[]},{"location":"services/api/endpoints/fileio/#save-as","level":2,"title":"Save As","text":"<p>URL Path: /secured/fileio/saveas</p> <p>HTTP Method: POST</p> <p>Error Codes:</p> <ul> <li>ERR_INVALID_JSON (Missing content-type or JSON syntax error)</li> <li>ERR_BAD_OR_MISSING_FIELD (Missing JSON field or invalid JSON field value)</li> <li>ERR_NOT_A_USER (Invalid user specified)</li> <li>ERR_DOES_NOT_EXIST (The destination directory does not exist)</li> <li>ERR_NOT_WRITEABLE (The destination directory is not writable by the user)</li> <li>ERR_EXISTS (The destination file already exists)</li> </ul> <p>Request Body:</p> <pre><code>    {\n        \"content\" : \"This is the content for the file.\",\n        \"dest\" : \"/iplant/home/testuser/savedfile.txt\"\n    }\n</code></pre> <p>Response Body:</p> <pre><code>{\n    \"file\": {\n        \"id\": \"&lt;path to the file&gt;\",\n        \"path\": \"&lt;path to the file&gt;\",\n        \"label\": \"&lt;basename of the file path&gt;\",\n        \"permission\": \"own\",\n        \"date-created\": &lt;seconds since the epoch&gt;,\n        \"date-modified\": &lt;seconds since the epoch&gt;,\n        \"file-size\": &lt;size in bytes&gt;\n    }\n}\n</code></pre> <p>Curl Command:</p> <pre><code>curl -H \"$AUTH_HEADER\" -d '{\"content\" : \"This is the content for the file.\", \"dest\" : \"/iplant/home/testuser/savedfile.txt\"}' 'http://127.0.0.1:31370/secured/fileio/saveas'\n</code></pre> <p>This endpoint delegates to data-info's POST /data endpoint, similarly to the upload endpoint, with some processing.</p>","path":["API Reference","Endpoints","File IO"],"tags":[]},{"location":"services/api/endpoints/misc/","level":1,"title":"Miscellaneous Terrain Endpoints","text":"<p>Jump to:</p> <ul> <li> <p>Miscellaneous Terrain Endpoints</p> </li> <li> <p>Verifying that Terrain is Running</p> </li> <li> <p>Saving User Session Data</p> </li> <li> <p>Retrieving User Session Data</p> </li> <li> <p>Removing User Session Data</p> </li> <li> <p>Saving User Preferences</p> </li> <li> <p>Retrieving User Preferences</p> </li> <li> <p>Removing User Preferences</p> </li> <li> <p>Obtaining Identifiers</p> </li> </ul>","path":["API Reference","Endpoints","Miscellaneous Terrain Endpoints"],"tags":[]},{"location":"services/api/endpoints/misc/#miscellaneous-terrain-endpoints","level":1,"title":"Miscellaneous Terrain Endpoints","text":"<p>Note that secured endpoints in Terrain and apps are a little different from each other. Please see Terrain Vs. Apps for more information.</p>","path":["API Reference","Endpoints","Miscellaneous Terrain Endpoints"],"tags":[]},{"location":"services/api/endpoints/misc/#verifying-that-terrain-is-running","level":2,"title":"Verifying that Terrain is Running","text":"<p>Unsecured Endpoint: GET /</p> <p>The root path in Terrain can be used to verify that Terrain is actually running and is responding. Currently, the response to this URL contains only a welcome message. Here's an example:</p> <pre><code>$ curl -s http://by-tor:8888/\nThe infinite is attainable with Terrain!\n</code></pre>","path":["API Reference","Endpoints","Miscellaneous Terrain Endpoints"],"tags":[]},{"location":"services/api/endpoints/misc/#saving-user-session-data","level":2,"title":"Saving User Session Data","text":"<p>Secured Endpoint: POST /secured/sessions</p> <p>This service can be used to save arbitrary JSON user session information. The post body is stored as-is and can be retrieved by sending an HTTP GET request to the same URL.</p> <p>Here's an example:</p> <pre><code>$ curl -sH \"$AUTH_HEADER\" -d '{\"foo\":\"bar\"}' \"http://by-tor:8888/secured/sessions\"\n</code></pre>","path":["API Reference","Endpoints","Miscellaneous Terrain Endpoints"],"tags":[]},{"location":"services/api/endpoints/misc/#retrieving-user-session-data","level":2,"title":"Retrieving User Session Data","text":"<p>Secured Endpoint: GET /secured/sessions</p> <p>This service can be used to retrieve user session information that was previously saved by sending a POST request to the same service.</p> <p>Here's an example:</p> <pre><code>$ curl -H \"$AUTH_HEADER\" \"http://by-tor:8888/secured/sessions\"\n{\"foo\":\"bar\"}\n</code></pre>","path":["API Reference","Endpoints","Miscellaneous Terrain Endpoints"],"tags":[]},{"location":"services/api/endpoints/misc/#removing-user-session-data","level":2,"title":"Removing User Session Data","text":"<p>Secured Endpoint: DELETE /secured/sessions</p> <p>This service can be used to remove saved user session information. This is helpful in cases where the user's session is in an unusable state and saving the session information keeps all of the user's future sessions in an unusable state.</p> <p>Here's an example:</p> <pre><code>$ curl -XDELETE -H \"$AUTH_HEADER\" \"http://by-tor:8888/secured/sessions\"\n</code></pre> <p>Check the HTTP status of the response to tell if it succeeded. It should return a status in the 200 range.</p> <p>An attempt to remove session data that doesn't already exist will be silently ignored and return a 200 range HTTP status code.</p>","path":["API Reference","Endpoints","Miscellaneous Terrain Endpoints"],"tags":[]},{"location":"services/api/endpoints/misc/#saving-user-preferences","level":2,"title":"Saving User Preferences","text":"<p>Secured Endpoint: POST /secured/preferences</p> <p>This service can be used to save arbitrary user preferences. The body must contain all of the preferences for the user; any key-value pairs that are missing will be removed from the preferences. Please note that the \"defaultOutputDir\" and the \"systemDefaultOutputDir\" will always be present, even if not included in the JSON passed in.</p> <p>Example:</p> <pre><code>$ curl -sH \"$AUTH_HEADER\" -d '{\"appsKBShortcut\":\"A\",\"rememberLastPath\":true,\"closeKBShortcut\":\"Q\",\"defaultOutputFolder\":{\"id\":\"/iplant/home/wregglej/analyses\",\"path\":\"/iplant/home/wregglej/analyses\"},\"dataKBShortcut\":\"D\",\"systemDefaultOutputDir\":{\"id\":\"/iplant/home/wregglej/analyses\",\"path\":\"/iplant/home/wregglej/analyses\"},\"saveSession\":true,\"enableEmailNotification\":true,\"lastPathId\":\"/iplant/home/wregglej\",\"notificationKBShortcut\":\"N\",\"defaultFileSelectorPath\":\"/iplant/home/wregglej\",\"analysisKBShortcut\":\"Y\"}' \"http://by-tor:8888/secured/preferences\" | squiggles\n{\n    \"preferences\": {\n        \"analysisKBShortcut\": \"Y\",\n        \"appsKBShortcut\": \"A\",\n        \"closeKBShortcut\": \"Q\",\n        \"dataKBShortcut\": \"D\",\n        \"defaultFileSelectorPath\": \"/iplant/home/wregglej\",\n        \"defaultOutputFolder\": {\n            \"id\": \"/iplant/home/wregglej/analyses\",\n            \"path\": \"/iplant/home/wregglej/analyses\"\n        },\n        \"enableEmailNotification\": true,\n        \"lastPathId\": \"/iplant/home/wregglej\",\n        \"notificationKBShortcut\": \"N\",\n        \"rememberLastPath\": true,\n        \"saveSession\": true,\n        \"systemDefaultOutputDir\": {\n            \"id\": \"/iplant/home/wregglej/analyses\",\n            \"path\": \"/iplant/home/wregglej/analyses\"\n        }\n    }\n}\n</code></pre>","path":["API Reference","Endpoints","Miscellaneous Terrain Endpoints"],"tags":[]},{"location":"services/api/endpoints/misc/#retrieving-user-preferences","level":2,"title":"Retrieving User Preferences","text":"<p>Secured Endpoint: GET /secured/preferences</p> <p>This service can be used to retrieve a user's preferences.</p> <p>Example:</p> <pre><code>$ curl -sH \"$AUTH_HEADER\" \"http://by-tor:8888/secured/preferences\" | squiggles\n{\n    \"analysisKBShortcut\": \"Y\",\n    \"appsKBShortcut\": \"A\",\n    \"closeKBShortcut\": \"Q\",\n    \"dataKBShortcut\": \"D\",\n    \"defaultFileSelectorPath\": \"/iplant/home/test\",\n    \"defaultOutputFolder\": {\n        \"id\": \"/iplant/home/test/analyses\",\n        \"path\": \"/iplant/home/test/analyses\"\n    },\n    \"enableEmailNotification\": true,\n    \"lastPathId\": \"/iplant/home/test\",\n    \"notificationKBShortcut\": \"N\",\n    \"rememberLastPath\": true,\n    \"saveSession\": true,\n    \"systemDefaultOutputDir\": {\n        \"id\": \"/iplant/home/test/analyses\",\n        \"path\": \"/iplant/home/test/analyses\"\n    }\n}\n</code></pre>","path":["API Reference","Endpoints","Miscellaneous Terrain Endpoints"],"tags":[]},{"location":"services/api/endpoints/misc/#removing-user-preferences","level":2,"title":"Removing User Preferences","text":"<p>Secured Endpoint: DELETE /secured/preferences</p> <p>This service can be used to remove a user's preferences.</p> <p>Please note that the \"defaultOutputDir\" and the \"systemDefaultOutputDir\" will still be present in the preferences after a deletion.</p> <p>Example:</p> <pre><code>$ curl -X DELETE -H \"$AUTH_HEADER\" \"http://by-tor:8888/secured/preferences\"\n</code></pre> <p>Check the HTTP status code of the response to determine success. It should be in the 200 range.</p> <p>An attempt to remove preference data that doesn't already exist will be silently ignored.</p>","path":["API Reference","Endpoints","Miscellaneous Terrain Endpoints"],"tags":[]},{"location":"services/api/endpoints/misc/#obtaining-identifiers","level":2,"title":"Obtaining Identifiers","text":"<p>Unsecured Endpoint: GET /uuid</p> <p>In some cases, it's difficult for the UI client code to generate UUIDs for objects that require them. This service returns a single UUID in the response body. The UUID is returned as a plain text string.</p>","path":["API Reference","Endpoints","Miscellaneous Terrain Endpoints"],"tags":[]},{"location":"services/api/endpoints/notifications/","level":1,"title":"Notification Endpoints","text":"<p>Jump to:</p> <ul> <li> <p>Notification Endpoints</p> </li> <li> <p>Obtaining Notifications</p> </li> <li> <p>Obtaining Notification Counts</p> </li> <li> <p>Obtaining Unseen Notifications</p> </li> <li> <p>Obtaining the Ten Most Recent Notifications</p> </li> <li> <p>Marking Notifications as Seen</p> </li> <li> <p>Marking All Notifications as Seen</p> </li> <li> <p>Marking Notifications as Deleted</p> </li> <li> <p>Marking All Notifications as Deleted</p> </li> <li> <p>Sending an Arbitrary Notification</p> </li> <li> <p>Endpoints for System Messages (a.k.a. System Notifications)</p> </li> </ul>","path":["API Reference","Endpoints","Notification Endpoints"],"tags":[]},{"location":"services/api/endpoints/notifications/#notification-endpoints","level":1,"title":"Notification Endpoints","text":"","path":["API Reference","Endpoints","Notification Endpoints"],"tags":[]},{"location":"services/api/endpoints/notifications/#obtaining-notifications","level":2,"title":"Obtaining Notifications","text":"<p>Secured Endpoint: GET /secured/notifications/messages</p> <p>This endpoint is primarily a passthrough endpoint to the notification agent's <code>/messages</code> endpoint, but it does make calls into the apps service in order to add the app description to job status update notifications.</p> <p>Notifications in the DE are used to inform users when some event (for example a job status change or the completion of a file upload) has occurred. This service provides a way for the DE to retrieve notifications that the user may or may not have seen before. This service accepts five different query-string parameters:</p> NameDescriptionRequired/Optional limit                  The maximum number of notifications to return at a time or `0`                 if there is no limit.              Optional (defaults to `0`) offset The index of the starting message. Optional (defaults to `0`) seen                  Indicates whether messages that the user has seen, messages that                 the user has not seen, or both should be returned. If this                 parameter is equal to `true` then only messages that the user                 has seen will be returned. If it is equal to `false` then only                 messages that the user has not seen will be returned. If this                 parameter is not specified at all then both messages that have                 been seen and messages that have not been seen will be returned.              Optional sortField                  The field to use when sorting messages. Currently, the only                 supported value for this field is `timestamp`.              Optional (defaults to `timestamp`) sortDir                  The sorting direction, which can be `asc` (ascending) or `desc`                 (descending).              Optional (defaults to `desc`) filter                  Specifies the type of notification messages to return, which can                 be `data`, `analysis` or `tool`. Other types of notifications                 may be added in the future. If this parameter it not specified                 then all types of notifications will be returned.              Optional <p>The response body for this service is in the following format:</p> <pre><code>{\n    \"messages\": [\n        {\n            \"deleted\": \"deleted-flag\",\n            \"message\": {\n                \"id\": \"message-id\",\n                \"text\": \"message-text\",\n                \"timestamp\": \"milliseconds-since-epoch\",\n            }\n            \"outputDir\": \"output-directory-path\",\n            \"outputManifest\": \"list-of-output-files\",\n            \"payload\": {}\n            \"seen\": \"seen-flag\",\n            \"type\": \"notification-type-code\",\n            \"user\": \"username\"\n        },\n    ],\n    \"total\": \"message-count\"\n}\n</code></pre> <p>The payload object in each message is a JSON object with a format that is specific to the notification type, and its format will vary. There are currently three types of notifications that we support: <code>data</code>, <code>analysis</code> and <code>tool</code>. The <code>data</code> and <code>analysis</code> notification types have the same payload format:</p> <pre><code>{\n    \"action\": \"action-code\",\n    \"analysis-details\": \"analysis-description\",\n    \"analysis_id\": \"analysis-id\",\n    \"analyis_name\": \"analysis-name\",\n    \"description\": \"job-description\",\n    \"enddate\": \"end-date-in-milliseconds-since-epoch\",\n    \"id\": \"job-id\",\n    \"name\": \"job-name\",\n    \"resultfolderid\": \"result-folder-path\",\n    \"startdate\": \"start-date-in-milliseconds-since-epoch\",\n    \"status\": \"job-status-code\",\n    \"user\": \"username\"\n}\n</code></pre> <p>The payload format for the <code>tool</code> notification type is a little simpler:</p> <pre><code>{\n    \"email_address\": \"email-address\",\n    \"toolname\": \"tool-name\",\n    \"tooldirectory\": \"tool-directory\",\n    \"tooldescription\": \"tool-description\",\n    \"toolattribution\": \"tool-attribution\",\n    \"toolversion\": \"tool-version\"\n}\n</code></pre> <p>Here's an example:</p> <pre><code>$ curl -sH \"$AUTH_HEADER\" \"http://by-tor:8888/secured/notifications/messages?limit=1&amp;offset=0\" | python -mjson.tool\n{\n    \"messages\": [\n        {\n            \"deleted\": false,\n            \"message\": {\n                \"id\": \"C15763CF-A5C9-48F5-BE4F-9FB3CB1897EB\",\n                \"text\": \"URL Import of somefile.txt from http://snow-dog.iplantcollaborative.org/somefile.txt completed\",\n                \"timestamp\": 1331068427000\n            },\n            \"outputDir\": \"/iplant/home/nobody\",\n            \"outputManifest\": [],\n            \"payload\": {\n                \"action\": \"job_status_change\",\n                \"analysis-details\": \"\",\n                \"analysis_id\": \"\",\n                \"analysis_name\": \"\",\n                \"description\": \"URL Import of somefile.txt from http://snow-dog.iplantcollaborative.org/somefile.txt\",\n                \"enddate\": 1331068427000,\n                \"id\": \"40115C19-AFBC-4CAE-9738-324DD8B18FDC\",\n                \"name\": \"URL Import of somefile.txt from http://snow-dog.iplantcollaborative.org/somefile.txt\",\n                \"resultfolderid\": \"/iplant/home/nobody\",\n                \"startdate\": \"1331068414712\",\n                \"status\": \"Completed\",\n                \"user\": \"nobody\"\n            },\n            \"seen\": true,\n            \"type\": \"data\",\n            \"user\": \"nobody\"\n        }\n    ],\n    \"total\": \"37\"\n}\n</code></pre>","path":["API Reference","Endpoints","Notification Endpoints"],"tags":[]},{"location":"services/api/endpoints/notifications/#obtaining-notification-counts","level":2,"title":"Obtaining Notification Counts","text":"<p>Secured Endpoint: GET /secured/notifications/count-messages</p> <p>This endpoint is a passthrough to the notification agent endpoint, <code>/count-messages</code>. Please see the notification agent documentation for more details.</p> <p>This service takes a subset of the query-string parameters as the /messages service, and returns the number of messages that match the criteria specified in the query-string parameters. Here's the list of supported query-string parameters:</p> NameDescriptionRequired/Optional seen                  Indicates whether messages that the user has seen, messages that                 the user has not seen, or both should be counted. If this                 parameter is equal to `true` then only messages that the user                 has seen will be counted. If it is equal to `false` then only                 messages that the user has not seen will be counted. If this                 parameter is not specified at all then both messages that have                 been seen and messages that have not been seen will be counted.              Optional filter                  Specifies the type of notification messages to return, which can                 be `data`, `analysis` or `tool`. Other types of notifications                 may be added in the future. If this parameter it not specified                 then all types of notifications will be returned.              Optional <p>The response body consists of a JSON object containing four fields: <code>user-total</code>, contains the number of user messages that have not been marked as deleted and match the criteria specified in the query string, <code>system-total</code> contains the number of system messages that are active and have not been dismissed by the user, <code>system-total-new</code> contains the number of system messages that have not been marked as received by the user, and <code>system-total-unseen</code> contains the number of system messages that have not been marked as seen by the user.</p> <pre><code>{\n    \"user-total\":          count,\n    \"system-total\":        count,\n    \"system-total-new\":    count,\n    \"system-total-unseen\": count\n}\n</code></pre> <p>Here are some examples:</p> <pre><code>$ curl -sH \"$AUTH_HEADER\" \"http://by-tor:8888/secured/notifications/count-messages\" | python -mjson.tool\n{\n    \"user-total\":          409,\n    \"system-total\":         10,\n    \"system-total-new\":      0,\n    \"system-total-unseen\":   1\n}\n</code></pre> <p>In this example, all messages that are available for the user that have not been marked as deleted are counted.</p> <pre><code>$ curl -sH \"$AUTH_HEADER\" \"http://by-tor:8888/secured/notifications/count-messages?filter=data\" | python -mjson.tool\n{\n    \"user-total\":          91,\n    \"system-total\":        10,\n    \"system-total-new\":     0,\n    \"system-total-unseen\":  1\n}\n</code></pre> <p>In this example only the data notifications that have not been marked as deleted are counted.</p>","path":["API Reference","Endpoints","Notification Endpoints"],"tags":[]},{"location":"services/api/endpoints/notifications/#obtaining-unseen-notifications","level":2,"title":"Obtaining Unseen Notifications","text":"<p>Secured Endpoint: GET /secured/notifications/unseen-messages</p> <p>This endpoint is primarily a passthrough endpoint to the notification agent's <code>/unseen-messages</code> endpoint, but it does make calls into the apps service in order to add the app description to job status update notifications.</p> <p>This service is used to obtain notifications that the user hasn't seen yet. This service takes no query-string parameters. Here's an example:</p> <pre><code>$ curl -sH \"$AUTH_HEADER\" \"http://by-tor:8888/secured/notifications/unseen-messages\" | python -mjson.tool\n{\n    \"messages\": []\n}\n</code></pre>","path":["API Reference","Endpoints","Notification Endpoints"],"tags":[]},{"location":"services/api/endpoints/notifications/#obtaining-the-ten-most-recent-notifications","level":2,"title":"Obtaining the Ten Most Recent Notifications","text":"<p>Secured Endpoint: GET /secured/notifications/last-ten-messages</p> <p>This endpoint is primarily a passthrough endpoint to the notification agent's <code>/last-ten-messages</code> endpoint, but it does make calls into the apps service in order to add the app description to job status update notifications.</p> <p>This endpoint returns the ten most recent messages for the authenticated user in ascending order by message timestamp. Obtaining the ten most recent messages in ascending order is difficult using other endpoints.</p> <p>Examples are omitted for this endpoint because the response body is identical to that of the other endpoints used to obtain notifications.</p>","path":["API Reference","Endpoints","Notification Endpoints"],"tags":[]},{"location":"services/api/endpoints/notifications/#marking-notifications-as-seen","level":2,"title":"Marking Notifications as Seen","text":"<p>Secured Endpoint: POST /secured/notifications/seen</p> <p>This endpoint is a passthrough to the notification agent's <code>/seen</code> endpoint. Please see the notification agent documentation for more details.</p> <p>Once a user has seen a notification, the notification should be marked as seen to prevent it from being returned by the <code>/notifications/unseen-messages</code> endpoint. This service provides a way to mark notifications as seen. The request body for this service is in the following format:</p> <pre><code>{\n    \"uuids\": [\n        \"uuid-1\",\n        \"uuid-2\",\n        \"uuid-n\"\n    ]\n}\n</code></pre> <p>The response body for this service is a simple JSON object that indicates whether or not the service call succeeded and contains the number of messages that are still marked as unseen. Here's an example:</p> <pre><code>$ curl -sH \"$AUTH_HEADER\" -d '\n{\n    \"uuids\": [\n        \"C15763CF-A5C9-48F5-BE4F-9FB3CB1897EB\"\n    ]\n}\n' \"http://by-tor:8888/secured/notifications/seen\" | python -mjson.tool\n{\n    \"count\": 0\n}\n</code></pre> <p>Note that the UUIDs provided in the request body must be obtained from the <code>message</code> -&gt; <code>id</code> element of the notification the user wishes to mark as seen.</p>","path":["API Reference","Endpoints","Notification Endpoints"],"tags":[]},{"location":"services/api/endpoints/notifications/#marking-all-notifications-as-seen","level":2,"title":"Marking All Notifications as Seen","text":"<p>Secured Endpoint: POST /secured/notifications/mark-all-seen</p> <p>This endpoint is a passthrough to the notification agent's <code>/mark-all-seen</code> endpoint. Please see the notification agent documentation for more information about the format of the request body.</p> <p>This endpoint will add or overwrite the \"user\" field in the request body forwarded to the NotificationAgent with the username of the authenticated user making the request.</p> <p>The response body for this service is a simple JSON object that indicates whether or not the service call succeeded and contains the number of messages that are still marked as unseen. Here's an example:</p> <pre><code>$ curl -sH \"$AUTH_HEADER\" -d '{}' \"http://by-tor:8888/secured/notifications/mark-all-seen\" | python -mjson.tool\n{\n    \"count\": 0\n}\n</code></pre>","path":["API Reference","Endpoints","Notification Endpoints"],"tags":[]},{"location":"services/api/endpoints/notifications/#marking-notifications-as-deleted","level":2,"title":"Marking Notifications as Deleted","text":"<p>Secured Endpoint: POST /secured/notifications/delete</p> <p>This endpoint is a passthrough to the notification agent's <code>/delete</code> endpoint. Please see the notification agent documentation for more details.</p> <p>Users may wish to dismiss notifications that they've already seen. This service marks one or more notifications as deleted so that neither the <code>/notfications/messages</code> endpoint nor the <code>/notifications/unseen-messages</code> endpoint will return them. The request body for this service is in the following format:</p> <pre><code>{\n    \"uuids\": [\n        \"uuid-1\",\n        \"uuid-2\",\n        \"uuid-n\"\n    ]\n}\n</code></pre> <p>The response body for this service is a simple JSON object that indicates whether or not the service call succeeded. Here's an example:</p> <pre><code>$ curl -sH \"$AUTH_HEADER\" -d '\n{\n    \"uuids\": [\n        \"C15763CF-A5C9-48F5-BE4F-9FB3CB1897EB\"\n    ]\n}\n' \"http://by-tor:8888/secured/notifications/delete\"\n</code></pre> <p>Note that the UUIDs provided in the request body must be obtained from the <code>message</code> -&gt; <code>id</code> element of the notification the user wishes to delete.</p>","path":["API Reference","Endpoints","Notification Endpoints"],"tags":[]},{"location":"services/api/endpoints/notifications/#marking-all-notifications-as-deleted","level":2,"title":"Marking All Notifications as Deleted","text":"<p>Secured Endpoint: DELETE /secured/notifications/delete-all</p> <p>This endpoint is a passthrough to the notification agent's <code>/delete-all</code> endpoint. Please see the notification agent documentation for more details.</p> <p>This endpoint will add or replace the \"user\" parameter in the request forwarded to the NotificationAgent with the username of the authenticated user making the request.</p> <p>The response body for this service is a simple JSON object that indicates whether or not the service call succeeded and contains the number of messages that are still marked as unseen. Here's an example:</p> <pre><code>$ curl -X DELETE -sH \"$AUTH_HEADER\" \"http://by-tor:8888/secured/notifications/delete-all\" | python -mjson.tool\n{\n    \"count\": 0\n}\n</code></pre>","path":["API Reference","Endpoints","Notification Endpoints"],"tags":[]},{"location":"services/api/endpoints/notifications/#sending-an-arbitrary-notification","level":2,"title":"Sending an Arbitrary Notification","text":"<p>Unsecured Endpoint: POST /send-notification.</p> <p>This endpoint is a passthrough to the notification agent's <code>/notification</code> endpoint. Please see the notification agent documentation for more details.</p>","path":["API Reference","Endpoints","Notification Endpoints"],"tags":[]},{"location":"services/api/endpoints/notifications/#endpoints-for-system-messages-aka-system-notifications","level":2,"title":"Endpoints for System Messages (a.k.a. System Notifications)","text":"<p>The endpoints for the system messages are straight pass throughs to the corresponding calls in the Notification Agent. The only difference is that the endpoints in Terrain are prefixed with /secured/notifications or /admin/notifications and that endpoints that require the user query string parameter instead take the authentication header.</p> Terrain EndpointNotification Agent Endpoint GET /secured/notifications/system/messages GET /system/messages GET /secured/notifications/system/new-messages GET /system/new-messages GET /secured/notifications/system/unseen-messages GET /system/unseen-messages POST /secured/notifications/system/received POST /system/received POST /secured/notifications/system/mark-all-received POST /system/mark-all-received POST /secured/notifications/system/seen POST /system/seen POST /secured/notifications/system/mark-all-seen POST /system/mark-all-seen POST /secured/notifications/system/delete POST /system/delete DELETE /secured/notifications/system/delete-all DELETE /system/delete-all PUT /admin/notifications/system PUT /admin/system GET /admin/notifications/system GET /admin/system GET /admin/notifications/system/:uuid GET /admin/system/:uuid POST /admin/notifications/system/:uuid POST /admin/system/:uuid DELETE /admin/notifications/system/:uuid DELETE /admin/system/:uuid GET /admin/notifications/system-types GET /admin/system-types","path":["API Reference","Endpoints","Notification Endpoints"],"tags":[]},{"location":"services/api/endpoints/permanent-id-requests/","level":1,"title":"Permanent ID Requests","text":"<p>These endpoints create and manage user requests for persistent identifiers (DataCite DOIs) for data the user wishes to make public.</p> <p>The persistent identifiers will be created with the DataCite API and managed using DataCite Fabrica.</p>","path":["API Reference","Endpoints","Permanent ID Requests"],"tags":[]},{"location":"services/api/endpoints/permanent-id-requests/#workflow-overview","level":2,"title":"Workflow Overview","text":"<ol> <li>User reviews DOI Request Quickstart page    and determines that a CyVerse DOI is appropriate for their data.</li> <li>User organizes their data in a single folder per Permanent ID, according to very general CyVerse guidelines.</li> <li>Based on what they learned from tutorial, user will complete DataCite metadata template on that folder.</li> <li>User creates a Permanent ID Request    for this folder.<ul> <li>Request must be for one of the available Permanent ID Request types, however the DataCite API only supports creating new DOIs.</li> <li>Request triggers the validation check within the DE of the metadata and folder name   (must not conflict with any folder names in the data commons repo <code>staging</code> or <code>curated</code> folders).</li> <li>If pass:<ul> <li>Results of request are emailed to curation team.</li> <li>Folder automatically moved to data commons repo <code>staging</code> folder.<ul> <li>Curators automatically given <code>own</code> permission.</li> <li>User automatically given <code>write</code> permission.</li> </ul> </li> <li>User may view all Permanent ID Requests they have submitted.</li> <li>User may view details for any of their Permanent ID Requests.</li> </ul> </li> <li>If fail, user returns to Step 3.</li> </ul> </li> <li>Curator finds request with Permanent ID Request listing.<ul> <li>Curator may view the Permanent ID Request details,   which includes the request's status history (initially only <code>Submitted</code>).</li> <li>Curator checks metadata and data structure (see the DOI Creation SOP page for more details).</li> <li>Curator may update the status of the Permanent ID Request   in this or any subsequent step.<ul> <li>Curator may use any previously created   Permanent ID Request Status Codes,   or add a new status (which is saved for future reuse).</li> </ul> </li> <li>If pass or minor changes that can be made by curator: go to Step 6</li> <li>If changes needed by user: Curator emails user and asks them to make changes</li> <li>Once corrections are made, go to Step 6.</li> </ul> </li> <li>Curator creates Permanent ID for this request.<ul> <li>Folder name must not conflict with any folder names in the data commons repo <code>curated</code> folder.</li> <li>Metadata from folder is submitted to the DataCite API   in order to create the requested Permanent ID   (which currently only supports DOIs).</li> <li>Fails:<ul> <li>Permanent ID not generated and error reported to curator.</li> <li>Request status automatically updated to <code>Failed</code>.</li> <li>Curator corrects any errors.</li> <li>Repeat Step 6 until pass.</li> </ul> </li> <li>Passes:<ul> <li>Permanent ID is generated and notification sent to curator and user.</li> <li>Request status automatically updated to <code>Completion</code>.</li> <li>Folder metadata automatically updated to include new Permanent ID and current date.</li> <li>Folder automatically moved to data commons repo <code>curated</code> folder.<ul> <li>Curators automatically given <code>own</code> permission.</li> <li>Public automatically given <code>read</code> permission.</li> </ul> </li> <li>Curator checks that data is public and visible on mirrors,   that metadata appears correct on the DataCite Fabrica landing page,   and that the Permanent ID redirect works.</li> </ul> </li> </ul> </li> </ol>","path":["API Reference","Endpoints","Permanent ID Requests"],"tags":[]},{"location":"services/api/endpoints/quick-launches/","level":1,"title":"Quick Launches","text":"<p>Quick Launches provide a way to set default parameter values for an analysis, which can make it much easier to launch a large number of similar jobs without having to select the parameter values that the jobs have in common for every new analysis.</p> <p>Quick Launches are created on a per-user basis, but they can be made public when theyâre created and shared with other users.</p> <p>The Swagger docs are available here: https://de.cyverse.org/terrain/docs/index.html#/analyses-quicklaunches</p> <p>Creating a new Quick Launch is a lot like launching an app. The primary difference is that instead of calling the POST /terrain/analyses endpoint, call the POST /terrain/quicklaunches endpoint. The request body contains an analysis submission wrapped in an outer object. The fields at the top level describe the Quick Launch itself. The object in the <code>submission</code> field contains the request body that's normally sent to the POST /terrain/analyses endpoint when launching a job. Note that not all required analysis parameters of the <code>AnalysisSubmissionConfig</code> need to be specified in the Quick Launch.</p> <p>Once a Quick Launch is defined, the GET /terrain/quicklaunches endpoint can be used to list Quick Launches that are available to the user. The description currently says that it lists Quick Launches that were created by the user. This isnât quite correct. Any Quick Launch that the user has permission to view will be listed by this endpoint.</p> <p>All available Quick Launches for an app can be listed using the GET /terrain/quicklaunches/apps/{app-id} endpoint. This endpoint will only list Quick Launches that the user has permission to view.</p> <p>Quick Launch defaults allow the user to specify which Quick Launch to use for a specific app. Both global defaults and user-specific defaults can be defined.</p> <p>The app launch info saved in a Quick Launch can be retrieved with the GET /terrain/quicklaunches/{ql-id}/app-info endpoint. This is analogous to calling the GET /terrain/apps/{system-id}/{app-id} endpoint.</p>","path":["API Reference","Endpoints","Quick Launches"],"tags":[]},{"location":"services/api/endpoints/terrain-v-apps/","level":1,"title":"Overview","text":"<p>The \"secured\" endpoints in apps behave a little bit differently from the secured endpoints in Terrain. Specifically, the secured endpoints in Terrain actually require user authentication whereas those in apps merely require information about the user making the request.</p>","path":["API Reference","Endpoints","Overview"],"tags":[]},{"location":"services/api/endpoints/terrain-v-apps/#calling-secured-terrain-endpoints","level":2,"title":"Calling Secured Terrain Endpoints","text":"<p>All secured endpoints in Terrain require an HTTP header containing a JSON Web Token (JWT). The specific header to use depends on the format of the JWT, but in most cases it will be <code>X-Iplant-De-Jwt</code>. Please see the root API documentation page for details.</p>","path":["API Reference","Endpoints","Overview"],"tags":[]},{"location":"services/api/endpoints/terrain-v-apps/#calling-secured-apps-endpoints","level":2,"title":"Calling \"Secured\" Apps Endpoints","text":"<p>None of these endpoints are actually secured. They retain the \"secured\" label because they're fronted by endpoints in Terrain that are secure. That is, the user interface doesn't hit the apps services directly. Instead, it sends the request to a Terrain endpoint that forwards the request to a corresponding endpoint in apps. The initial purpose of this separation was to provide scalability and separation of concerns.</p> <p>All secured endpoints in apps support four query-string parameters containing user attributes:</p> <ul> <li><code>user</code> - the username</li> <li><code>email</code> - the user's email address</li> <li><code>first-name</code> - the user's first name</li> <li><code>last-name</code> - the user's last name</li> </ul> <p>Not all of these parameters are required by every secured service in apps; the only parameter that is required by all secured services is <code>user</code>. The rest of the parameters are only required when the information in them is specifically required. Terrain always passes all of these parameters to apps when it forwards requests.</p>","path":["API Reference","Endpoints","Overview"],"tags":[]},{"location":"services/api/endpoints/terrain-v-apps/#a-simple-example","level":2,"title":"A Simple Example","text":"<p>One of the simplest endpoints in both Terrain and apps is the /apps/categories endpoint, which is used to obtain the list of app categories that are visible to the user.</p> <p>The call to the Terrain service would look like this:</p> <pre><code>$ curl -H \"$AUTH_HEADER\" \"http://by-tor:8888/apps/categories\"\n</code></pre> <p>The equivalent call to the apps service would look like this:</p> <pre><code>$ curl \"http://by-tor:9999/apps/categories?user=nobody&amp;email=nobody@iplantcollaborative.org&amp;first-name=Nobody&amp;last-name=Inparticular\"\n</code></pre>","path":["API Reference","Endpoints","Overview"],"tags":[]},{"location":"services/api/endpoints/filesystem/coge/","level":1,"title":"Coge","text":"","path":["API Reference","Endpoints","Filesystem","Coge"],"tags":[]},{"location":"services/api/endpoints/filesystem/coge/#viewing-a-genome-file-in-coge","level":2,"title":"Viewing a Genome File in CoGe","text":"<p>A genome file may be submitted to CoGe for viewing within their genome viewer. This endpoint will share the given genome files with the CoGe user, then submit those paths to their \"genome load\" service. This service will return a URL where the authenticated user may view the genome viewer's progress, and the genome visualization once processing is done.</p> <p>URL Path: /coge/genomes/load</p> <p>HTTP Method: POST</p> <p>Error Codes: ERR_NOT_A_USER, ERR_BAD_OR_MISSING_FIELD, ERR_DOES_NOT_EXIST, ERR_NOT_OWNER</p> <p>Request Query Parameters:</p> <p>Request Body:</p> <pre><code>{\n    \"paths\": [\n        \"/iplant/home/ipctest/simple.fasta\"\n    ]\n}\n</code></pre> <p>Response Body:</p> <pre><code>{\n    \"coge_genome_url\": \"http://bit.ly/CoGeSample\"\n}\n</code></pre> <p>Curl Command:</p> <pre><code>curl -sH \"$AUTH_HEADER\" -d '{\"paths\":[\"/iplant/home/ipctest/simple.fasta\"]}' http://127.0.0.1:3000/coge/genomes/load\n</code></pre>","path":["API Reference","Endpoints","Filesystem","Coge"],"tags":[]},{"location":"services/api/endpoints/filesystem/coge/#searching-for-genomes-in-coge","level":2,"title":"Searching for Genomes in CoGe","text":"<p>A user may search for genome information in CoGe in order to retrieve a text representation of that genome for use in DE analyses.</p> <p>URL Path: /coge/genomes</p> <p>HTTP Method: GET</p> <p>Error Codes: ERR_REQUEST_FAILED</p> <p>Request Query Parameters:</p> <ul> <li>search     - The string to search for.</li> </ul> <p>Response Body:</p> <pre><code>{\n    \"genomes\": [\n        {\n            \"chromosome_count\": 35,\n            \"description\": null,\n            \"id\": 9716,\n            \"info\": \"Actinomyces coleocanis strain DSM 15436 (v1, id9716): unmasked\",\n            \"link\": null,\n            \"name\": null,\n            \"organism\": {\n                \"description\": \"Bacteria; Actinobacteria; Actinobacteridae; Actinomycetales; Actinomycineae; Actinomycetaceae; Actinomyces\",\n                \"id\": 23534,\n                \"name\": \"Actinomyces coleocanis strain DSM 15436\"\n            },\n            \"organism_id\": 23534,\n            \"restricted\": false,\n            \"sequence_type\": {\n                \"description\": \"unmasked sequence data\",\n                \"id\": \"1\",\n                \"name\": \"unmasked\"\n            },\n            \"version\": \"1\"\n        },\n        ...\n    }\n}\n</code></pre> <p>Note: the response body from CoGe is passed back to the caller without modification.</p> <p>Curl Command:</p> <pre><code>$ curl -sH \"$AUTH_HEADER\" \"http://127.0.0.1:3000/coge/genomes?search=canis\" | python -mjson.tool\n</code></pre>","path":["API Reference","Endpoints","Filesystem","Coge"],"tags":[]},{"location":"services/api/endpoints/filesystem/coge/#exporting-coge-genome-data-to-irods","level":2,"title":"Exporting CoGe Genome Data to iRODS","text":"<p>Once a user has found an interesting genome, he or she may request a text representation of the genome to be stored in the iPlant Data Store for processing in the DE.</p> <p>URL Path: /coge/genomes/{genome-id}/export-fasta</p> <p>HTTP Method: POST</p> <p>Error Codes: ERR_REQUEST_FAILED</p> <p>Request Query Parameters:</p> <ul> <li>notify     - If present and set to \"true\" the user's email address will be forwarded to CoGe.</li> <li>overwrite  - If present and set to \"true\" the output file will be overwritten if it exists.</li> </ul> <p>Response Body:</p> <pre><code>{\n    \"id\": 30702,\n    \"success\": true\n}\n</code></pre> <p>Note: the response body from CoGe is passed back to the caller without modification.</p>","path":["API Reference","Endpoints","Filesystem","Coge"],"tags":[]},{"location":"services/api/endpoints/filesystem/csv-tsv-parsing/","level":1,"title":"Csv tsv parsing","text":"","path":["API Reference","Endpoints","Filesystem","Csv tsv parsing"],"tags":[]},{"location":"services/api/endpoints/filesystem/csv-tsv-parsing/#csvtsv-parsing","level":2,"title":"CSV/TSV Parsing","text":"<p>URL Path: /secured/filesystem/read-csv-chunk</p> <p>HTTP Method: POST</p> <p>Request Query Parameters:</p> <p>Request Body:</p> <pre><code>{\n    \"path\" : \"/iplant/home/testuser/test-tsv\",\n    \"separator\" : \"%09\",\n    \"page\" : \"4\",\n    \"chunk-size\" : \"400\"\n}\n</code></pre> <p>Response Body:</p> <p>{     \"chunk-size\": \"238\",     \"csv\": [         {             \"0\": \"Number of mismatches allowed in each segment alignment for reads mapped independently\",             \"1\": \"Integer\",             \"2\": \"2\"         },         {             \"0\": \"Minimum length of read segments\",             \"1\": \"Integer\",             \"2\": \"20\"         },         {             \"0\": \"Number of threads\",             \"1\": \"Integer\",             \"2\": \"4\"         },         {             \"0\": \"Tophat Version\",             \"1\": \"TextSelection\",             \"2\": \"1.4.1\"         },         {             \"0\": \"Bowtie Version\",             \"1\": \"TextSelection\",             \"2\": \"0.12.7\"         }     ],     \"file-size\": \"1041\",     \"page\" : \"4\",     \"max-cols\": \"3\",     \"number-pages\": \"3\",     \"path\": \"/iplant/home/testuser/test-tsv\",     \"user\": \"wregglej\" }</p> <p>CURL Command:</p> <pre><code>curl -H \"$AUTH_HEADER\" -d '{\"path\" : \"/iplant/home/testuser/test-tsv\", \"separator\" : \"%09\", \"page\" : \"4\", \"chunk-size\" : \"400\"}' http://127.0.0.1:31325/secured/filesystem/read-csv-chunk\n</code></pre> <p>JSON Field Descriptions:</p> <p>path is the path to the file in iRODS that should be parsed as a CSV. Note that there isn't any checking in place to make sure that the file is actually a CSV or TSV. This is because we can't depend on the filetype detection to detect all possible types of CSV files (i.e. tab-delimited, pipe-delimited, hash-delimited, etc.).</p> <p>page is the page to start at in the file. Your first request should be at page 0 for any file so you can get back the maximum number of pages in the number-pages field.</p> <p>chunk-size is the size to use when calculating the number of pages that a file contains. This should be in bytes.</p> <p>separator is a single character that the CSV parser uses to split fields. Common values are \",\" and \"\\t\". We don't do any validation on this field so that we can support a wider-range of parsing options. The only constraints on this field is that it needs to be readable as a single char and it must be URL encoded.</p> <p>Notes and Limitations:</p> <p>This should work fine with files that use \\r\\n as the line ending, but it will not work correctly with files that use \\r alone. It that case every page returned will be blank.</p> <p>If the chunk-size is set so that it doesn't cover an entire line, a blank page will be returned.</p> <p>The code that trims and resizes the pages to end on line breaks will detect '\\n' that are embedded in double quoted cells as a line break. This is because we're not tracking opening and closing double quotes across pages. We're looking into ways of doing this, but it isn't in yet.</p> <p>The URL encoded value for \\t characters is '%09', without the quotes. If you aren't sending '%09' for the separator when you're trying to parse a TSV, then you're going to have a bad time.</p>","path":["API Reference","Endpoints","Filesystem","Csv tsv parsing"],"tags":[]},{"location":"services/api/endpoints/filesystem/delete/","level":1,"title":"Delete","text":"","path":["API Reference","Endpoints","Filesystem","Delete"],"tags":[]},{"location":"services/api/endpoints/filesystem/delete/#deleting-files-andor-directories","level":2,"title":"Deleting Files and/or Directories","text":"<p>URL Path: /secured/filesystem/delete</p> <p>HTTP Method: POST</p> <p>Action: \"delete\"</p> <p>Error Codes: ERR_NOT_A_FOLDER, ERR_DOES_NOT_EXIST, ERR_NOT_WRITEABLE, ERR_TOO_MANY_PATHS, ERR_NOT_A_USER</p> <p>The ERR_TOO_MANY_PATHS error code is returned when all of the \"paths\" and the items and sub-directories under them exceed the maximum number of paths that can be processed by this endpoint.</p> <p>Request Parameters:</p> <p>Request Body:</p> <pre><code>{\n    \"paths\" : [\"/tempZone/home/rods/test2\"]\n}\n</code></pre> <p>\"paths\" can take a mix of files and directories.</p> <p>Response:</p> <pre><code>{\n    \"paths\":[\"/tempZone/home/rods/test2\"]\n}\n</code></pre> <p>Curl Command:</p> <pre><code>curl -H \"$AUTH_HEADER\" -H \"Content-Type:application/json\" -d '{\"paths\" : [\"/tempZone/home/rods/test2\"]}' http://127.0.0.1:3000/secured/filesystem/delete?user=rods\n</code></pre>","path":["API Reference","Endpoints","Filesystem","Delete"],"tags":[]},{"location":"services/api/endpoints/filesystem/delete/#deleting-all-items-in-a-directory","level":2,"title":"Deleting all items in a Directory","text":"<p>URL Path: /secured/filesystem/delete-contents</p> <p>HTTP Method: POST</p> <p>Action: \"delete\"</p> <p>Error codes: ERR_NOT_A_FOLDER, ERR_DOES_NOT_EXIST, ERR_NOT_WRITEABLE, ERR_TOO_MANY_PATHS, ERR_NOT_A_USER</p> <p>The ERR_TOO_MANY_PATHS error code is returned when all items in the source directory and its sub-directories exceed the maximum number of paths that can be processed by this endpoint.</p> <p>Request Query Parameters:</p> <p>Request Body:</p> <pre><code>{\n    \"path\": \"/tempZone/home/rods/test\"\n}\n</code></pre> <p>Response:</p> <pre><code>{\n    \"paths\":[\n        \"/tempZone/home/rods/test/test1\",\n        \"/tempZone/home/rods/test/test2\"\n    ]\n}\n</code></pre> <p>Example ERR_TOO_MANY_PATHS Error Response:</p> <pre><code>{\n    \"error_code\": \"ERR_TOO_MANY_PATHS\",\n    \"count\": 250,\n    \"limit\": 100\n}\n</code></pre> <p>Curl Command:</p> <pre><code>curl -H \"$AUTH_HEADER\" -H \"Content-Type:application/json\" -d '{\"path\": \"/tempZone/home/rods/test\"}' http://127.0.0.1:3000/secured/filesystem/delete-contents\n</code></pre>","path":["API Reference","Endpoints","Filesystem","Delete"],"tags":[]},{"location":"services/api/endpoints/filesystem/directory-create/","level":1,"title":"Directory create","text":"","path":["API Reference","Endpoints","Filesystem","Directory create"],"tags":[]},{"location":"services/api/endpoints/filesystem/directory-create/#batch-directory-creation","level":2,"title":"Batch Directory Creation","text":"<p>Secured Endpoint: POST /secured/filesystem/directories</p> <p>Delegates to data-info: POST /data/directories</p> <p>This endpoint is a passthrough to the data-info endpoint above. Please see the data-info documentation for more information.</p>","path":["API Reference","Endpoints","Filesystem","Directory create"],"tags":[]},{"location":"services/api/endpoints/filesystem/directory-create/#directory-creation","level":2,"title":"Directory Creation","text":"<p>URL Path: /secured/filesystem/directory/create</p> <p>HTTP Method: POST</p> <p>Error Codes: ERR_BAD_OR_MISSING_FIELD, ERR_NOT_WRITEABLE, ERR_EXISTS, ERR_DOES_NOT_EXIST, ERR_NOT_A_USER</p> <p>Request Body:</p> <pre><code>{\"path\" : \"/tempZone/home/rods/test3\"}\n</code></pre> <p>Response Body:</p> <p>This endpoint uses a similar response as the /secured/filesystem/stat endpoint. For example:</p> <pre><code>{\n    \"id\": \"/tempZone/home/rods/test3\",\n    \"path\": \"/tempZone/home/rods/test3\",\n    \"label\": \"test3\",\n    \"type\": \"dir\",\n    \"date-modified\": 1397063483000,\n    \"date-created\": 1397063483000,\n    \"permission\": \"own\",\n    \"share-count\": 0,\n    \"dir-count\": 0,\n    \"file-count\": 0\n}\n</code></pre> <p>Curl Command:</p> <pre><code>curl -H \"$AUTH_HEADER\" -H \"Content-Type:application/json\" -d '{\"path\" : \"/tempZone/home/rods/test3\"}' \"http://127.0.0.1:3000/secured/filesystem/directory/create\"\n</code></pre>","path":["API Reference","Endpoints","Filesystem","Directory create"],"tags":[]},{"location":"services/api/endpoints/filesystem/directory-listing/","level":1,"title":"Directory listing","text":"","path":["API Reference","Endpoints","Filesystem","Directory listing"],"tags":[]},{"location":"services/api/endpoints/filesystem/directory-listing/#directory-list-non-recursive","level":2,"title":"Directory List (Non-Recursive)","text":"<p>Only lists subdirectories of the directory path passed into it. Delegates to the <code>POST /favorites/filter</code> metadata endpoint in order to set the <code>isFavorite</code> flags in the response. If the metadata service is not available, then these flags will be set to <code>false</code> by default.</p> <p>URL Path: /secured/filesystem/directory</p> <p>HTTP Method: GET</p> <p>Error Codes: ERR_NOT_A_USER, ERR_NOT_READABLE</p> <p>Request Query Params:</p> <ul> <li>path - The path to list. Optional. If ommitted, the user's home directory is used.</li> </ul> <p>Response Body:</p> <pre><code>{\n\"date-created\": 1369778522000,\n\"date-modified\": 1381177547000,\n\"file-size\": 0,\n\"folders\": [\n    {\n        \"date-created\": 1373927956000,\n        \"date-modified\": 1374015533000,\n        \"file-size\": 0,\n        \"badName\": false,\n        \"hasSubDirs\": true,\n        \"path\": \"/iplant/home/wregglej/acsxfdqswfrdafds\",\n        \"label\": \"acsxfdqswfrdafds\",\n        \"isFavorite\" : false,\n        \"id\": \"0c3eb574-df8a-11e3-bfa5-6abdce5a08d5\",\n        \"permission\": \"own\"\n    },\n    {\n        \"date-created\": 1371157127000,\n        \"date-modified\": 1380909580000,\n        \"file-size\": 0,\n        \"badName\": false,\n        \"hasSubDirs\": true,\n        \"path\": \"/iplant/home/wregglej/analyses\",\n        \"label\": \"analyses\",\n        \"isFavorite\" : false,\n        \"id\": \"1c2c436c-e128-11e3-9087-6abdce5a08d5\",\n        \"permission\": \"own\"\n    },\n    {\n        \"date-created\": 1380814985000,\n        \"date-modified\": 1380814985000,\n        \"file-size\": 0,\n        \"badName\": false,\n        \"hasSubDirs\": true,\n        \"path\": \"/iplant/home/wregglej/analyses3\",\n        \"label\": \"analyses3\",\n        \"isFavorite\" : false,\n        \"id\": \"1f293516-e128-11e3-9087-6abdce5a08d5\",\n        \"permission\": \"own\"\n    },\n\n],\n\"hasSubDirs\": true,\n\"id\": \"a3794158-df89-11e3-bf7d-6abdce5a08d5\",\n\"path\": \"/iplant/home/wregglej\",\n\"label\": \"wregglej\",\n\"isFavorite\" : false,\n\"badName\": true,\n\"permission\": \"own\"\n}\n</code></pre> <p>Curl Command:</p> <pre><code>curl -H \"$AUTH_HEADER\" http://127.0.0.1:3000/secured/filesystem/directory\n</code></pre>","path":["API Reference","Endpoints","Filesystem","Directory listing"],"tags":[]},{"location":"services/api/endpoints/filesystem/directory-listing/#paged-directory-listing","level":2,"title":"Paged Directory Listing","text":"<p>Provides a paged directory listing for large directories. Always includes files (unless the directory doesn't contain any). Delegates to the <code>POST /favorites/filter</code> metadata endpoint in order to set the <code>isFavorite</code> flags in the response. If the metadata service is not available, then these flags will be set to <code>false</code> by default.</p> <p>URL Path: /secured/filesystem/paged-directory</p> <p>HTTP Method: GET</p> <p>Error Codes:</p> <ul> <li>ERR_NOT_A_USER</li> <li>ERR_NOT_READABLE</li> <li>ERR_NOT_A_FOLDER</li> <li>ERR_NOT_READABLE</li> <li>ERR_DOES_NOT_EXIST</li> <li>ERR_INVALID_SORT_COLUMN</li> <li>ERR_INVALID_SORT_ORDER</li> </ul> <p>Request Query Params:</p> <ul> <li>path - The path to list. Must be a directory.</li> <li>limit - The total number of results to return in a page. This is the number of folders and files combined.</li> <li>offset - The offset into the directory listing result set to begin the listing at.</li> <li>entity-type - (OPTIONAL) The type of entity to return, FILE, FOLDER, or ANY. The values are case-insensitive. It defaults to ANY.</li> <li>info-type - (OPTIONAL) Filter the files portion of the result set so that only files with this info type are returned. To return multiple info types, and this parameter more than once.</li> <li>sort-col - The column to sort the result set by. Sorting is done in iRODS's ICAT database, not at the application level. Accepted values are NAME, ID, LASTMODIFIED, DATECREATED, SIZE, PATH. The values are case-insensitive.</li> <li>sort-dir - The order to sort the result set in. Accepted values are ASC and DESC. The values are case-insensitive.</li> </ul> <p>Response Body:</p> <pre><code>{\n    \"badName\": false,\n    \"date-created\": 1369778522000,\n    \"date-modified\": 1379520049000,\n    \"file-size\": 0,\n    \"files\": [\n        {\n            \"badName\": false,\n            \"date-created\": 1379519492000,\n            \"date-modified\": 1379520049000,\n            \"file-size\": 196903039,\n            \"id\": \"0d880c78-df8a-11e3-bfa5-6abdce5a08d5\",\n            \"infoType\": null,\n            \"path\": \"/iplant/home/wregglej/centos-5.8-x86-64-minimal.box\",\n            \"label\": \"centos-5.8-x86-64-minimal.box\",\n            \"isFavorite\" : false,\n            \"permission\": \"own\"\n        }\n    ],\n    \"folders\": [\n        {\n            \"badName\": false,\n            \"date-created\": 1374080225000,\n            \"date-modified\": 1374080225000,\n            \"file-size\": 0,\n            \"hasSubDirs\": true,\n            \"id\": \"6375efce-e061-11e3-bfa5-6abdce5a08d5\",\n            \"infoType\": null,\n            \"path\": \"/iplant/home/wregglej/asdfafa\",\n            \"label\": \"asdfafa\",\n            \"isFavorite\" : false,\n            \"permission\": \"own\"\n        },\n        {\n            \"badName\": false,\n            \"date-created\": 1377814242000,\n            \"date-modified\": 1377814242000,\n            \"file-size\": 0,\n            \"hasSubDirs\": true,\n            \"id\": \"b4987bf4-e063-11e3-bfa5-6abdce5a08d5\",\n            \"infoType\": null,\n            \"path\": \"/iplant/home/wregglej/asdf bar\",\n            \"label\": \"asdf bar\",\n            \"isFavorite\" : false,\n            \"permission\": \"own\"\n        },\n        {\n            \"badName\": false,\n            \"date-created\": 1373397344000,\n            \"date-modified\": 1377558112000,\n            \"file-size\": 0,\n            \"hasSubDirs\": true,\n            \"id\" : \"0d622cd8-df8a-11e3-bfa5-6abdce5a08d5\",\n            \"infoType\": null,\n            \"path\": \"/iplant/home/wregglej/Find_Unique_Values_analysis1-2013-07-09-12-15-37.024\",\n            \"label\": \"Find_Unique_Values_analysis1-2013-07-09-12-15-37.024\",\n            \"isFavorite\" : false,\n            \"permission\": \"own\"\n        },\n        {\n            \"badName\": false,\n            \"date-created\": 1374080529000,\n            \"date-modified\": 1374080529000,\n            \"file-size\": 0,\n            \"hasSubDirs\": true,\n            \"id\": \"0d627292-df8a-11e3-bfa5-6abdce5a08d5\",\n            \"infoType\": null,\n            \"path\": \"/iplant/home/wregglej/zaaaaaaaa\",\n            \"label\": \"zaaaaaaaa\",\n            \"isFavorite\" : false,\n            \"permission\": \"own\"\n        }\n    ],\n    \"hasSubDirs\": true,\n    \"id\": \"16426b48-e128-11e3-9076-6abdce5a08d5\",\n    \"infoType\": null,\n    \"path\": \"/iplant/home/wregglej\",\n    \"label\": \"wregglej\",\n    \"isFavorite\" : false,\n    \"permission\": \"own\",\n    \"total\": 218,\n    \"totalBad\": 0\n}\n</code></pre> <p>Curl Command:</p> <pre><code>curl -H \"$AUTH_HEADER\" \"http://127.0.0.1:31325/secured/filesystem/paged-directory?path=/iplant/home/wregglej&amp;sort-col=SIZE&amp;sort-dir=DESC&amp;limit=5&amp;offset=10\"\n</code></pre>","path":["API Reference","Endpoints","Filesystem","Directory listing"],"tags":[]},{"location":"services/api/endpoints/filesystem/empty-trash/","level":1,"title":"Empty trash","text":"","path":["API Reference","Endpoints","Filesystem","Empty trash"],"tags":[]},{"location":"services/api/endpoints/filesystem/empty-trash/#emptying-a-users-trash-directory","level":2,"title":"Emptying a User's Trash Directory","text":"<p>URL Path: /secured/filesystem/trash</p> <p>HTTP Method: DELETE</p> <p>Error Codes: ERR_NOT_A_USER</p> <p>Request Query Parameters:</p> <p>Response:</p> <pre><code>{\n    \"trash\" : \"/path/to/user's/trash/dir/\",\n    \"paths\" : [\n            \"/path/to/deleted/file\",\n    ]\n}\n</code></pre> <p>Curl Command:</p> <pre><code>curl -H \"$AUTH_HEADER\" -X DELETE http://127.0.0.1:3000/secured/filesystem/trash\n</code></pre>","path":["API Reference","Endpoints","Filesystem","Empty trash"],"tags":[]},{"location":"services/api/endpoints/filesystem/errors/","level":1,"title":"Errors","text":"","path":["API Reference","Endpoints","Filesystem","Errors"],"tags":[]},{"location":"services/api/endpoints/filesystem/errors/#error-codes","level":2,"title":"Error Codes","text":"<p>When it encounters an error, filesystem will generally return a JSON object in the form:</p> <pre><code>{\n    \"error_code\" : \"ERR_CODE\"\n}\n</code></pre> <p>Other entries may be included in the map, but you shouldn't depend on them being there for error checking.</p>","path":["API Reference","Endpoints","Filesystem","Errors"],"tags":[]},{"location":"services/api/endpoints/filesystem/existence/","level":1,"title":"Existence","text":"","path":["API Reference","Endpoints","Filesystem","Existence"],"tags":[]},{"location":"services/api/endpoints/filesystem/existence/#filedirectory-existence","level":2,"title":"File/Directory existence","text":"<p>The /exists endpoint allows the caller to check for the existence of a set of files. The following is an example call to the exists endpoint:</p> <p>URL Path: /secured/filesystem/exists</p> <p>HTTP Method: POST</p> <p>Error Codes: ERR_NOT_A_USER</p> <p>Request Query Parameters:</p> <p>Request Body:</p> <pre><code>{\n    \"paths\" : [\n        \"/iplant/home/wregglej/pom.xml\",\n        \"/iplant/home/wregglej/pom.xml2\"\n    ]\n}\n</code></pre> <p>Response Body:</p> <pre><code>{\n    \"paths\":{\n        \"/iplant/home/wregglej/pom.xml2\":false,\n        \"/iplant/home/wregglej/pom.xml\":false\n    }\n}\n</code></pre> <p>Curl Command:</p> <pre><code>curl -H \"$AUTH_HEADER\" -H \"Content-type:application/json\" -d '{\"paths\" : [\"/iplant/home/wregglej/pom.xml\", \"/iplant/home/wregglej/pom.xml2\"]}' 'http://127.0.0.1:3000/secured/filesystem/exists\n</code></pre>","path":["API Reference","Endpoints","Filesystem","Existence"],"tags":[]},{"location":"services/api/endpoints/filesystem/manifest/","level":1,"title":"Manifest","text":"","path":["API Reference","Endpoints","Filesystem","Manifest"],"tags":[]},{"location":"services/api/endpoints/filesystem/manifest/#file-manifest","level":2,"title":"File manifest","text":"<p>URL Path: /secured/filesystem/file/manifest</p> <p>HTTP Method: GET</p> <p>Error Codes: ERR_DOES_NOT_EXIST, ERR_NOT_A_FILE, ERR_NOT_READABLE, ERR_NOT_A_USER</p> <p>Request Query Parameters:</p> <ul> <li>path - Path to a file in iRODSs.</li> </ul> <p>Response Body:</p> <pre><code>{\n    \"content-type\" : \"text/plain\",\n    \"urls\" : [],\n    \"infoType\" : \"&lt;an info type or empty string&gt;\"\n}\n</code></pre> <p>The urls field will contain some or none of the following:</p> <ul> <li>CoGe URLs</li> <li>Tree URLS</li> <li>anon-files URLs</li> </ul> <p>The URLs are formatted like this:</p> <pre><code>{\n    \"label\" : \"&lt;LABEL&gt;\",\n    \"url\" : \"&lt;URL&gt;\"\n}\n</code></pre> <p>For anonymous URLs, the label will be \"anonymous\".</p> <p>For CoGe URLs, the label with start with \"gene_\".</p> <p>For tree URLs, the label will usually start with \"tree_\", but that's not guaranteed (the DE doesn't create the labels).</p> <p>Curl Command:</p> <pre><code>curl -H \"$AUTH_HEADER\" http://127.0.0.1:3000/secured/filesystem/file/manifest?path=/iplant/home/johnw/LICENSE.txt\n</code></pre>","path":["API Reference","Endpoints","Filesystem","Manifest"],"tags":[]},{"location":"services/api/endpoints/filesystem/metadata/","level":1,"title":"Metadata","text":"","path":["API Reference","Endpoints","Filesystem","Metadata"],"tags":[]},{"location":"services/api/endpoints/filesystem/metadata/#metadata","level":2,"title":"Metadata","text":"<p>The following endpoints allow the caller to set and get attributes on files and directories in both iRODS and the CyVerse metadata service. iRODS attributes take the form of Attribute Value Unit triples associated with directories and files. iRODS AVUs are only unique on the full triple, so AVUs with duplicate attributes may exist. DE tools do not, in general, use the unit field.</p>","path":["API Reference","Endpoints","Filesystem","Metadata"],"tags":[]},{"location":"services/api/endpoints/filesystem/metadata/#getting-metadata","level":2,"title":"Getting Metadata","text":"<p>Secured Endpoint: GET /secured/filesystem/{data-id}/metadata</p> <p>Delegates to data-info: GET /data/{data-id}/metadata</p> <p>This endpoint is a passthrough to the data-info endpoint above. Please see the data-info documentation for more information.</p>","path":["API Reference","Endpoints","Filesystem","Metadata"],"tags":[]},{"location":"services/api/endpoints/filesystem/metadata/#setting-metadata","level":2,"title":"Setting Metadata","text":"<p>Secured Endpoint: POST /secured/filesystem/{data-id}/metadata</p> <p>Delegates to data-info: PUT /data/{data-id}/metadata</p> <p>This endpoint is a passthrough to the data-info endpoint above. Please see the data-info documentation for more information.</p>","path":["API Reference","Endpoints","Filesystem","Metadata"],"tags":[]},{"location":"services/api/endpoints/filesystem/metadata/#listing-metadata-templates","level":2,"title":"Listing Metadata Templates","text":"<p>Secured Endpoint: GET /secured/filesystem/metadata/templates</p> <p>Delegates to metadata: GET /templates</p> <p>Secured Endpoint: GET /admin/filesystem/metadata/templates</p> <p>Delegates to metadata: GET /admin/templates</p> <p>These endpoints are passthroughs to the metadata endpoints above. Please see the metadata documentation for more information.</p>","path":["API Reference","Endpoints","Filesystem","Metadata"],"tags":[]},{"location":"services/api/endpoints/filesystem/metadata/#viewing-a-metadata-template","level":2,"title":"Viewing a Metadata Template","text":"<p>Secured Endpoint: GET /secured/filesystem/metadata/template/{template-id}</p> <p>Delegates to metadata: GET /templates/{template-id}</p> <p>This endpoint is a passthrough to the metadata endpoint above. Please see the metadata documentation for more information.</p>","path":["API Reference","Endpoints","Filesystem","Metadata"],"tags":[]},{"location":"services/api/endpoints/filesystem/metadata/#downloading-a-blank-template","level":2,"title":"Downloading a blank template","text":"<p>Secured Endpoint: GET /secured/filesystem/metadata/template/{template-id}/blank-csv</p> <p>Delegates to metadata: GET /templates/{template-id}/blank-csv</p> <p>This endpoint is a passthrough to the metadata endpoint above. Please see the metadata documentation for more information.</p>","path":["API Reference","Endpoints","Filesystem","Metadata"],"tags":[]},{"location":"services/api/endpoints/filesystem/metadata/#downloading-a-template-guide","level":2,"title":"Downloading a template guide","text":"<p>Secured Endpoint: GET /secured/filesystem/metadata/template/{template-id}/guide-csv</p> <p>Delegates to metadata: GET /templates/{template-id}/guide-csv</p> <p>This endpoint is a passthrough to the metadata endpoint above. Please see the metadata documentation for more information.</p>","path":["API Reference","Endpoints","Filesystem","Metadata"],"tags":[]},{"location":"services/api/endpoints/filesystem/metadata/#viewing-a-metadata-attribute","level":2,"title":"Viewing a Metadata Attribute","text":"<p>Secured Endpoint: GET /secured/filesystem/metadata/template/attr/{attribute-id}</p> <p>Delegates to metadata: GET /templates/attr/{attribute-id}</p> <p>This endpoint is a passthrough to the metadata endpoint above. Please see the metadata documentation for more information.</p>","path":["API Reference","Endpoints","Filesystem","Metadata"],"tags":[]},{"location":"services/api/endpoints/filesystem/metadata/#adding-metadata-templates","level":2,"title":"Adding Metadata Templates","text":"<p>Secured Endpoint: POST /admin/filesystem/metadata/templates</p> <p>Delegates to metadata: POST /admin/templates</p> <p>This endpoint is a passthrough to the metadata endpoint above. Please see the metadata documentation for more information.</p>","path":["API Reference","Endpoints","Filesystem","Metadata"],"tags":[]},{"location":"services/api/endpoints/filesystem/metadata/#updating-metadata-templates","level":2,"title":"Updating Metadata Templates","text":"<p>Secured Endpoint: POST /admin/filesystem/metadata/templates/{template-id}</p> <p>Delegates to metadata: PUT /admin/templates/{template-id}</p> <p>This endpoint is a passthrough to the metadata endpoint above. Please see the metadata documentation for more information.</p>","path":["API Reference","Endpoints","Filesystem","Metadata"],"tags":[]},{"location":"services/api/endpoints/filesystem/metadata/#marking-a-metadata-template-as-deleted","level":2,"title":"Marking a Metadata Template as Deleted","text":"<p>Secured Endpoint: DELETE /admin/filesystem/metadata/templates/{template-id}</p> <p>Delegates to metadata: DELETE /admin/templates/{template-id}</p> <p>This endpoint is a passthrough to the metadata endpoint above. Please see the metadata documentation for more information.</p>","path":["API Reference","Endpoints","Filesystem","Metadata"],"tags":[]},{"location":"services/api/endpoints/filesystem/metadata/#adding-batch-metadata-to-multiple-paths-from-a-csv-file","level":2,"title":"Adding Batch Metadata to Multiple Paths from a CSV File","text":"<p>Secured Endpoint: POST /secured/filesystem/metadata/csv-parser</p> <p>Delegates to data-info: POST /data/{data-id}/metadata/csv-parser</p>","path":["API Reference","Endpoints","Filesystem","Metadata"],"tags":[]},{"location":"services/api/endpoints/filesystem/metadata/#request-query-parameters","level":4,"title":"Request Query Parameters","text":"Parameter Required Description dest Yes The folder path to look under for files listed in the CSV file. src Yes Path to the CSV source file in IRODS. separator No URL encoded separator character to use for parsing the CSV/TSV file. Comma (<code>%2C</code>) by default. <p>This endpoint is a passthrough to the data-info endpoint above. Please see the data-info documentation for more information.</p>","path":["API Reference","Endpoints","Filesystem","Metadata"],"tags":[]},{"location":"services/api/endpoints/filesystem/metadata/#curl-command","level":4,"title":"Curl Command","text":"<pre><code>curl -sH \"$AUTH_HEADER\" -X POST \"http://localhost:3000/secured/filesystem/metadata/csv-parser?dest=/iplant/home/ipcuser/folder_1&amp;src=/iplant/home/ipcuser/metadata.csv\"\n</code></pre>","path":["API Reference","Endpoints","Filesystem","Metadata"],"tags":[]},{"location":"services/api/endpoints/filesystem/metadata/#copying-all-metadata-from-a-filefolder","level":2,"title":"Copying all Metadata from a File/Folder","text":"<p>Secured Endpoint: POST /secured/filesystem/{data-id}/metadata/copy</p> <p>Delegates to data-info: POST /data/{data-id}/metadata/copy</p> <p>This endpoint is a passthrough to the data-info endpoint above. Please see the data-info documentation for more information.</p>","path":["API Reference","Endpoints","Filesystem","Metadata"],"tags":[]},{"location":"services/api/endpoints/filesystem/metadata/#exporting-metadata-to-a-file","level":2,"title":"Exporting Metadata to a File","text":"<p>Secured Endpoint: POST /secured/filesystem/{data-id}/metadata/save</p> <p>Delegates to data-info: POST /data/{data-id}/metadata/save</p> <p>This endpoint is a passthrough to the data-info endpoint above. Please see the data-info documentation for more information.</p>","path":["API Reference","Endpoints","Filesystem","Metadata"],"tags":[]},{"location":"services/api/endpoints/filesystem/move/","level":1,"title":"Move","text":"","path":["API Reference","Endpoints","Filesystem","Move"],"tags":[]},{"location":"services/api/endpoints/filesystem/move/#moving-files-andor-directories","level":2,"title":"Moving Files and/or Directories","text":"<p>URL Path: /secured/filesystem/move</p> <p>This endpoint delegates to data-info's /mover endpoint.</p> <p>HTTP Method: POST</p> <p>Error codes: ERR_NOT_A_FOLDER, ERR_DOES_NOT_EXIST, ERR_NOT_WRITEABLE, ERR_EXISTS, ERR_TOO_MANY_PATHS, ERR_NOT_A_USER</p> <p>The ERR_DOES_NOT_EXIST error code pops up when the destination directory does not exist and when one of the \"sources\" directories does not exist. The ERR_EXISTS code pops up when one of the new destination directories already exists. The ERR_TOO_MANY_PATHS error code is returned when all of the \"sources\" and the items and sub-directories under them exceed the maximum number of paths that can be processed by this endpoint.</p> <p>Request Query Parameters:</p> <p>Request Body:</p> <pre><code>{\n    \"sources\" : [\n        \"/tempZone/home/rods/test1\"\n    ],\n    \"dest\" : \"/tempZone/home/rods/test\"\n}\n</code></pre> <p>\"sources\" can contain a mix of files and directories.</p> <p>Response:</p> <pre><code>{\n    \"dest\":\"/tempZone/home/rods/test\",\n    \"sources\":[\n        \"/tempZone/home/rods/test1\"\n    ]\n}\n</code></pre> <p>Curl Command:</p> <pre><code>curl -H \"$AUTH_HEADER\" -H \"Content-Type:application/json\" -d '{\"sources\" : [\"/tempZone/home/rods/test1\"],\"dest\" :\"/tempZone/home/rods/test\"}' http://127.0.0.1:3000/secured/filesystem/move\n</code></pre>","path":["API Reference","Endpoints","Filesystem","Move"],"tags":[]},{"location":"services/api/endpoints/filesystem/move/#moving-all-items-in-a-directory","level":2,"title":"Moving all items in a Directory","text":"<p>URL Path: /secured/filesystem/move-contents</p> <p>This endpoint delegates to data-info's /data/:data-id/children/dir endpoint, after looking up the source's UUID.</p> <p>HTTP Method: POST</p> <p>Error codes: ERR_NOT_A_FOLDER, ERR_DOES_NOT_EXIST, ERR_NOT_WRITEABLE, ERR_EXISTS, ERR_TOO_MANY_PATHS, ERR_NOT_A_USER</p> <p>The ERR_DOES_NOT_EXIST error code is returned when the \"destination\" directory does not exist and when the \"source\" directory does not exist. The ERR_EXISTS error code is returned when one of the new destination directories or files already exists. The ERR_TOO_MANY_PATHS error code is returned when all items in the \"source\" directory and its sub-directories exceed the maximum number of paths that can be processed by this endpoint.</p> <p>Request Query Parameters:</p> <p>Request Body:</p> <pre><code>{\n    \"source\": \"/tempZone/home/rods/test1\",\n    \"dest\": \"/tempZone/home/rods/test\"\n}\n</code></pre> <p>Response:</p> <pre><code>{\n    \"dest\":\"/tempZone/home/rods/test\",\n    \"sources\":[\n        \"/tempZone/home/rods/test1/test2\",\n        \"/tempZone/home/rods/test1/test3\"\n    ]\n}\n</code></pre> <p>Example ERR_TOO_MANY_PATHS Error Response:</p> <pre><code>{\n    \"error_code\": \"ERR_TOO_MANY_PATHS\",\n    \"count\": 250,\n    \"limit\": 100\n}\n</code></pre> <p>Curl Command:</p> <pre><code>curl -H \"$AUTH_HEADER\" -H \"Content-Type:application/json\" -d '{\"source\": \"/tempZone/home/rods/test1\",\"dest\": \"/tempZone/home/rods/test\"}' http://127.0.0.1:3000/secured/filesystem/move-contents\n</code></pre>","path":["API Reference","Endpoints","Filesystem","Move"],"tags":[]},{"location":"services/api/endpoints/filesystem/ore/","level":1,"title":"Generating OAI-ORE files for a data set.","text":"<p>Secured Endpoint: POST /secured/filesystem/{data-id}/ore/save</p> <p>Delegates to data-info: POST /data/{data-id}/ore/save</p> <p>This endpoint is a passthrough to the data-info endpoint above. Please see the data-info documentation for more information.</p>","path":["API Reference","Endpoints","Filesystem","Generating OAI-ORE files for a data set."],"tags":[]},{"location":"services/api/endpoints/filesystem/path-lists/","level":1,"title":"Path lists","text":"","path":["API Reference","Endpoints","Filesystem","Path lists"],"tags":[]},{"location":"services/api/endpoints/filesystem/path-lists/#ht-path-list-creator","level":2,"title":"HT Path List Creator","text":"<p>Delegates to data-info: <code>POST /path-list-creator</code></p> <p>This endpoint is a passthrough to the data-info endpoint above. Please see the data-info documentation for more information.</p> <p>URL Path: /secured/filesystem/path-list-creator</p> <p>HTTP Method: POST</p>","path":["API Reference","Endpoints","Filesystem","Path lists"],"tags":[]},{"location":"services/api/endpoints/filesystem/permissions/","level":1,"title":"Permissions","text":"","path":["API Reference","Endpoints","Filesystem","Permissions"],"tags":[]},{"location":"services/api/endpoints/filesystem/permissions/#listing-user-permissions","level":2,"title":"Listing User Permissions","text":"<p>Lists the users that have access to a file and the their permissions on the file. The user making the request and the configured rodsadmin user are filtered out of the returned list. The user making the request must own the file.</p> <p>URL Path: /secured/filesystem/user-permissions</p> <p>HTTP Method: POST</p> <p>Error Codes: ERR_NOT_A_USER, ERR_DOES_NOT_EXIST, ERR_NOT_OWNER</p> <p>Request Query Parameters:</p> <p>Request Body:</p> <pre><code>{\n    \"paths\": [\n        \"/iplant/home/testuser/testfile\",\n        \"/iplant/home/testuser/testfile2\"\n    ]\n}\n</code></pre> <p>Response Body:</p> <pre><code>{\n    \"paths\": [\n        {\n            \"path\": \"/iplant/home/testuser/testfile\",\n            \"user-permissions\": [\n                {\n                    \"user\": \"user1\",\n                    \"permission\": \"read\"\n                }\n            ]\n        },\n        {\n            \"path\": \"/iplant/home/testuser/testfile2\",\n            \"user-permissions\": [\n                {\n                    \"user\": \"user2\",\n                    \"permission\": \"read\"\n                }\n            ]\n        }\n    ]\n}\n</code></pre> <p>Curl Command:</p> <pre><code>curl -H \"$AUTH_HEADER\" -d '{\"paths\" : [\"/iplant/home/testuser/testfile\", \"/iplant/home/testuser/testfile2\"]}' 'http://nibblonian.example.org/secured/filesystem/user-permissions\n</code></pre>","path":["API Reference","Endpoints","Filesystem","Permissions"],"tags":[]},{"location":"services/api/endpoints/filesystem/read-chunk/","level":1,"title":"Read chunk","text":"","path":["API Reference","Endpoints","Filesystem","Read chunk"],"tags":[]},{"location":"services/api/endpoints/filesystem/read-chunk/#reading-a-chunk-of-a-file","level":2,"title":"Reading a chunk of a file","text":"<p>URL Path: /secured/filesystem/read-chunk</p> <p>This endpoint delegates to data-info's /data/:data-id/chunks/:position/:size, after looking up the UUID corresponding to the path it was passed.</p> <p>HTTP Method: POST</p> <p>Error Codes_: ERR_DOES_NOT_EXIST, ERR_NOT_READABLE, ERR_NOT_A_USER</p> <p>Request Query Parameters_:</p> <p>Request Body:</p> <pre><code>{\n    \"path\"       : \"/iplant/home/wregglej/testfile\",\n    \"position\"   : \"20\",\n    \"chunk-size\" : \"7\"\n}\n</code></pre> <p>Response:</p> <pre><code>{\n    \"path\"       : \"/iplant/home/wregglej/testfile\",\n    \"user\"       : \"wregglej\",\n    \"start\"      : \"20\",\n    \"chunk-size\" : \"7\",\n    \"file-size\"  : \"33\",\n    \"chunk\"      : \"0\\n12345\"\n}\n</code></pre> <p>Curl Command:</p> <pre><code>curl -H \"$AUTH_HEADER\" -H \"Content-Type:application/json\" -d '{\"path\" : \"/iplant/home/wregglej/testfile\", \"position\" : \"20\", \"chunk-size\" : \"7\"}' http://127.0.0.1:31360/secured/filesystem/read-chunk\n</code></pre> <p>Notes: * 'position' and 'chunk-size' are both in bytes. * 'position' and 'chunk-size' must be parseable as longs. * 'start', 'chunk-size', and 'file-size' in the response are all in bytes. * 'start', 'chunk-size', amd 'file-size' should all be parseable as longs. * The byte at 'position' is not included in the response. The chunk begins at position + 1.</p>","path":["API Reference","Endpoints","Filesystem","Read chunk"],"tags":[]},{"location":"services/api/endpoints/filesystem/rename/","level":1,"title":"Rename","text":"","path":["API Reference","Endpoints","Filesystem","Rename"],"tags":[]},{"location":"services/api/endpoints/filesystem/rename/#renaming-a-file-or-directory","level":2,"title":"Renaming a File or Directory","text":"<p>URL Path: /secured/filesystem/rename</p> <p>HTTP Method: POST</p> <p>Error codes: ERR_NOT_A_FOLDER, ERR_DOES_NOT_EXIST, ERR_NOT_WRITEABLE, ERR_EXISTS, ERR_INCOMPLETE_RENAME, ERR_NOT_A_USER, ERR_TOO_MANY_PATHS</p> <p>The ERR_TOO_MANY_PATHS error code is returned when the items and sub-directories under the \"source\" folder exceed the maximum number of paths that can be processed by this endpoint.</p> <p>Request Query Parameters:</p> <p>Request Body:</p> <pre><code>{\n    \"source\" : \"/tempZone/home/wregglej/test3\",\n    \"dest\" : \"/tempZone/home/wregglej/test2\"\n}\n</code></pre> <p>Response:</p> <pre><code>{\n    \"source\":\"/tempZone/home/wregglej/test3\",\n    \"dest\":\"/tempZone/home/wregglej/test2\"\n}\n</code></pre> <p>Curl Command:</p> <pre><code>curl -H \"$AUTH_HEADER\" -H \"Content-Type:application/json\" -d '{\"source\" : \"/tempZone/home/wregglej/test3\", \"dest\" : \"/tempZone/home/wregglej/test2\"}' http://127.0.0.1:3000/secured/filesystem/rename\n</code></pre>","path":["API Reference","Endpoints","Filesystem","Rename"],"tags":[]},{"location":"services/api/endpoints/filesystem/restore/","level":1,"title":"Restore","text":"","path":["API Reference","Endpoints","Filesystem","Restore"],"tags":[]},{"location":"services/api/endpoints/filesystem/restore/#restoring-a-file-or-directory-from-a-users-trash","level":2,"title":"Restoring a file or directory from a user's trash","text":"<p>URL Path: /secured/filesystem/restore</p> <p>HTTP Method: POST</p> <p>Error Codes: ERR_EXISTS, ERR_DOES_NOT_EXIST, ERR_NOT_A_USER, ERR_NOT_WRITEABLE, ERR_TOO_MANY_PATHS</p> <p>The ERR_TOO_MANY_PATHS error code is returned when all of the \"paths\" and the items and sub-directories under them exceed the maximum number of paths that can be processed by this endpoint.</p> <p>Request Query Parameters:</p> <p>Request Body:</p> <pre><code>{\n    \"paths\" : [\"/iplant/trash/home/proxy-user/johnworth/foo.fq\",\n               \"/iplant/trash/home/proxy-user/johnworth/foo1.fq\"]\n}\n</code></pre> <p>Response Body:</p> <pre><code>{\n    \"restored\" : {\n        \"/iplant/trash/home/proxy-user/johnworth/foo.fq\" :  {\n            \"restored-path\" : /iplant/home/johnworth/foo.fq\",\n            \"partial-restore\" : true\n        },\n        \"/iplant/trash/home/proxy-user/johnworth/foo1.fq\" : {\n            \"restored-path\" : \"/iplant/home/johnworth/foo1.fq\"\n            \"partial-restore\" : true\n        }\n    }\n}\n</code></pre> <p>The \"restored\" field is a map that whose keys are the paths in the trash that were restored. Associated with those paths is a map that contains two entries, \"restored-path\" that contains the path that the file was restored to, and \"partial-restore\" which is a boolean that is true if the restoration was to the home directory because there was no alternative and false if the restoration was a full restore.</p> <p>If a file is deleted and then the directory that the file originally lived in is deleted, the directory will be recreated if the file is restored. If the deleted directory is then subsequently restored, it will moved back to its original location with a numerical suffix. The suffix is generated according to how many directories with the same name exist in the same parent directory. File restorations follow similar logic. If a file with the same name is restored to the same directory multiple times, the subsequent restored versions will have numerical suffixes as well.</p> <p>Curl Command:</p> <pre><code>curl -H \"$AUTH_HEADER\" -d '{\"paths\" : [\"/iplant/trash/home/proxy-user/johnworth/foo.fq\", \"/iplant/trash/home/proxy-user/johnworth/foo1.fq\"]}' http://sample.nibblonian.org/secured/filesystem/restore\n</code></pre>","path":["API Reference","Endpoints","Filesystem","Restore"],"tags":[]},{"location":"services/api/endpoints/filesystem/restore/#restoring-all-items-in-a-users-trash","level":2,"title":"Restoring all items in a user's trash","text":"<p>URL Path: /secured/filesystem/restore-all</p> <p>HTTP Method: POST</p> <p>Error Codes: ERR_EXISTS, ERR_NOT_A_USER, ERR_NOT_WRITEABLE, ERR_TOO_MANY_PATHS</p> <p>The ERR_TOO_MANY_PATHS error code is returned when all items in the user's trash and its sub-directories exceed the maximum number of paths that can be processed by this endpoint.</p> <p>Request Query Parameters:</p> <p>Request Body:</p> <pre><code>No body is required for this request.\n</code></pre> <p>Response:</p> <pre><code>{\n    \"restored\" : {\n        \"/iplant/trash/home/proxy-user/johnworth/foo.fq\" :  {\n            \"restored-path\" : /iplant/home/johnworth/foo.fq\",\n            \"partial-restore\" : true\n        },\n        \"/iplant/trash/home/proxy-user/johnworth/foo1.fq\" : {\n            \"restored-path\" : \"/iplant/home/johnworth/foo1.fq\"\n            \"partial-restore\" : true\n        }\n    }\n}\n</code></pre> <p>Example ERR_TOO_MANY_PATHS Error Response:</p> <pre><code>{\n    \"error_code\": \"ERR_TOO_MANY_PATHS\",\n    \"count\": 250,\n    \"limit\": 100\n}\n</code></pre> <p>Curl Command:</p> <pre><code>curl -H \"$AUTH_HEADER\" -H \"Content-Type:application/json\" -X POST http://127.0.0.1:3000/secured/filesystem/restore-all\n</code></pre>","path":["API Reference","Endpoints","Filesystem","Restore"],"tags":[]},{"location":"services/api/endpoints/filesystem/root-listing/","level":1,"title":"Root listing","text":"","path":["API Reference","Endpoints","Filesystem","Root listing"],"tags":[]},{"location":"services/api/endpoints/filesystem/root-listing/#top-level-root-listing","level":2,"title":"Top Level Root Listing","text":"<p>Delegates to data-info: <code>GET /navigation/root</code></p> <p>This endpoint is a passthrough to the data-info endpoint above, though it will add the <code>label</code> and <code>hasSubDirs</code> fields to data-info responses. Please see the data-info documentation for more information.</p> <p>URL Path: /secured/filesystem/root</p> <p>HTTP Method: GET</p> <p>Request Query Parameters:</p> <p>Response Body:</p> <pre><code>{\n    \"roots\": [\n        {\n            \"date-modified\": 1340918988000,\n            \"hasSubDirs\": true,\n            \"permission\": \"own\",\n            \"date-created\": 1335217160000,\n            \"label\": \"wregglej\",\n            \"id\": \"0b331f99-896f-4465-b0bf-15185c53414c\",\n            \"path\": \"/iplant/home/wregglej\"\n        },\n        {\n            \"date-modified\": 1335476028000,\n            \"hasSubDirs\": true,\n            \"permission\": \"write\",\n            \"date-created\": 1335217387000,\n            \"label\": \"Community Data\",\n            \"id\": \"54ab8910-f9b3-11e4-9d60-1a5a300ff36f\",\n            \"path\": \"/iplant/home/shared\"\n        }\n    ]\n}\n</code></pre> <p>Curl Command:</p> <pre><code>curl -H \"$AUTH_HEADER\" 'http://127.0.0.1::3000/secured/filesystem/root'\n</code></pre>","path":["API Reference","Endpoints","Filesystem","Root listing"],"tags":[]},{"location":"services/api/endpoints/filesystem/search/","level":1,"title":"Table of Contents","text":"<p>This document describes the endpoints used to performing searches of user data.</p>","path":["API Reference","Endpoints","Filesystem","Table of Contents"],"tags":[]},{"location":"services/api/endpoints/filesystem/search/#table-of-contents","level":1,"title":"Table of Contents","text":"<ul> <li>Indexed Information</li> <li>Basic Usage<ul> <li>Search Requests</li> </ul> </li> </ul>","path":["API Reference","Endpoints","Filesystem","Table of Contents"],"tags":[]},{"location":"services/api/endpoints/filesystem/search/#indexed-information","level":1,"title":"Indexed Information","text":"<p>For each file and folder stored in the CyVerse Data Store, its ACL, system metadata, and user metadata are indexed as a JSON document. For files, file records are indexed, and for folders, folder records are indexed.</p> <p>In addition, CyVerse metadata (non-iRODS metadata) is indexed in a child document, and tags are indexed separately in their own way as well.</p>","path":["API Reference","Endpoints","Filesystem","Table of Contents"],"tags":[]},{"location":"services/api/endpoints/filesystem/search/#basic-usage","level":1,"title":"Basic Usage","text":"<p>For the client without administrative privileges, Terrain provides endpoints for performing searches and for checking the status of the indexer.</p>","path":["API Reference","Endpoints","Filesystem","Table of Contents"],"tags":[]},{"location":"services/api/endpoints/filesystem/search/#search-requests","level":2,"title":"Search Requests","text":"<p>Terrain provides search endpoints that allow callers to search the data by name and various pieces of system and user metadata. It supports the all the queries in the ElasticSearch query DSL for searching.</p> <p>Each field in an indexed document may be explicitly used in a search query. If the field is an object, i.e. an aggregate of fields, the object's fields may be explicitly referenced as well using dot notation, e.g. <code>acl.access</code>.</p>","path":["API Reference","Endpoints","Filesystem","Table of Contents"],"tags":[]},{"location":"services/api/endpoints/filesystem/search/#endpoints","level":3,"title":"Endpoints","text":"<ul> <li>Secured Endpoint: GET /secured/filesystem/index</li> </ul> <p>This endpoint searches the data index and retrieves a set of files and/or folders matching the terms provided in the query string.</p>","path":["API Reference","Endpoints","Filesystem","Table of Contents"],"tags":[]},{"location":"services/api/endpoints/filesystem/search/#request-parameters","level":3,"title":"Request Parameters","text":"<p>The following additional URI parameters are recognized.</p> Parameter Required? Default Description q yes* This parameter holds a JSON encoded search query. See query syntax for a description of the syntax. type no any This parameter restricts the search to either files or folders. It can take the values <code>any</code>, meaning files and folders, <code>file</code>, only files, and <code>folders</code>, only folders. tags yes* This is a comma-separated list of tag UUIDs. This parameter restricts the search to only entities that have at least of the provided tags. includeTrash no <code>false</code> This parameter allows the result set to contain matching files and folders from the user's DE trash. A value <code>true</code> allows trash, and a value of <code>false</code> excludes it. offset no 0 This parameter indicates the number of matches to skip before including any in the result set. When combined with <code>limit</code>, it allows for paging results. limit no 200 This parameter limits the number of matches in the result set to be a most a certain amount. When combined with <code>offset</code>, it allows for paging results. sort no score:desc See sorting <p>* At least <code>q</code> or <code>tags</code> is required.</p>","path":["API Reference","Endpoints","Filesystem","Table of Contents"],"tags":[]},{"location":"services/api/endpoints/filesystem/search/#sorting","level":4,"title":"Sorting","text":"<p>The result set is sorted. By default the sort is performed on the <code>score</code> field in descending order. The <code>sort</code> request parameter can be used to change the sort order. Its value has the form <code>field:direction</code> where <code>field</code> is one of the fields of a match record and <code>direction</code> is either <code>asc</code> for ascending or <code>desc</code> for descending. Use dot notation to sort by one of the nested fields of the match records, e.g., <code>entity.label</code> will sort by the <code>label</code> field of the matched entities. If no <code>:direction</code> is provided, the search direction will default to <code>desc</code>.</p>","path":["API Reference","Endpoints","Filesystem","Table of Contents"],"tags":[]},{"location":"services/api/endpoints/filesystem/search/#response","level":3,"title":"Response","text":"<p>When the search succeeds the response document has these additional fields.</p> Field Type Description total number This is the total number of matches found, not the number of elements in the <code>matches</code> array. offset number This is the value of the <code>offset</code> parameter in the query string. matches array This is the set or partial set of matches found, each entry being a match record. It contains at most <code>limit</code> entries and is sorted by descending score. execution-time number This is the number of milliseconds that it took to perform the query and get a response from elasticsearch. <p>Match Record</p> Field Type Description score number an indication of how well this entity matches the query compared to other matches type string the entity is this type of filesystem entry, either <code>\"file\"</code> or <code>\"folder\"</code> entity object the file record or folder record matched","path":["API Reference","Endpoints","Filesystem","Table of Contents"],"tags":[]},{"location":"services/api/endpoints/filesystem/search/#example","level":3,"title":"Example","text":"<pre><code>$ curl -H \"$AUTH_HEADER\" \\\n&gt; \"http://localhost:8888/secured/filesystem/index?q=\\\\{\\\"wildcard\\\":\\\\{\\\"label\\\":\\\"?e*\\\"\\\\}\\\\}&amp;type=file&amp;tags=64581dbe-3aa1-11e4-a54e-3c4a92e4a804,6504ca14-3aa1-11e4-8d83-3c4a92e4a804&amp;offset=1&amp;limit=2&amp;sort:desc\" \\\n&gt; | python -mjson.tool\n{\n    \"matches\": [\n        {\n            \"entity\": {\n                \"creator\": \"rods#iplant\",\n                \"dateCreated\": 1381325224090,\n                \"dateModified\": 1384998366001,\n                \"fileSize\": 13225,\n                \"id\": \"6278f8e0-121f-4ce6-a15f-1083cfad6de5\",\n                \"label\": \"read1_10k.fq\",\n                \"fileType\": null,\n                \"metadata\": [],\n                \"path\": \"/iplant/home/rods/analyses/fc_01300857-2013-10-09-13-27-04.090/read1_10k.fq\",\n                \"permission\" : \"own\",\n                \"userPermissions\": [\n                    {\n                        \"permission\": \"read\",\n                        \"user\": \"rods#iplant\"\n                    },\n                    {\n                        \"permission\": \"own\",\n                        \"user\": \"rodsadmin#iplant\"\n                    }\n                ]\n            },\n            \"score\": 1.0,\n            \"type\": \"file\"\n        },\n        {\n            \"entity\": {\n                \"creator\": \"rods#iplant\",\n                \"dateCreated\": 1381325285602,\n                \"dateModified\": 1384998366001,\n                \"fileSize\": 14016,\n                \"fileType\": null,\n                \"id\": \"acaeb63d-8e84-412d-89a2-716a6a4dda7e\",\n                \"label\": \"read1_10k.fq\",\n                \"metadata\": [\n                    {\n                        \"attribute\": \"color\",\n                        \"unit\": null,\n                        \"value\": \"red\"\n                    }\n                ],\n                \"path\": \"/iplant/home/rods/analyses/ft_01251621-2013-10-09-13-28-05.602/read1_10k.fq\",\n                \"permission\": \"write\",\n                \"userPermissions\": [\n                    {\n                        \"permission\": \"read\",\n                        \"user\": \"rods#iplant\"\n                    },\n                    {\n                        \"permission\": \"write\",\n                        \"user\": \"rodsadmin#iplant\"\n                    }\n                ]\n            },\n            \"score\": 1.0,\n            \"type\": \"file\"\n        }\n    ],\n    \"execution-time\" : 300,\n    \"offset\": 1,\n    \"total\": 7\n}\n</code></pre>","path":["API Reference","Endpoints","Filesystem","Table of Contents"],"tags":[]},{"location":"services/api/endpoints/filesystem/sharing/","level":1,"title":"Sharing","text":"","path":["API Reference","Endpoints","Filesystem","Sharing"],"tags":[]},{"location":"services/api/endpoints/filesystem/sharing/#sharing-unsharing","level":2,"title":"Sharing &amp; Unsharing","text":"<p>Please see the /secured/share and /secured/unshare endpoints.</p>","path":["API Reference","Endpoints","Filesystem","Sharing"],"tags":[]},{"location":"services/api/endpoints/filesystem/sharing/#sharing-files-with-the-anonymous-user","level":2,"title":"Sharing files with the anonymous user","text":"<p>Shares files with the anonymous user. It gives the anonymous user read access. All paths must be files.</p> <p>URL Path: /secured/filesystem/anon-files</p> <p>HTTP Method: POST</p> <p>ERROR CODE: ERR_NOT_A_USER, ERR_BAD_OR_MISSING_FIELD, ERR_DOES_NOT_EXIST, ERR_NOT_OWNER, ERR_NOT_A_FILE</p> <p>Request Body:</p> <pre><code>{\n    \"paths\" :[\"/path/to/a/file\"]\n}\n</code></pre> <p>Curl Command:</p> <pre><code>curl -H \"$AUTH_HEADER\" -d '{\"paths\" : [\"/path/to/a/file\"]}' http://example.org/secured/filesystem/anon-files\n</code></pre> <p>Response Body:</p> <pre><code>{\n    \"paths\" : {\n      \"/path/to/a/file\" : \"http://URL-to-file/\"\n    },\n    \"user\" : \"username\"\n}\n</code></pre>","path":["API Reference","Endpoints","Filesystem","Sharing"],"tags":[]},{"location":"services/api/endpoints/filesystem/stat/","level":1,"title":"Stat","text":"","path":["API Reference","Endpoints","Filesystem","Stat"],"tags":[]},{"location":"services/api/endpoints/filesystem/stat/#file-and-directory-status-information","level":2,"title":"File and Directory Status Information","text":"<p>The /stat endpoint allows the caller to get serveral pieces of information about a file or directory at once. For directories, the response includes the created and last-modified timestamps along with a file type of <code>dir</code>. For regular files, the response contains the created and last-modified timestamps, the file size in bytes and a file type of <code>file</code>. The following is an example call to the stat endpoint:</p> <p>URL Path: /secured/filesystem/stat</p> <p>HTTP Method: POST</p> <p>Request Query Parameters:</p> <p>Request Body:</p> <pre><code>{\n    \"paths\": [\n         \"/iplant/home/wregglej/BTSync.dmg\"\n    ]\n}\n</code></pre> <p>Response Body: <pre><code>{\n    \"paths\": {\n        \"/iplant/home/wregglej/BTSync.dmg\": {\n            \"date-created\": 1.398183371e+12,\n            \"date-modified\": 1.398183371e+12,\n            \"file-size\": 1.0822742e+07,\n            \"id\": \"0dfcac40-df8a-11e3-bfa5-6abdce5a08d5\",\n            \"infoType\": \"\",\n            \"label\": \"BTSync.dmg\",\n            \"content-type\": \"application/octet-stream\",\n            \"path\": \"/iplant/home/wregglej/BTSync.dmg\",\n            \"permission\": \"own\",\n            \"share-count\": 1,\n            \"type\": \"file\"\n        }\n    }\n}\n</code></pre></p> <p>Note that entries in the \"paths\" map that are directories will include \"file-count\" and \"dir-count\" fields, while file entries will not.</p> <p>The \"share-count\" field is provided for both files and directories and lists the number of users that a file is shared with.</p> <p>Curl Command:</p> <pre><code>curl -H \"$AUTH_HEADER\" -H \"Content-Type:application/json\" -sd '{\"paths\":[\"/iplant/home/wregglej/BTSync.dmg\"]}' http://services-2:31360/secured/filesystem/stat\n</code></pre>","path":["API Reference","Endpoints","Filesystem","Stat"],"tags":[]},{"location":"services/api/endpoints/filesystem/tickets/","level":1,"title":"Tickets","text":"","path":["API Reference","Endpoints","Filesystem","Tickets"],"tags":[]},{"location":"services/api/endpoints/filesystem/tickets/#creating-tickets","level":2,"title":"Creating Tickets","text":"<p>URL Path: /secured/filesystem/tickets</p> <p>HTTP Method: POST</p> <p>Error Codes: ERR_NOT_A_USER, ERR_DOES_NOT_EXIST, ERR_NOT_WRITEABLE</p> <p>Request Parameters:</p> <ul> <li>public - Tells terrain whether to make the ticket accessible to the public group. Setting it to 1 means that the ticket will be made publicly accessible. Any other value means that the ticket will not be accessible publicly. This parameter is optional and defaults to not making tickets public.</li> </ul> <p>Request Body:</p> <pre><code>{\n    \"paths\" : [\n        \"/path/to/file/or/directory\",\n        \"/path/to/another/file/or/directory\"\n    ]\n}\n</code></pre> <p>Response Body:</p> <pre><code>{\n    \"user\" : \"&lt;username&gt;\",\n    \"tickets\" : [\n        {\n            \"path\"              : \"/path/to/file/or/directory\",\n            \"ticket-id\"         : \"&lt;ticket-id&gt;\",\n            \"download-url\"      : \"http://127.0.0.1:8080/d/&lt;ticket-id&gt;\",\n            \"download-page-url\" : \"http://127.0.0.1:8080/&lt;ticket-id&gt;\"\n        }\n    ]\n}\n</code></pre> <p>Curl Command:</p> <pre><code>curl -H \"$AUTH_HEADER\" -d '{\"paths\":\"/path/to/file/or/directory\",\"/path/to/another/file/or/directory\"]}' 'http://127.0.0.1:3000/secured/filesystem/tickets?public=1'\n</code></pre>","path":["API Reference","Endpoints","Filesystem","Tickets"],"tags":[]},{"location":"services/api/endpoints/filesystem/tickets/#listing-tickets","level":2,"title":"Listing Tickets","text":"<p>URL Path: /secured/filesystem/list-tickets</p> <p>HTTP Method: POST</p> <p>Error Codes: ERR_NOT_A_USER, ERR_DOES_NOT_EXIST, ERR_NOT_WRITEABLE</p> <p>Request Parameters:</p> <p>Request Body:</p> <pre><code>{\n    \"paths\" : [\"list of paths to look up tickets for\"]\n}\n</code></pre> <p>Response Body:</p> <pre><code>{\n    \"tickets\" : {\n        \"/path/to/file\" : [\n            {\n                \"path\"              : \"/path/to/file\",\n                \"ticket-id\"         : \"&lt;ticket-id&gt;\",\n                \"download-url\"      : \"http://127.0.0.1:8080/d/&lt;ticket-id&gt;\",\n                \"download-page-url\" : \"http://127.0.0.1:8080/&lt;ticket-id&gt;\"\n            }\n        ],\n        \"/path/to/dir\"  : [\n            {\n                \"path\"              : \"/path/to/dir\",\n                \"ticket-id\"         : \"&lt;ticket-id&gt;\",\n                \"download-url\"      : \"http://127.0.0.1:8080/d/&lt;ticket-id&gt;\",\n                \"download-page-url\" : \"http://127.0.0.1:8080/&lt;ticket-id&gt;\"\n            }\n        ]\n    }\n}\n</code></pre> <p>Curl Command:</p> <pre><code>curl -H \"$AUTH_HEADER\" -d '{\"paths\":[\"/path/to/file\",\"/path/to/dir\"]}' http://127.0.0.1:3000/secured/filesystem/list-tickets\n</code></pre>","path":["API Reference","Endpoints","Filesystem","Tickets"],"tags":[]},{"location":"services/api/endpoints/filesystem/tickets/#deleting-tickets","level":2,"title":"Deleting Tickets","text":"<p>URL Path: /secured/filesystem/delete-tickets</p> <p>HTTP Method: POST</p> <p>Error Codes: ERR_NOT_A_USER, ERR_DOES_NOT_EXIST, ERR_NOT_WRITEABLE</p> <p>Request Parameters:</p> <p>Request Body:</p> <pre><code>{\n    \"tickets\" : [\"ticket-id1\", \"ticket-id2\"]\n}\n</code></pre> <p>Response Body:</p> <pre><code>{\n    \"tickets\" : [\"ticket-id1\", \"ticket-id2\"]\n}\n</code></pre> <p>Curl Command:</p> <pre><code>curl -H \"$AUTH_HEADER\" -d '{\"tickets\":[\"ticket-id1\",\"ticket-id2\"]}' http://127.0.0.1:4000/secured/filesystem/delete-tickets\n</code></pre>","path":["API Reference","Endpoints","Filesystem","Tickets"],"tags":[]}]}